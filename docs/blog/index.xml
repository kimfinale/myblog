<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Disease modeling for public health</title>
<link>https://www.jonghoonk.com/blog/index.html</link>
<atom:link href="https://www.jonghoonk.com/blog/index.xml" rel="self" type="application/rss+xml"/>
<description>Disease modeling for public health</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Thu, 26 Jun 2025 15:00:00 GMT</lastBuildDate>
<item>
  <title>Optimizing Vaccination Strategies: Pre-emptive vs. Reactive Vaccination</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/preemptive_reactive/index.html</link>
  <description><![CDATA[ 



<p>When managing infectious disease risks such as cholera, limited vaccine supply often forces decision-makers to choose between <strong>pre-emptive</strong> and <strong>reactive</strong> vaccination campaigns. This post explores a cost-benefit model comparing the two strategies using analytical expressions and numerical simulations.</p>
<p>We aim to answer: <strong>Under what conditions is it better to vaccinate before an outbreak occurs, and when is it more beneficial to wait and respond reactively?</strong></p>
<section id="defining-the-core-quantities" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="defining-the-core-quantities"><span class="header-section-number">1</span> Defining the Core Quantities</h2>
<p>Let:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?B">: The full benefit gained by averting an outbreak (e.g., DALYs or cases averted)</li>
<li><img src="https://latex.codecogs.com/png.latex?C">: The cost of deploying one vaccination campaign</li>
<li><img src="https://latex.codecogs.com/png.latex?p">: The probability of an outbreak in a given region</li>
<li><img src="https://latex.codecogs.com/png.latex?r">: The effectiveness of a reactive campaign relative to pre-emptive one (e.g., <img src="https://latex.codecogs.com/png.latex?r=0.6"> means 60% as effective)</li>
</ul>
<section id="pre-emptive-vaccination" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="pre-emptive-vaccination"><span class="header-section-number">1.1</span> Pre-emptive Vaccination</h3>
<p>If we vaccinate before any outbreak, the expected benefit is <img src="https://latex.codecogs.com/png.latex?B%20%5Ccdot%20p">. However, we always incur the campaign cost <img src="https://latex.codecogs.com/png.latex?C">, so the <strong>net expected benefit</strong> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BNet%7D_%7B%5Ctext%7Bpre%7D%7D%20=%20Bp%20-%20C%0A"></p>
</section>
<section id="reactive-vaccination" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="reactive-vaccination"><span class="header-section-number">1.2</span> Reactive Vaccination</h3>
<p>For reactive vaccination, the benefit is only realized if an outbreak occurs (probability <img src="https://latex.codecogs.com/png.latex?p">), and even then, only <img src="https://latex.codecogs.com/png.latex?rB"> is saved due to delays. The cost <img src="https://latex.codecogs.com/png.latex?C"> is only paid if an outbreak occurs. Hence:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BNet%7D_%7B%5Ctext%7Breact%7D%7D%20=%20Bpr%20-%20Cp%0A"></p>
</section>
</section>
<section id="comparison-of-two-strategies" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="comparison-of-two-strategies"><span class="header-section-number">2</span> Comparison of two strategies</h2>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BNet%7D_%7B%5Ctext%7Bpre%7D%7D%20-%20%5Ctext%7BNet%7D_%7B%5Ctext%7Breact%7D%7D%20=%20pB(1%20-%20r)%20-%20C(1%20-%20p)%0A"></p>
<section id="interpretation" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="interpretation"><span class="header-section-number">2.1</span> Interpretation</h3>
<p>Pre-emptive is better if:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ApB(1%20-%20r)%20%3E%20C(1%20-%20p)%0A"></p>
<p>Solving for <img src="https://latex.codecogs.com/png.latex?p"> gives the threshold outbreak probability <img src="https://latex.codecogs.com/png.latex?p%5E*">:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sympy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sp</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define symbols</span></span>
<span id="cb1-4">B, C, p, r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sp.symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B C p r'</span>, positive<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Net benefits</span></span>
<span id="cb1-7">net_pre   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> C</span>
<span id="cb1-8">net_react <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># When is pre-emptive better?</span></span>
<span id="cb1-11">threshold_p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sp.solve(net_pre <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> net_react <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, p)</span></code></pre></div>
</details>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap%20%3E%20%5Cfrac%7BC%7D%7BB(1%20-%20r)%20+%20C%7D%0A"></p>
</section>
</section>
<section id="visualizing-the-threshold-probability" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="visualizing-the-threshold-probability"><span class="header-section-number">3</span> Visualizing the Threshold Probability</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a grid of r and p values</span></span>
<span id="cb2-5">r_vals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb2-6">p_vals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb2-7">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-8">C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute threshold for each r</span></span>
<span id="cb2-11">grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand.grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p_vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r_vals)</span>
<span id="cb2-12">grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> grid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_star =</span> C <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> r) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> C),</span>
<span id="cb2-14">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decision =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> p_star, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Preemptive"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reactive"</span>))</span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb2-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(grid, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> decision)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Preemptive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reactive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tomato"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccination Strategy Decision Heatmap"</span>,</span>
<span id="cb2-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Relative Reactive Benefit (r)"</span>,</span>
<span id="cb2-22">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outbreak Probability (p)"</span>,</span>
<span id="cb2-23">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Strategy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/preemptive_reactive/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot shows that reactive vaccination is better when <img src="https://latex.codecogs.com/png.latex?p"> is small, but pre-emptive takes over beyond a break-even point that depends on <img src="https://latex.codecogs.com/png.latex?r">.</p>
</section>
<section id="additional-benefits-of-pre-emptive-vaccination-and-the-cost-of-not-deploying-vaccines" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="additional-benefits-of-pre-emptive-vaccination-and-the-cost-of-not-deploying-vaccines"><span class="header-section-number">4</span> Additional benefits of pre-emptive vaccination and the cost of not deploying vaccines</h2>
<p>We define two additional parameters:</p>
<ul>
<li><p><img src="https://latex.codecogs.com/png.latex?%5Cphi">: The benefit of vaccination when no outbreak occurs (e.g., due to future immunity or prevention). This applies to both pre-emptive and reactive strategies</p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?D">: The cost or penalty associated with unused vaccines (e.g., due to expiry or logistical waste). This applied to the reactive strategy.</p></li>
</ul>
<section id="pre-emptive-vaccination-1" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="pre-emptive-vaccination-1"><span class="header-section-number">4.1</span> Pre-emptive Vaccination</h3>
<p>If we vaccinate before any outbreak, the expected benefit includes two parts:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?pB"> when an outbreak is averted</li>
<li><img src="https://latex.codecogs.com/png.latex?(1%20-%20p)%5Cphi%20B"> when no outbreak occurs but future benefit remains</li>
</ul>
<p>The cost <img src="https://latex.codecogs.com/png.latex?C"> is always incurred. So the <strong>net expected benefit</strong> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BNet%7D_%7B%5Ctext%7Bpre%7D%7D%20=%20pB%20+%20(1%20-%20p)%5Cphi%20B%20-%20C%0A"></p>
</section>
<section id="reactive-vaccination-1" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="reactive-vaccination-1"><span class="header-section-number">4.2</span> Reactive Vaccination</h3>
<p>Reactive benefit occurs only if an outbreak occurs. In that case:</p>
<ul>
<li>Benefit: <img src="https://latex.codecogs.com/png.latex?rB"> and <img src="https://latex.codecogs.com/png.latex?%5Cphi%20B"> with probability <img src="https://latex.codecogs.com/png.latex?p"></li>
<li>Cost: <img src="https://latex.codecogs.com/png.latex?C"> with probability <img src="https://latex.codecogs.com/png.latex?p"></li>
<li>Penalty (waste): <img src="https://latex.codecogs.com/png.latex?D"> with probability <img src="https://latex.codecogs.com/png.latex?(1%20-%20p)"></li>
</ul>
<p>So the net expected benefit is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BNet%7D_%7B%5Ctext%7Breact%7D%7D%20=%20p(r+%5Cphi)B%20-%20pC%20-%20(1%20-%20p)D%0A"></p>
<p>Compare symbolically both strategies under these extended conditions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sympy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sp</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define symbols</span></span>
<span id="cb3-4">B, C, D, p, r, phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sp.symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B C D p r phi'</span>, positive<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Net benefits</span></span>
<span id="cb3-7">net_pre   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>phi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> C</span>
<span id="cb3-8">net_react <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>phi)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>D</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Difference</span></span>
<span id="cb3-11">diff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> net_pre <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> net_react</span>
<span id="cb3-12">sp.simplify(diff)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>-B*p*(phi + r) + B*p - B*phi*(p - 1) + C*p - C - D*(p - 1)</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"></span>
<span id="cb5-2">threshold_p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sp.solve(diff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, p)</span></code></pre></div>
</details>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BNet%7D_%7B%5Ctext%7Bpre%7D%7D%20-%20%5Ctext%7BNet%7D_%7B%5Ctext%7Breact%7D%7D%20=%20Bp(1%20-%20r%20-%20%5Cphi)%20+%20B(1%20-%20p)%5Cphi%20-%20C(1%20-%20p)%20+%20D(1%20-%20p)%0A"></p>
<p>Pre-emptive vaccination is better when this expression is positive. The threshold for <img src="https://latex.codecogs.com/png.latex?p"> can be derived based on values of <img src="https://latex.codecogs.com/png.latex?B,%20C,%20D,%20r,%20%5Cphi">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap%20%3E%20%5Cfrac%7B-%20%5Cphi%20B%20+%20C%20-%20D%7D%7B(1-%202%20%5Cphi%20-%20r)B%20+%20C%20-%20D%7D%0A"></p>
</section>
<section id="visualizing-the-scenario" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="visualizing-the-scenario"><span class="header-section-number">4.3</span> Visualizing the scenario</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb6-3"></span>
<span id="cb6-4">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-5">C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb6-6">D <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span></span>
<span id="cb6-7">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb6-8">r_vals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb6-9">p_vals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb6-10"></span>
<span id="cb6-11">compute_net <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p, r) {</span>
<span id="cb6-12">  net_pre   <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> C</span>
<span id="cb6-13">  net_react <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> C <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> D</span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r,</span>
<span id="cb6-15">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">net_pre =</span> net_pre,</span>
<span id="cb6-16">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">net_react =</span> net_react))</span>
<span id="cb6-17">}</span>
<span id="cb6-18"></span>
<span id="cb6-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute threshold for each r</span></span>
<span id="cb6-20">grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand.grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p_vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r_vals)</span>
<span id="cb6-21">grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> grid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pre =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compute_net</span>(p,r)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>net_pre,</span>
<span id="cb6-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">react =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compute_net</span>(p,r)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>net_react,</span>
<span id="cb6-24">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decision =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(pre <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> react, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Preemptive"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reactive"</span>))</span>
<span id="cb6-25"></span>
<span id="cb6-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot heatmap</span></span>
<span id="cb6-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(grid, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> decision)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Preemptive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reactive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tomato"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vaccination Strategy Decision Heatmap"</span>,</span>
<span id="cb6-31">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Relative Reactive Benefit (r)"</span>,</span>
<span id="cb6-32">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outbreak Probability (p)"</span>,</span>
<span id="cb6-33">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Strategy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/preemptive_reactive/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="extending-to-multiple-sub-populations" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="extending-to-multiple-sub-populations"><span class="header-section-number">5</span> Extending to Multiple Sub-populations</h2>
<p>Let’s now generalize to <img src="https://latex.codecogs.com/png.latex?k"> sub-populations, each with its own outbreak probability <img src="https://latex.codecogs.com/png.latex?p_i">. We have <img src="https://latex.codecogs.com/png.latex?m"> campaigns to deploy:</p>
<ul>
<li>Assign <img src="https://latex.codecogs.com/png.latex?m_%7B%5Ctext%7Bpre%7D%7D"> campaigns pre-emptively</li>
<li>Leave <img src="https://latex.codecogs.com/png.latex?m_%7B%5Ctext%7Breact%7D%7D%20=%20m%20-%20m_%7B%5Ctext%7Bpre%7D%7D"> campaigns for reactive use</li>
</ul>
<section id="strategy" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="strategy"><span class="header-section-number">5.1</span> Strategy:</h3>
<ul>
<li>Sort sub-populations by descending <img src="https://latex.codecogs.com/png.latex?p_i"></li>
<li>Pre-emptively vaccinate top <img src="https://latex.codecogs.com/png.latex?m_%7B%5Ctext%7Bpre%7D%7D"> if <img src="https://latex.codecogs.com/png.latex?p_i%20%3E%20%5Cfrac%7B-%20%5Cphi%20B+%20C%20-%20D%7D%7B(1-%202%20%5Cphi%20-%20r)B%20+%20C%20-%20D%7D"></li>
<li>Use remaining campaigns reactively</li>
</ul>
</section>
<section id="numerical-illustration" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="numerical-illustration"><span class="header-section-number">5.2</span> Numerical illustration</h3>
<p>We simulate 10 sub-populations with different outbreak probabilities and show how many campaigns should be used pre-emptively.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb7-2">p_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb7-3">threshold_p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(B, C, r, phi, D) { (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> C <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> D)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> r)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> C <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> D)}</span>
<span id="cb7-4"></span>
<span id="cb7-5"></span>
<span id="cb7-6">assign_campaigns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(p_i, B, C, r, phi, D) {</span>
<span id="cb7-7">  p_star <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">threshold_p</span>(B, C, r, phi, D)</span>
<span id="cb7-8">  preemptive <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(p_i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> p_star)</span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p_i), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_i =</span> p_i,</span>
<span id="cb7-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decision =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(p_i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> p_star, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pre-emptive"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reactive"</span>))</span>
<span id="cb7-11">}</span>
<span id="cb7-12"></span>
<span id="cb7-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assign_campaigns</span>(p_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">B=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">C=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">D=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   index        p_i    decision
1      1 0.37797639 pre-emptive
2      2 0.37018212 pre-emptive
3      3 0.34065667 pre-emptive
4      4 0.30780591    reactive
5      5 0.29677267    reactive
6      6 0.27994730    reactive
7      7 0.27461093    reactive
8      8 0.23168358    reactive
9      9 0.15014884    reactive
10    10 0.09713331    reactive</code></pre>
</div>
</div>
</section>
</section>
<section id="further-extention" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="further-extention"><span class="header-section-number">6</span> Further extention</h2>
<p>We consider a strategic vaccination scenario where oral cholera vaccines (OCVs) are in limited supply. Specifically, the available stockpile is sufficient to cover only 10% of all subpopulations. Epidemiological data suggest that, within the anticipated time frame, fewer than 10% of subpopulations are likely to experience an outbreak. This implies that a fully reactive strategy—in which vaccines are deployed only in response to confirmed outbreaks—could, in principle, respond to all outbreaks without exceeding supply.</p>
<p>However, a recent risk assessment indicates that 20% of the population exceeds the outbreak probability threshold <img src="https://latex.codecogs.com/png.latex?p%5E*"> above which preemptive vaccination is expected to yield greater benefit than reactive vaccination for a given region.</p>
<p>This raises a strategic dilemma:</p>
<blockquote class="blockquote">
<p>Should all subpopulations above the preemptive threshold be vaccinated in advance, despite limited vaccine availability and the potential need for reactive response elsewhere?</p>
</blockquote>
<p>This scenario highlights the trade-off between targeting high-risk areas proactively versus preserving flexibility to respond where outbreaks actually occur, especially under uncertainty and supply constraints. That is, we need to consider an opportunity cost of preemptive vaccination under Limited vaccine supply.</p>
<section id="setting-and-assumptions" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="setting-and-assumptions"><span class="header-section-number">6.1</span> Setting and Assumptions</h3>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?n">: total number of subpopulations.</li>
<li><img src="https://latex.codecogs.com/png.latex?M">: number of vaccine campaigns available.</li>
<li><img src="https://latex.codecogs.com/png.latex?k">: number of regions chosen for preemptive vaccination.</li>
<li><img src="https://latex.codecogs.com/png.latex?p_i">: outbreak probability in region <img src="https://latex.codecogs.com/png.latex?i">, with $p_1 p_2 p_n $.</li>
</ul>
<p>Assumptions:</p>
<ul>
<li>You can identify top-<img src="https://latex.codecogs.com/png.latex?k"> highest-risk regions.</li>
<li>You can react to up to <img src="https://latex.codecogs.com/png.latex?M%20-%20k"> outbreaks in unvaccinated populations.</li>
<li>Outbreaks occur independently across regions.</li>
</ul>
</section>
<section id="expected-benefits" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="expected-benefits"><span class="header-section-number">6.2</span> Expected Benefits</h3>
<section id="preemptive-strategy" class="level4" data-number="6.2.1">
<h4 data-number="6.2.1" class="anchored" data-anchor-id="preemptive-strategy"><span class="header-section-number">6.2.1</span> Preemptive Strategy</h4>
<p>Vaccinate top <img src="https://latex.codecogs.com/png.latex?k"> high-risk regions:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BBenefit%7D_%7B%5Ctext%7Bpre%7D%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bk%7D%20p_i%20B%20"></p>
</section>
<section id="reactive-strategy" class="level4" data-number="6.2.2">
<h4 data-number="6.2.2" class="anchored" data-anchor-id="reactive-strategy"><span class="header-section-number">6.2.2</span> Reactive Strategy</h4>
<p>Let <img src="https://latex.codecogs.com/png.latex?%5Cmu_k%20=%20%5Csum_%7Bi=k+1%7D%5E%7Bn%7D%20p_i">: expected number of outbreaks in unvaccinated regions.</p>
<p>Expected reactive benefit (up to <img src="https://latex.codecogs.com/png.latex?M%20-%20k"> responses):</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BBenefit%7D_%7B%5Ctext%7Breact%7D%7D%20=%20rB%20%5Ccdot%20%5Cmin(M%20-%20k,%20%5Cmu_k)%0A"></p>
</section>
<section id="total-expected-benefit" class="level4" data-number="6.2.3">
<h4 data-number="6.2.3" class="anchored" data-anchor-id="total-expected-benefit"><span class="header-section-number">6.2.3</span> Total Expected Benefit</h4>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BTotal%20Benefit%7D_k%20%5Capprox%20B%20%5Cleft(%20%5Csum_%7Bi=1%7D%5E%7Bk%7D%20p_i%20+%20r%20%5Ccdot%20%5Cmin(M%20-%20k,%20%5Cmu_k)%20%5Cright)%0A"></p>
</section>
</section>
<section id="opportunity-cost-of-preemptive-vaccination" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="opportunity-cost-of-preemptive-vaccination"><span class="header-section-number">6.3</span> Opportunity Cost of Preemptive Vaccination</h3>
<p>Vaccinating region <img src="https://latex.codecogs.com/png.latex?k+1"> preemptively:</p>
<ul>
<li>Gain: <img src="https://latex.codecogs.com/png.latex?p_%7Bk+1%7D%20B"></li>
<li>Lose: ability to respond reactively to one more outbreak</li>
</ul>
<p>Opportunity cost:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BOpportunity%20Cost%7D(k+1)%20=%20rB%20%5Ccdot%20%5Cmathbb%7BP%7D(X_k%20%5Cge%20M%20-%20k)%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?X_k%20%5Csim%20%5Ctext%7BBinomial%7D(n%20-%20k,%20%5Cbar%7Bp%7D_k)"> or <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BPoisson%7D(%5Cmu_k)">.</p>
</section>
<section id="refined-decision-rule" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="refined-decision-rule"><span class="header-section-number">6.4</span> Refined Decision Rule</h3>
<p>Preemptively vaccinate region <img src="https://latex.codecogs.com/png.latex?i"> only if:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_i%20%3E%20r%20%5Ccdot%20%5Cmathbb%7BP%7D(%5Ctext%7Breactive%20demand%20exceeds%20remaining%20doses%7D)%0A"></p>
<p>Using Poisson approximation:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbb%7BP%7D(X_k%20%5Cge%20M%20-%20k)%20%5Capprox%201%20-%20%5Csum_%7Bx=0%7D%5E%7BM-k-1%7D%20%5Cfrac%7Be%5E%7B-%5Cmu_k%7D%20%5Cmu_k%5Ex%7D%7Bx!%7D%0A"></p>
<p>So:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BOpportunity%20Cost%7D%20%5Capprox%20rB%20%5Cleft(1%20-%20%5Csum_%7Bx=0%7D%5E%7BM-k-1%7D%20%5Cfrac%7Be%5E%7B-%5Cmu_k%7D%20%5Cmu_k%5Ex%7D%7Bx!%7D%20%5Cright)%0A"></p>
</section>
<section id="summary-of-key-formulas" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="summary-of-key-formulas"><span class="header-section-number">6.5</span> Summary of Key Formulas</h3>
<table class="table">
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th>Quantity</th>
<th>Expression</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Preemptive threshold</td>
<td>$ p^* = $</td>
</tr>
<tr class="even">
<td>Preemptive benefit (k regions)</td>
<td>$_{i=1}^k p_i B $</td>
</tr>
<tr class="odd">
<td>Reactive expected benefit</td>
<td>$ rB (M-k, _k) $</td>
</tr>
<tr class="even">
<td>Total expected benefit</td>
<td>$ B ( _{i=1}^k p_i + r (M - k, _k) ) $</td>
</tr>
<tr class="odd">
<td>Opportunity cost of dose $ k+1 $</td>
<td>$ rB (X_k M - k) $</td>
</tr>
<tr class="even">
<td>Adjusted decision rule</td>
<td>Vaccinate if $ p_{k+1} &gt; r (X_k M - k) $</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load necessary libraries</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb9-4"></span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation parameters</span></span>
<span id="cb9-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb9-7">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Total subpopulations</span></span>
<span id="cb9-8">M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>                         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vaccine budget (10% of regions)</span></span>
<span id="cb9-9">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Benefit of preventing an outbreak</span></span>
<span id="cb9-10">C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost of vaccination</span></span>
<span id="cb9-11">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Relative reactive benefit</span></span>
<span id="cb9-12">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb9-13">D <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb9-14"></span>
<span id="cb9-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Threshold for preemptive action</span></span>
<span id="cb9-16">p_star <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> C <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> D) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> r)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> C <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> D)</span>
<span id="cb9-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># p_star &lt;- C / (B * (1 - r) + C) </span></span>
<span id="cb9-18"></span>
<span id="cb9-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate synthetic outbreak probabilities</span></span>
<span id="cb9-20">p_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(n, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb9-21"></span>
<span id="cb9-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulate outbreak events (Bernoulli trial based on p_i)</span></span>
<span id="cb9-23">n_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb9-24">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb9-25"></span>
<span id="cb9-26"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (k <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M) {</span>
<span id="cb9-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Preemptively vaccinate top-k at-risk regions</span></span>
<span id="cb9-28">  preempt_indices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>k</span>
<span id="cb9-29">  reactive_pool <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n</span>
<span id="cb9-30"></span>
<span id="cb9-31">  total_cases_averted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n_sim)</span>
<span id="cb9-32"></span>
<span id="cb9-33">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (s <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_sim) {</span>
<span id="cb9-34">    outbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, p_i)</span>
<span id="cb9-35"></span>
<span id="cb9-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Preemptive: full benefit if outbreak occurs</span></span>
<span id="cb9-37">    preempt_impact <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(outbreaks[preempt_indices]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B</span>
<span id="cb9-38"></span>
<span id="cb9-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reactive: respond to up to (M - k) actual outbreaks in unvaccinated group</span></span>
<span id="cb9-40">    reactive_indices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> reactive_pool[outbreaks[reactive_pool] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb9-41">    max_reactive <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(reactive_indices), M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> k)</span>
<span id="cb9-42">    reactive_impact <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> max_reactive <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B</span>
<span id="cb9-43"></span>
<span id="cb9-44">    total_cases_averted[s] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> preempt_impact <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> reactive_impact</span>
<span id="cb9-45">  }</span>
<span id="cb9-46"></span>
<span id="cb9-47">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(results,</span>
<span id="cb9-48">                   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb9-49">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k_preempt =</span> k,</span>
<span id="cb9-50">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_cases_averted =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(total_cases_averted),</span>
<span id="cb9-51">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(total_cases_averted)</span>
<span id="cb9-52">                   ))</span>
<span id="cb9-53">}</span>
<span id="cb9-54"></span>
<span id="cb9-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb9-56"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(results, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> k_preempt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mean_cases_averted)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> mean_cases_averted <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sd,</span>
<span id="cb9-59">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> mean_cases_averted <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sd),</span>
<span id="cb9-60">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"skyblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-61">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expected Cases Averted vs. Number of Preemptive Vaccinations"</span>,</span>
<span id="cb9-62">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of Preemptive Vaccinated Regions (k)"</span>,</span>
<span id="cb9-63">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Cases Averted (with SD band)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-64">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/preemptive_reactive/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load necessary libraries</span></span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb10-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation parameters</span></span>
<span id="cb10-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb10-7">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Total subpopulations</span></span>
<span id="cb10-8">M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>                         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vaccine budget (10% of regions)</span></span>
<span id="cb10-9">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Benefit of preventing an outbreak</span></span>
<span id="cb10-10">C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost of vaccination</span></span>
<span id="cb10-11">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb10-12">D <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb10-13"></span>
<span id="cb10-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Outbreak probabilities</span></span>
<span id="cb10-15">p_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(n, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb10-16"></span>
<span id="cb10-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sim settings</span></span>
<span id="cb10-18">n_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb10-19">r_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Explore multiple r values</span></span>
<span id="cb10-20">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb10-21"></span>
<span id="cb10-22"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (r <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> r_values) {</span>
<span id="cb10-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recalculate p_star (optional for reference)</span></span>
<span id="cb10-24">  p_star <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> C <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> D) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> r)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> C <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> D)</span>
<span id="cb10-25"></span>
<span id="cb10-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (k <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M) {</span>
<span id="cb10-27">    preempt_indices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>k</span>
<span id="cb10-28">    reactive_pool <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n</span>
<span id="cb10-29"></span>
<span id="cb10-30">    total_cases_averted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n_sim)</span>
<span id="cb10-31"></span>
<span id="cb10-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (s <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_sim) {</span>
<span id="cb10-33">      outbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, p_i)</span>
<span id="cb10-34"></span>
<span id="cb10-35">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Preemptive impact</span></span>
<span id="cb10-36">      preempt_impact <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(outbreaks[preempt_indices]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B</span>
<span id="cb10-37"></span>
<span id="cb10-38">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reactive impact</span></span>
<span id="cb10-39">      reactive_indices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> reactive_pool[outbreaks[reactive_pool] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb10-40">      max_reactive <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(reactive_indices), M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> k)</span>
<span id="cb10-41">      reactive_impact <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> max_reactive <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B</span>
<span id="cb10-42"></span>
<span id="cb10-43">      total_cases_averted[s] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> preempt_impact <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> reactive_impact</span>
<span id="cb10-44">    }</span>
<span id="cb10-45"></span>
<span id="cb10-46">    results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(results,</span>
<span id="cb10-47">                     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb10-48">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r,</span>
<span id="cb10-49">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k_preempt =</span> k,</span>
<span id="cb10-50">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_cases_averted =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(total_cases_averted),</span>
<span id="cb10-51">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(total_cases_averted)</span>
<span id="cb10-52">                     ))</span>
<span id="cb10-53">  }</span>
<span id="cb10-54">}</span>
<span id="cb10-55"></span>
<span id="cb10-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb10-57"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(results, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> k_preempt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mean_cases_averted, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(r))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> mean_cases_averted <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sd,</span>
<span id="cb10-60">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> mean_cases_averted <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sd,</span>
<span id="cb10-61">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(r)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-62">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expected Cases Averted by Preemptive Vaccination and Reactive Effectiveness"</span>,</span>
<span id="cb10-63">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of Preemptive Vaccinated Regions (k)"</span>,</span>
<span id="cb10-64">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Cases Averted (with SD band)"</span>,</span>
<span id="cb10-65">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reactive effectiveness (r)"</span>,</span>
<span id="cb10-66">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reactive effectiveness (r)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-68">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'top'</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/preemptive_reactive/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="further-extention-1" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="further-extention-1"><span class="header-section-number">7</span> Further Extention</h2>
<p>We consider a constrained setting where <img src="https://latex.codecogs.com/png.latex?r"> is not fixed and depends on the <strong>duration</strong> of the outbreak, in addition to the previous version.</p>
<p>Longer outbreaks allow more time for detection and response, and thus yield more effective reactive campaigns. We model <img src="https://latex.codecogs.com/png.latex?r"> as a function of outbreak duration <img src="https://latex.codecogs.com/png.latex?d">, i.e., <img src="https://latex.codecogs.com/png.latex?r%20=%20f(d)">.</p>
<section id="assumptions" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="assumptions"><span class="header-section-number">7.1</span> Assumptions</h3>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?r(d)%20=%20%5Cfrac%7B%5Clog(d%20+%201)%7D%7B%5Clog(d_%7B%5Ctext%7Bmax%7D%7D%20+%201)%7D">, normalized so that <img src="https://latex.codecogs.com/png.latex?r%20%5Cin%20%5B0,1%5D"> for durations <img src="https://latex.codecogs.com/png.latex?d%20%5Cin%20%5B1,%20d_%7B%5Ctext%7Bmax%7D%7D%5D">.</li>
<li><img src="https://latex.codecogs.com/png.latex?d%20%5Csim%20%5Ctext%7BGamma%7D(%5Calpha,%20%5Cbeta)"> — outbreak durations follow a Gamma distribution.</li>
<li>Vaccine stockpile is sufficient for <img src="https://latex.codecogs.com/png.latex?M%20=%2010%5C%25"> of <img src="https://latex.codecogs.com/png.latex?n"> subpopulations.</li>
<li>20% of subpopulations have <img src="https://latex.codecogs.com/png.latex?p_i%20%3E%20p%5E*">.</li>
</ul>
</section>
<section id="threshold-probability-for-preemptive-vaccination" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="threshold-probability-for-preemptive-vaccination"><span class="header-section-number">7.2</span> Threshold Probability for Preemptive Vaccination</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load necessary libraries</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb11-4"></span>
<span id="cb11-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation parameters</span></span>
<span id="cb11-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb11-7">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb11-8">M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb11-9">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-10">C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb11-11">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb11-12">D <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb11-13"></span>
<span id="cb11-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Control parameter for r(d)</span></span>
<span id="cb11-15">alpha <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.4</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &gt;1: delayed growth, &lt;1: rapid saturation</span></span>
<span id="cb11-16"></span>
<span id="cb11-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Outbreak probabilities</span></span>
<span id="cb11-18">p_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(n, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb11-19"></span>
<span id="cb11-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Duration depends on p_i</span></span>
<span id="cb11-21">min_d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb11-22">max_d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">156</span></span>
<span id="cb11-23">duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> min_d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (max_d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> min_d) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (p_i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(p_i)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(p_i) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(p_i))</span>
<span id="cb11-24"></span>
<span id="cb11-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reactive effectiveness with parameter alpha</span></span>
<span id="cb11-26">r_d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ((duration <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> min_d) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (max_d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> min_d)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> alpha</span>
<span id="cb11-27">r_d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(r_d, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cap at 1</span></span>
<span id="cb11-28"></span>
<span id="cb11-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional preview</span></span>
<span id="cb11-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot(p_i, r_d, type = "l")</span></span>
<span id="cb11-31"></span>
<span id="cb11-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation loop</span></span>
<span id="cb11-33">n_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb11-34">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb11-35"></span>
<span id="cb11-36"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (k <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M) {</span>
<span id="cb11-37">  preempt_indices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>k</span>
<span id="cb11-38">  reactive_pool <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (k <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n</span>
<span id="cb11-39"></span>
<span id="cb11-40">  total_cases_averted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n_sim)</span>
<span id="cb11-41"></span>
<span id="cb11-42">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (s <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_sim) {</span>
<span id="cb11-43">    outbreaks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, p_i)</span>
<span id="cb11-44"></span>
<span id="cb11-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Preemptive impact</span></span>
<span id="cb11-46">    preempt_impact <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(outbreaks[preempt_indices]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B</span>
<span id="cb11-47"></span>
<span id="cb11-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reactive impact</span></span>
<span id="cb11-49">    reactive_indices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> reactive_pool[outbreaks[reactive_pool] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb11-50">    reactive_impact <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(reactive_indices) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) {</span>
<span id="cb11-51">      top_reactive <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(reactive_indices, M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> k)</span>
<span id="cb11-52">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(r_d[top_reactive] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B)</span>
<span id="cb11-53">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb11-54"></span>
<span id="cb11-55">    total_cases_averted[s] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> preempt_impact <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> reactive_impact</span>
<span id="cb11-56">  }</span>
<span id="cb11-57"></span>
<span id="cb11-58">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(results, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb11-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k_preempt =</span> k,</span>
<span id="cb11-60">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_cases_averted =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(total_cases_averted),</span>
<span id="cb11-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(total_cases_averted)</span>
<span id="cb11-62">  ))</span>
<span id="cb11-63">}</span>
<span id="cb11-64"></span>
<span id="cb11-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot simulation result</span></span>
<span id="cb11-66"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(results, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> k_preempt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mean_cases_averted)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-68">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> mean_cases_averted <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sd,</span>
<span id="cb11-69">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> mean_cases_averted <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sd),</span>
<span id="cb11-70">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"skyblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-71">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expected Cases Averted vs. k (alpha = "</span>, alpha, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>),</span>
<span id="cb11-72">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of Preemptively Vaccinated Regions (k)"</span>,</span>
<span id="cb11-73">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Cases Averted (with SD)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-74">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/preemptive_reactive/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="interpretation-1" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="interpretation-1"><span class="header-section-number">7.3</span> Interpretation</h3>
<ul>
<li><strong>Short-duration outbreaks</strong> yield <strong>lower reactive effectiveness</strong> <img src="https://latex.codecogs.com/png.latex?r(d)"> → lower <img src="https://latex.codecogs.com/png.latex?p%5E*"> → favoring <strong>preemptive vaccination</strong>.</li>
<li><strong>Longer-duration outbreaks</strong> increase <img src="https://latex.codecogs.com/png.latex?r(d)"> → raising <img src="https://latex.codecogs.com/png.latex?p%5E*"> → making <strong>reactive vaccination more attractive</strong>.</li>
<li>With only 10% vaccine supply, we cannot preemptively cover all high-risk regions.</li>
<li>This creates an <strong>opportunity cost</strong>: vaccinating low-duration regions may reduce capacity to respond to longer ones where reactive strategies might succeed.</li>
</ul>
</section>
<section id="summary-of-final-model" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="summary-of-final-model"><span class="header-section-number">7.4</span> Summary of Final Model</h3>
<table class="table">
<colgroup>
<col style="width: 47%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>Symbol</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?r(d)"></td>
<td>Duration-dependent effectiveness of reactive vaccination</td>
</tr>
<tr class="even">
<td><img src="https://latex.codecogs.com/png.latex?%5Cphi"></td>
<td>Benefit from proactive vaccination even if no outbreak</td>
</tr>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?D"></td>
<td>Cost of unused vaccine under reactive plan</td>
</tr>
<tr class="even">
<td><img src="https://latex.codecogs.com/png.latex?p%5E*"></td>
<td>Threshold outbreak probability above which preemptive vaccination is favored</td>
</tr>
</tbody>
</table>
<p>Final threshold formula:</p>
<p><img src="https://latex.codecogs.com/png.latex?%7Bp%5E*%20=%20%5Cfrac%7B-%20%5Cphi%20B%20+%20C%20-%20D%7D%7B(1%20-%202%5Cphi%20-%20r(d))%20B%20+%20C%20-%20D%7D%7D"></p>
<p>This formulation reflects <strong>operational complexity</strong>, <strong>vaccine scarcity</strong>, and <strong>time-sensitive effectiveness</strong>, guiding more nuanced vaccine allocation strategies in outbreak-prone settings.</p>
</section>
</section>
<section id="discussion" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="discussion"><span class="header-section-number">8</span> Discussion</h2>
<p>When outbreak risk is high enough, <strong>pre-emptive vaccination</strong> pays off even if the outbreak doesn’t occur. When outbreak risk is low, and <strong>reactive</strong> campaigns are effective (<img src="https://latex.codecogs.com/png.latex?r"> close to 1) and is more cost-effective. The decision threshold depends critically on the relative cost <img src="https://latex.codecogs.com/png.latex?C"> and the delay penalty <img src="https://latex.codecogs.com/png.latex?(1%20-%20r)"> in addition to <img src="https://latex.codecogs.com/png.latex?p"> and <img src="https://latex.codecogs.com/png.latex?r"></p>
</section>
<section id="conclusion" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">9</span> Conclusion</h2>
<p>Even under limited vaccine supply, careful cost-benefit modeling can guide whether to vaccinate early or wait. This blog post outlined a tractable analytical framework and practical tools (in Python and R) to support such decisions. Extensions could include waning immunity, spatial correlations, or dynamic outbreaks.</p>
</section>
<section id="references" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="references"><span class="header-section-number">10</span> References</h2>


</section>

 ]]></description>
  <guid>https://www.jonghoonk.com/blog/posts/preemptive_reactive/index.html</guid>
  <pubDate>Thu, 26 Jun 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>다니엘 베르누이의 천연두 연구: 최초의 감염병 수리모형</title>
  <dc:creator>연구자 </dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/book_bernoulli_math_model_smallpox/index.html</link>
  <description><![CDATA[ 



<section id="서론-계몽시대의-수학자와-전염병" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="서론-계몽시대의-수학자와-전염병"><span class="header-section-number">1</span> 서론: 계몽시대의 수학자와 전염병</h2>
<p>18세기 유럽은 천연두(smallpox)의 그림자 아래 살고 있었다. 이 무서운 질병은 매년 수십만 명의 목숨을 앗아갔으며, 생존자들에게는 평생 지울 수 없는 흉터를 남겼다 <span class="citation" data-cites="razzell1977conquest">(Razzell, 1977)</span>. 이런 상황에서 한 수학자가 수학적 사고를 통해 이 질병에 맞서고자 했다. 그의 이름은 다니엘 베르누이(Daniel Bernoulli, 1700-1782)였다.</p>
<p>베르누이는 저명한 수학자 가문의 일원으로, 유체역학, 확률론, 통계학에 큰 족적을 남긴 학자였다 <span class="citation" data-cites="straub1970bernoulli">(Straub, 1970)</span>. 그러나 그의 가장 혁신적인 업적 중 하나는 의학 분야에서 이루어졌다. 1760년 그는 파리 과학 아카데미(Académie Royale des Sciences)에서 천연두 사망률과 접종의 이점에 관한 새로운 분석 방법에 대한 발표를 했다 <span class="citation" data-cites="bernoulli1766essai">(Bernoulli, 1766)</span>. 이 연구는 1766년에 출판되었으며, 인류 역사상 최초로 전염병을 수학적으로 모델링한 시도로 평가받는다 <span class="citation" data-cites="dietz2002daniel">(Dietz &amp; Heesterbeek, 2002)</span>.</p>
</section>
<section id="베르누이의-원문-연구-essai-dune-nouvelle-analyse" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="베르누이의-원문-연구-essai-dune-nouvelle-analyse"><span class="header-section-number">2</span> 베르누이의 원문 연구: “Essai d’une nouvelle analyse”</h2>
<p>베르누이의 논문 “Essai d’une nouvelle analyse de la mortalité causée par la petite vérole, et des avantages de l’inoculation pour la prévenir”(천연두로 인한 사망률과 이를 예방하기 위한 접종의 이점에 관한 새로운 분석 시도)는 간단한 제목 속에 혁명적인 내용을 담고 있었다 <span class="citation" data-cites="bernoulli1766essai">(Bernoulli, 1766)</span>. 이 논문은 수학적 방법을 사용하여 공중보건 문제를 분석한 최초의 시도 중 하나였다.</p>
<p>베르누이는 논문의 서두에 자신의 의도를 명확히 밝혔다. 그는 “인류의 복지에 밀접한 관련이 있는 문제에 있어서, 약간의 분석과 계산이 제공할 수 있는 모든 지식 없이는 어떤 결정도 내려서는 안 된다”고 주장했다 <span class="citation" data-cites="blower2004attempt">(Blower &amp; Bernoulli, 2004)</span>. 이는 200여 년 후 현대 의학이 증거 기반 의사결정을 지향하게 될 것을 예견한 선구적 발언이었다.</p>
<p>베르누이가 이 연구를 시작한 배경에는 당시 유럽에서 진행되고 있던 인두법(variolation)에 대한 격렬한 논쟁이 있었다. 인두법은 천연두에 걸린 환자의 고름이나 딱지를 건강한 사람에게 의도적으로 접종하여 약한 형태의 질병을 유발하고 면역을 획득하게 하는 방법이었다 <span class="citation" data-cites="razzell1977conquest">(Razzell, 1977)</span>. 동양에서 유래한 이 방법은 18세기 초 유럽에 도입되었으나, 때때로 중증 질환이나 사망을 초래할 수 있어 논란이 많았다 <span class="citation" data-cites="ioannidis2020how">(Ioannidis, 2020)</span>.</p>
<p>베르누이는 이 논쟁에 과학적 관점에서 개입하기로 결정했다. 그는 천연두와 인두법의 위험을 수학적으로 비교하여, 인두법이 전체 인구의 건강에 미치는 영향을 정량적으로 평가하고자 했다 <span class="citation" data-cites="dietz2000bernoulli">(Dietz &amp; Heesterbeek, 2000)</span>.</p>
</section>
<section id="베르누이의-수학적-접근법" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="베르누이의-수학적-접근법"><span class="header-section-number">3</span> 베르누이의 수학적 접근법</h2>
<p>베르누이는 천연두의 역학을 이해하기 위해 두 가지 핵심 가정을 설정했다 <span class="citation" data-cites="blower2004attempt">(Blower &amp; Bernoulli, 2004)</span>:</p>
<ol type="1">
<li><p>천연두에 걸리지 않은 사람들이 매년 질병에 감염될 위험(감염률)은 연령에 관계없이 일정하다. 베르누이는 이 값을 n = 8로 설정했다(즉, 매년 감염되지 않은 사람 중 1/8이 감염된다).</p></li>
<li><p>천연두에 걸린 사람이 이 질병으로 사망할 위험(치명률)도 연령에 관계없이 일정하다. 베르누이는 이 값을 m = 8로 설정했다(즉, 감염자의 1/8이 사망한다).</p></li>
</ol>
<p>이러한 가정을 바탕으로 베르누이는 다음과 같은 미분방정식을 도출했다 <span class="citation" data-cites="dietz2002daniel">(Dietz &amp; Heesterbeek, 2002)</span>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7Bds%7D%7Bdt%7D%20=%20%5Cfrac%7Bs%7D%7Bn%7D%20-%20%5Cfrac%7Bsd%5Cpi%7D%7B%5Cpi%7D%20-%20%5Cfrac%7Bs%5E2dx%7D%7Bmn%5Cpi%7D%0A"></p>
<p>여기서: - <img src="https://latex.codecogs.com/png.latex?s">는 특정 연령에서 천연두에 걸리지 않은 사람의 수 - <img src="https://latex.codecogs.com/png.latex?%5Cpi">는 동일 연령에서 생존자 총수 - <img src="https://latex.codecogs.com/png.latex?t">는 연령(년) - <img src="https://latex.codecogs.com/png.latex?n">과 <img src="https://latex.codecogs.com/png.latex?m">은 앞서 정의한 감염률과 치명률 관련 매개변수</p>
<p>베르누이는 이 미분방정식을 적분하여 다음과 같은 해를 구했다 <span class="citation" data-cites="dietz2002daniel">(Dietz &amp; Heesterbeek, 2002)</span>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0As%20=%20%5Cfrac%7Bm%5Cpi%7D%7B(m-1)e%5E%7Bt/n%7D%20+%201%7D%0A"></p>
<p>이 방정식을 통해 베르누이는 각 연령대별로 천연두에 감염되지 않은 사람들의 비율과 천연두로 인한 사망자 수를 계산할 수 있었다 <span class="citation" data-cites="blower2004attempt">(Blower &amp; Bernoulli, 2004)</span>.</p>
</section>
<section id="베르누이의-주요-발견" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="베르누이의-주요-발견"><span class="header-section-number">4</span> 베르누이의 주요 발견</h2>
<p>베르누이는 에드먼드 할리(Edmund Halley)의 생명표를 바탕으로, 1,300명의 신생아로 시작하는 코호트 분석을 실시했다 <span class="citation" data-cites="blower2004attempt">(Blower &amp; Bernoulli, 2004)</span>. 그는 다음과 같은 주요 결과를 도출했다:</p>
<ol type="1">
<li><p><strong>천연두 제거 효과</strong>: 천연두가 완전히 제거된다면, 25세에 도달하는 사람의 수는 565명에서 644명으로 증가할 것이다 <span class="citation" data-cites="blower2004attempt">(Blower &amp; Bernoulli, 2004)</span>.</p></li>
<li><p><strong>기대수명 증가</strong>: 천연두 제거는 출생 시 기대수명을 26년 7개월에서 29년 9개월로, 약 3년 2개월 증가시킬 것이다 <span class="citation" data-cites="dietz2002daniel">(Dietz &amp; Heesterbeek, 2002)</span>.</p></li>
<li><p><strong>인두법의 임계값</strong>: 베르누이는 인두법으로 인한 사망 위험이 11% 미만이라면, 이 방법이 전체 인구에 이득이 될 것이라고 계산했다 <span class="citation" data-cites="bacaer2011smallpox">(Bacaër, 2011)</span>. 당시 인두법의 추정 사망률은 1-2%였으므로, 베르누이는 인두법을 지지하는 결론에 도달했다.</p></li>
<li><p><strong>상대적 이득</strong>: 연령이 증가함에 따라 천연두 제거의 상대적 이득이 증가하여, 25세에는 생존자 수가 자연 상태보다 약 1/7 더 많아질 것으로 예측했다 <span class="citation" data-cites="blower2004attempt">(Blower &amp; Bernoulli, 2004)</span>.</p></li>
</ol>
<p>베르누이의 분석은 인두법이 개인뿐만 아니라 사회 전체에 이익이 된다는 것을 수학적으로 증명했다. 그는 “시민 생명”(Civil Life)이라는 개념을 도입하여, 17세 이후부터 국가와 사회에 기여할 수 있는 시기에 주목했다 <span class="citation" data-cites="ioannidis2020how">(Ioannidis, 2020)</span>. 그의 계산에 따르면, 인두법의 보편적 시행으로 프랑스는 매년 25,000명의 추가적인 “유용한 시민 생명”을 얻을 수 있었다.</p>
</section>
<section id="베르누이와-달랑베르의-논쟁" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="베르누이와-달랑베르의-논쟁"><span class="header-section-number">5</span> 베르누이와 달랑베르의 논쟁</h2>
<p>베르누이의 연구는 당시 또 다른 저명한 수학자인 장 르 롱 달랑베르(Jean le Rond d’Alembert)와의 논쟁을 불러일으켰다. 달랑베르는 1761년 인두법에 관한 자신의 분석을 발표하며 베르누이의 접근법을 비판했다 <span class="citation" data-cites="ioannidis2020how">(Ioannidis, 2020)</span>.</p>
<p>달랑베르는 베르누이의 모델이 너무 단순하다고 주장했다. 그는 특히 두 가지 측면에서 비판을 제기했다 <span class="citation" data-cites="bacaer2011smallpox">(Bacaër, 2011)</span>:</p>
<ol type="1">
<li><p><strong>즉각적 위험과 미래 이익</strong>: 달랑베르는 인두법의 즉각적인 사망 위험과 미래의 잠재적 이익을 단순히 평균화하는 것에 의문을 제기했다. 그는 당장의 사망 위험과 미래의 이익을 동등하게 취급하는 것이 논리적이지 않다고 생각했다.</p></li>
<li><p><strong>개인과 사회</strong>: 달랑베르는 사회 전체에 대한 이익이 개인의 위험을 정당화하지 못할 수 있다고 주장했다. 그에게는 인두법으로 인한 즉각적 사망 위험을 감수해야 하는 개인의 관점이 중요했다.</p></li>
</ol>
<p>이 논쟁은 단순히 수학적 모델의 정확성에 관한 것이 아니라, 의학적 결정에서 위험과 이익을 평가하는 방법과 개인의 자율성 대 공중보건의 관계에 관한 깊은 철학적 질문을 제기했다 <span class="citation" data-cites="ioannidis2020how">(Ioannidis, 2020)</span>. 이는 오늘날까지도 예방접종 정책과 공중보건 윤리에서 중요한 주제로 남아있다.</p>
</section>
<section id="베르누이-연구의-역사적-의의" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="베르누이-연구의-역사적-의의"><span class="header-section-number">6</span> 베르누이 연구의 역사적 의의</h2>
<p>베르누이의 연구는 여러 측면에서 역사적 의미를 갖는다:</p>
<ol type="1">
<li><p><strong>역학의 시작</strong>: 베르누이의 모델은 역학(epidemiology)이라는 학문 분야의 수학적 기초를 마련했다 <span class="citation" data-cites="dietz2000bernoulli">(Dietz &amp; Heesterbeek, 2000)</span>. 그는 질병의 전파와 인구 동태를 수학적으로 분석하는 방법을 개척했다.</p></li>
<li><p><strong>증거 기반 의학의 선구자</strong>: 베르누이는 의학적 개입의 효과를 실증적 데이터와 수학적 분석을 통해 평가했다 <span class="citation" data-cites="fine1975ross">(Fine, 1975)</span>. 이는 현대 증거 기반 의학의 핵심 원칙을 예견한 것이었다.</p></li>
<li><p><strong>의사결정 이론</strong>: 베르누이의 분석은 불확실성 하에서의 의사결정, 위험-이익 평가 등 현대 의사결정 이론의 중요한 개념들을 도입했다 <span class="citation" data-cites="ioannidis2020how">(Ioannidis, 2020)</span>.</p></li>
<li><p><strong>공중보건 정책</strong>: 베르누이는 수학적 모델을 활용하여 공중보건 정책을 지지하는 최초의 시도를 했다 <span class="citation" data-cites="blower2004attempt">(Blower &amp; Bernoulli, 2004)</span>. 그의 연구는 현대 공중보건 정책 결정에서 모델링의 중요한 역할을 예견했다.</p></li>
</ol>
</section>
<section id="현대적-관점에서-본-베르누이의-연구" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="현대적-관점에서-본-베르누이의-연구"><span class="header-section-number">7</span> 현대적 관점에서 본 베르누이의 연구</h2>
<p>현대 역학자들은 베르누이의 연구를 재평가하며 그 가치를 재확인했다. 디츠와 히스터벡은 2000년 ’Nature’지에 “베르누이는 현대 역학보다 앞서 있었다”는 제목의 논문을 발표했다 <span class="citation" data-cites="dietz2000bernoulli">(Dietz &amp; Heesterbeek, 2000)</span>. 그들은 베르누이가 감염병의 역학에 관한 현대적 통찰을 200년 이상 앞서 제시했음을 강조했다.</p>
<p>베르누이의 모델은 오늘날의 표준에서 볼 때 단순하지만, 그의 접근 방식의 본질은 여전히 유효하다. 현대 감염병 모델링은 베르누이의 기본 틀을 확장하여 더 복잡한 요소들을 포함하고 있다 <span class="citation" data-cites="anderson1991infectious">(Anderson et al., 1991)</span>:</p>
<ol type="1">
<li>연령 의존적 감염률과 치명률</li>
<li>인구 이질성과 사회적 접촉 패턴</li>
<li>질병의 잠복기와 전염기</li>
<li>면역의 획득과 소실</li>
<li>공간적 확산 패턴</li>
</ol>
<p>이러한 발전에도 불구하고, 베르누이가 18세기에 제시한 기본적인 통찰 - 천연두와 같은 질병의 전파 역학을 이해하고 예방 접종과 같은 개입의 효과를 평가하기 위해 수학적 모델을 사용할 수 있다는 생각 - 은 현대 감염병 역학의 근간으로 남아있다 <span class="citation" data-cites="heesterbeek2015modeling">(Heesterbeek et al., 2015)</span>.</p>
</section>
<section id="결론-베르누이의-유산" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="결론-베르누이의-유산"><span class="header-section-number">8</span> 결론: 베르누이의 유산</h2>
<p>다니엘 베르누이의 천연두 연구는 단순히 역사적 호기심 이상의 가치를 지닌다. 그의 연구는 인류가 처음으로 전염병에 대항하는 과학적 도구로서 수학을 활용한 순간을 기록하고 있다 <span class="citation" data-cites="dietz2002daniel">(Dietz &amp; Heesterbeek, 2002)</span>. 베르누이의 업적은 단지 그가 발명한 수식이나 모델에 있지 않다. 그의 진정한 유산은 복잡한 공중보건 문제에 대한 해답을 찾기 위해 수학적 사고를 적용할 수 있다는 아이디어에 있다.</p>
<p>오늘날 우리가 코로나19를 비롯한 다양한 전염병에 대응하는 방식은 250년 전 베르누이가 개척한 접근법의 직계 후손이다. 그는 “인류의 복지에 밀접한 관련이 있는 문제에 있어서, 약간의 분석과 계산이 제공할 수 있는 모든 지식 없이는 어떤 결정도 내려서는 안 된다”고 주장했다 <span class="citation" data-cites="blower2004attempt">(Blower &amp; Bernoulli, 2004)</span>. 이 원칙은 현대 공중보건의 핵심 가치로 남아있다.</p>
<p>베르누이의 연구는 우리에게 수학은 단순한 추상적 학문이 아니라 생명을 구하고 사회를 보호하는 강력한 도구가 될 수 있음을 상기시킨다. 그의 선구적인 업적은 오늘날까지도 우리에게 영감을 주며, 보이지 않는 적들과의 싸움에서 인류의 가장 강력한 무기 중 하나가 바로 수학임을 보여준다.</p>
</section>
<section id="참고문헌" class="level2" data-number="9">

<!-- ```{=html} -->
<!-- <div id="refs"></div> -->
<!-- ``` -->



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">9 참고문헌</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2">
<div id="ref-anderson1991infectious" class="csl-entry">
Anderson, R. M., May, R. M., &amp; Anderson, B. (1991). <em>Infectious diseases of humans: Dynamics and control</em>. Oxford university press.
</div>
<div id="ref-bacaer2011smallpox" class="csl-entry">
Bacaër, N. (2011). Daniel bernoulli, d’alembert and the inoculation of smallpox (1760). <em>A Short History of Mathematical Population Dynamics</em>, 21–30.
</div>
<div id="ref-bernoulli1766essai" class="csl-entry">
Bernoulli, D. (1766). Essai d’une nouvelle analyse de la mortalit<span>é</span> caus<span>é</span>e par la petite v<span>é</span>role et des avantages de l’inoculation pour la pr<span>é</span>venir. <em>M<span>é</span>moires de Math<span>é</span>matiques Et de Physique, Acad<span>é</span>mie Royale Des Sciences, Paris</em>, 1–45.
</div>
<div id="ref-blower2004attempt" class="csl-entry">
Blower, S., &amp; Bernoulli, D. (2004). An attempt at a new analysis of the mortality caused by smallpox and of the advantages of inoculation to prevent it. 1766. <em>Reviews in Medical Virology</em>, <em>14</em>(5), 275–288.
</div>
<div id="ref-dietz2000bernoulli" class="csl-entry">
Dietz, K., &amp; Heesterbeek, J. (2000). Bernoulli was ahead of modern epidemiology. <em>Nature</em>, <em>408</em>(6812), 513–514.
</div>
<div id="ref-dietz2002daniel" class="csl-entry">
Dietz, K., &amp; Heesterbeek, J. (2002). Daniel bernoulli’s epidemiological model revisited. <em>Mathematical Biosciences</em>, <em>180</em>(1-2), 1–21.
</div>
<div id="ref-fine1975ross" class="csl-entry">
Fine, P. E. (1975). Ross’s a priori pathometry - a perspective. <em>Proceedings of the Royal Society of Medicine</em>, <em>68</em>(8), 547–551.
</div>
<div id="ref-heesterbeek2015modeling" class="csl-entry">
Heesterbeek, H., Anderson, R. M., Andreasen, V., Bansal, S., De Angelis, D., Dye, C., Eames, K. T., Edmunds, W. J., Frost, S. D., Funk, S., et al. (2015). Modeling infectious disease dynamics in the complex landscape of global health. <em>Science</em>, <em>347</em>(6227).
</div>
<div id="ref-ioannidis2020how" class="csl-entry">
Ioannidis, E. (2020). How history of mathematics can help to face a crisis situation: The case of the polemic between bernoulli and d’alembert about the smallpox epidemic. <em>ZDM Mathematics Education</em>, <em>54</em>, 569–581.
</div>
<div id="ref-razzell1977conquest" class="csl-entry">
Razzell, P. E. (1977). <em>The conquest of smallpox: The impact of inoculation on smallpox mortality in eighteenth century britain</em>. Caliban Books.
</div>
<div id="ref-straub1970bernoulli" class="csl-entry">
Straub, H. (1970). Bernoulli, daniel. <em>Dictionary of Scientific Biography</em>, <em>2</em>, 36–46.
</div>
</div></section></div> ]]></description>
  <category>감염병</category>
  <category>수리모형</category>
  <category>역학</category>
  <category>역사</category>
  <guid>https://www.jonghoonk.com/blog/posts/book_bernoulli_math_model_smallpox/index.html</guid>
  <pubDate>Mon, 05 May 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>왜 수학으로 감염병을 설명하는가?</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/book_math_model_why_kor/index.html</link>
  <description><![CDATA[ 



<section id="왜-수학으로-감염병을-설명하는가" class="level1">
<h1>왜 수학으로 감염병을 설명하는가?</h1>
<p>수학은 세상을 설명하는 언어다. [전통적인 text. 혹은 유클리드, 아르케메데스, ] 바이러스는 숫자를 모른다. 바이러스 어떤 수식을 계산해서 다음 날 환자수를 결정하지는 않을 것이다. 그런데 우리는 바이러스의 전파 과정을 숫자로 설명한다. 왜 그럴까?</p>
<p>수식을 이용하는 방법이 세상을 이해하는 데에 꽤 괜찮다. 코로나19가 터졌을 때 사람들은 ‘하루 확진자 수’, ‘누적 감염자’, ‘감염재생산지수 (<img src="https://latex.codecogs.com/png.latex?R">)’ 같은 숫자에 민감하게 반응했다. 정부의 정책은 이 숫자들에 따라 움직였다. 한국에서는 사회적 거리두기 단계가 확진자 수에 따라 결정되었고 <span class="citation" data-cites="kimminsoo2021">(Kim et al., 2021)</span>, 영국에서는 <img src="https://latex.codecogs.com/png.latex?R">값이 1 미만으로 떨어질 때까지 봉쇄 조치를 연장했다 <span class="citation" data-cites="flaxman2020">(Flaxman et al., 2020)</span>.</p>
<p>사람을 멈춘 건 숫자였다. 아니, 숫자가 보여주는 확산의 속도였다.</p>
<p>수학은 감염병의 흐름을 시뮬레이션할 수 있고, 예측할 수 있으며, 때로는 막을 수도 있다.</p>
<p>나는 이 책에서 감염병 수리 모형이 무엇이고, 왜 중요한지, 그리고 이걸 어렵지 않게 이해할 수 있다는 사실을 보여주고 싶다.</p>
<p>지금부터 숫자와 감염병의 이야기를 시작하자.</p>
<section id="왜-이-이야기가-필요한가" class="level2">
<h2 class="anchored" data-anchor-id="왜-이-이야기가-필요한가">왜 이 이야기가 필요한가</h2>
<p>2020년 봄, 전 세계가 동시에 정지했다. 거리엔 차가 없고, 학교엔 학생이 없었다. 지구 전체가 ’사회적 거리두기’라는 말에 묶여 조용해졌다. 그 혼란 속에서 매일 뉴스는 숫자를 쏟아냈다.</p>
<p>“오늘 확진자 125명, 누적 확진자 1,532명.”<br>
“<img src="https://latex.codecogs.com/png.latex?R">값이 1.7을 넘었다.”<br>
“2주 후 중환자 병상이 부족해질 수 있다.”</p>
<p>이 숫자들은 어디서 온 걸까? 누가 계산했을까? 어떻게 그렇게 예측할 수 있었을까?</p>
<p>정답은 ’모형’이다. 수리 모형. 우리가 실제 세계의 흐름을 수식과 논리로 바꿔 표현한 것이다.</p>
<p>수학은 현실을 설명하도록 도와주는 언어다. 감염병도 예외가 아니다. 오히려 감염병은 수학과 친하다. 바이러스는 논리를 따라 움직이기 때문이다. 무작위 같지만, 아니다. 감염에는 규칙이 있다. 그리고 규칙이 있다면, 수학으로 그릴 수 있다.</p>
</section>
<section id="역사-속의-수학적-감염병-모델" class="level2">
<h2 class="anchored" data-anchor-id="역사-속의-수학적-감염병-모델">역사 속의 수학적 감염병 모델</h2>
<p>사실 수학으로 감염병을 설명하는 일은 새로운 시도가 아니다. 1760년, 스위스의 수학자 다니엘 베르누이 (Daniel Bernoulli)는 천연두 예방접종의 효과를 계산하기 위해 최초의 수학적 질병 모델을 만들었다 <span class="citation" data-cites="bernoulli1760">(Bernoulli, 1760)</span>. 그는 천연두 감염 확률과 접종의 위험성을 비교하여, 접종이 생명을 구한다는 것을 수학적으로 증명했다.</p>
<p>20세기 초에는 로널드 로스 (Ronald Ross) 가 말라리아 모델을 개발했고 <span class="citation" data-cites="ross1911">(Ross, 1911)</span>, 그 후 커맥 (Kermack)과 맥켄드릭 (McKendrick)이 지금도 널리 사용되는 SIR (Susceptible-Infected-Recovered) 모델을 제안했다 <span class="citation" data-cites="kermack1927">(Kermack &amp; McKendrick, 1927)</span>. 이 모델은 인구를 감염될 수 있는 사람(S), 이미 감염된 사람(I), 회복된 사람(R)으로 나누어 질병의 전파를 설명한다.</p>
<p>이러한 모델들은 단순하지만 강력하다. 감염병의 기본적인 특성을 파악하고, 이를 통해 미래를 예측할 수 있게 해준다.</p>
</section>
<section id="모델의-힘-눈에-보이지-않는-것을-보는-방법" class="level2">
<h2 class="anchored" data-anchor-id="모델의-힘-눈에-보이지-않는-것을-보는-방법">모델의 힘: 눈에 보이지 않는 것을 보는 방법</h2>
<p>감염병은 보이지 않는다. 감염병의 원인이 되는 바이러스가 세균은 너무 작아서 맨눈으로 볼 수 없다. 그러나 그 영향은 크고 명확하다.</p>
<p>수리 모형은 보이지 않는 것을 ‘보는’ 방법이다. 우리는 관찰된 데이터(확진자 수, 사망자 수)를 사용하여 감염의 패턴을 파악한다. 그리고 그 패턴에서 규칙을 찾아 미래를 예측한다.</p>
<p>예를 들어, 2014년 서아프리카 에볼라 유행 당시, 연구자들은 초기 확진자 데이터만으로 에볼라의 기본재생산수(<img src="https://latex.codecogs.com/png.latex?R_0">)를 추정했다 <span class="citation" data-cites="nishiura2014">(Nishiura, 2014)</span>. 이 <img src="https://latex.codecogs.com/png.latex?R_0">값 (약 1.5-2.0)을 통해 적절한 조치 없이는 유행이 확산될 것이라고 예측했고, 실제로 그렇게 되었다.</p>
<p>수리 모형은 단순한 예측을 넘어, 다양한 질문에 답할 수 있다:</p>
<ul>
<li>이 감염병은 얼마나 빠르게 퍼질까?</li>
<li>언제 정점에 도달할까?</li>
<li>어떤 통제 전략이 가장 효과적일까?</li>
<li>백신을 어떻게 배분해야 가장 많은 생명을 구할 수 있을까?</li>
</ul>
<p>이러한 질문들은 단순한 직관이나 관찰만으로는 답하기 어렵다. 수학적 모델링은 복잡한 시스템을 이해하고 분석하는 강력한 도구가 된다.</p>
</section>
<section id="코로나19-모델링의-시대" class="level2">
<h2 class="anchored" data-anchor-id="코로나19-모델링의-시대">코로나19: 모델링의 시대</h2>
<p>2020년 코로나19 팬데믹은 수리 모형의 중요성을 전 세계에 각인시켰다. 전례 없는 규모의 감염병 위기 속에서, 과학자들은 수리 모형을 사용하여 다양한 시나리오를 분석했다.</p>
<p>영국 임페리얼 칼리지의 (Imperial College) 연구진은 조기에 여러 통제 전략의 효과를 모델링했다 <span class="citation" data-cites="ferguson2020">(Ferguson et al., 2020)</span>. 그들의 예측은 충격적이었다: 아무 조치를 취하지 않으면 미국에서만 220만 명이 사망할 수 있다는 것이었다. 이 연구는 여러 국가의 봉쇄 정책 결정에 직접적인 영향을 미쳤다.</p>
<p>한국에서도 수리 모델링은 중요한 역할을 했다. 연구자들은 초기 대구 유행의 패턴을 분석하여 접촉자 추적과 사회적 거리두기의 효과를 평가했다 <span class="citation" data-cites="choi2020">(Choi &amp; Ki, 2020)</span>. 이러한 분석은 정부의 단계적 거리두기 정책 수립에 기여했다.</p>
<p>수리 모형은 완벽하지 않다. 초기 데이터의 부족, 바이러스의 특성에 대한 불확실성, 인간 행동의 예측 불가능성 등 많은 변수가 있다. 그러나 불완전함에도 불구하고, 모형은 결정적인 순간에 방향을 제시했다.</p>
</section>
<section id="모델의-언어를-배우는-이유" class="level2">
<h2 class="anchored" data-anchor-id="모델의-언어를-배우는-이유">모델의 언어를 배우는 이유</h2>
<p>“모든 모델은 틀렸지만, 일부는 유용하다” (All models are wrong, but some are useful) 라는 통계학자 조지 박스 (George Box)의 말은 유명하다 <span class="citation" data-cites="box1976">(Box, 1976)</span>. 수리 모형은 현실의 단순화된 표현이기 때문에 완벽할 수 없다. 하지만 유용한 모델은 현실에 대한 통찰력을 제공한다.</p>
<p>감염병 수리 모형을 이해하는 것은 단순히 수학적 호기심을 충족시키는 것이 아니다. 이는 공중보건 정책을 이해하고, 뉴스에서 접하는 수치를 비판적으로 평가하며, 미래의 건강 위기에 더 잘 대응하기 위한 소양이다.</p>
<p>또한, 모델링의 언어를 배우는 것은 불확실성 속에서 체계적으로 사고하는 방법을 배우는 것이다. 우리는 모든 것을 알 수 없다. 하지만 불완전한 정보 속에서도 최선의 판단을 내려야 한다. 수리 모형은 그런 판단을 도와주는 도구다.</p>
</section>
<section id="이-책의-여정" class="level2">
<h2 class="anchored" data-anchor-id="이-책의-여정">이 책의 여정</h2>
<p>이 장에서는 먼저, 우리가 왜 수학으로 감염병을 이야기하게 되었는지, 그 필요성과 배경을 짚어보았다. 코로나19는 물론이고, 그 이전과 이후의 사례까지.</p>
<p>앞으로의 장에서는 감염병 수리 모형의 기본 개념부터 시작하여, 복잡한 수리 모형과 실제 적용 사례까지 살펴볼 것이다. 수학적 배경지식이 부족하더라도 걱정하지 말자. 이 책은 수학자가 아닌 일반 독자를 위한 안내서다. 저자 또한 수학자가 아니다.</p>
<p>독자는 느낄 것이다. 이건 단순한 숫자 놀음이 아니라, 사람과 사회, 미래를 다루는 도구라는 걸. 바이러스는 숫자를 모를지 모르지만, 숫자를 아는 우리는 바이러스를 더 잘 이해하고 대응할 수 있다.</p>
</section>
<section id="참고문헌" class="level2">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">참고문헌</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2">
<div id="ref-bernoulli1760" class="csl-entry">
Bernoulli, D. (1760). Essai d’une nouvelle analyse de la mortalit<span>é</span> caus<span>é</span>e par la petite v<span>é</span>role et des avantages de l’inoculation pour la pr<span>é</span>venir. <em>M<span>é</span>moires de Math<span>é</span>matiques Et de Physique, Acad<span>é</span>mie Royale Des Sciences</em>, 1–45.
</div>
<div id="ref-box1976" class="csl-entry">
Box, G. E. (1976). Science and statistics. <em>Journal of the American Statistical Association</em>, <em>71</em>(356), 791–799.
</div>
<div id="ref-choi2020" class="csl-entry">
Choi, S., &amp; Ki, M. (2020). Estimating the reproductive number and the outbreak size of COVID-19 in korea. <em>Epidemiology and Health</em>, <em>42</em>, e2020011.
</div>
<div id="ref-ferguson2020" class="csl-entry">
Ferguson, N. M., Laydon, D., Nedjati-Gilani, G., Imai, N., Ainslie, K., Baguelin, M., Bhatia, S., Boonyasiri, A., Cucunubá, Z., Cuomo-Dannenburg, G., et al. (2020). Impact of non-pharmaceutical interventions (NPIs) to reduce COVID-19 mortality and healthcare demand. <em>Imperial College London</em>, <em>9</em>(2020.03.16).
</div>
<div id="ref-flaxman2020" class="csl-entry">
Flaxman, S., Mishra, S., Gandy, A., Unwin, H. J. T., Mellan, T. A., Coupland, H., Whittaker, C., Zhu, H., Berah, T., Eaton, J. W., et al. (2020). Estimating the effects of non-pharmaceutical interventions on COVID-19 in europe. <em>Nature</em>, <em>584</em>(7820), 257–261.
</div>
<div id="ref-kermack1927" class="csl-entry">
Kermack, W. O., &amp; McKendrick, A. G. (1927). A contribution to the mathematical theory of epidemics. <em>Proceedings of the Royal Society of London. Series A</em>, <em>115</em>(772), 700–721.
</div>
<div id="ref-kimminsoo2021" class="csl-entry">
Kim, M. S., Seong, M.-W., Kim, H. J., Cho, S. I., Kim, J., Chung, Y.-S., Lee, J.-A., Kim, N., Park, S. H., Jang, S. Y., et al. (2021). COVID-19 national emergency response center, epidemiology and case management team, korea disease control and prevention agency. Contact transmission of COVID-19 in south korea: Novel investigation techniques for tracing contacts. <em>Osong Public Health and Research Perspectives</em>, <em>12</em>(1), 60–63.
</div>
<div id="ref-nishiura2014" class="csl-entry">
Nishiura, H. (2014). Early epidemiological assessment of the virulence of emerging infectious diseases: A case study of an influenza pandemic. <em>PLoS One</em>, <em>9</em>(8), e105132.
</div>
<div id="ref-ross1911" class="csl-entry">
Ross, R. (1911). The prevention of malaria. <em>London: John Murray</em>.
</div>
</div></section></div> ]]></description>
  <guid>https://www.jonghoonk.com/blog/posts/book_math_model_why_kor/index.html</guid>
  <pubDate>Thu, 17 Apr 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>The Ross-Macdonald Framework: Foundational Mathematical Models in Vector-Borne Disease Epidemiology</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/Ross-Macdonald/index.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>The mathematical modeling of infectious diseases has become an indispensable tool in modern epidemiology, guiding intervention strategies and policy decisions. While contemporary models exhibit increasing complexity, many fundamental principles trace back to the pioneering work of Sir Ronald Ross, who established the theoretical foundation for understanding vector-borne disease transmission dynamics at the turn of the 20th century.</p>
<p>This article examines Ross’s seminal contributions to mathematical epidemiology, the subsequent refinements by George Macdonald, and how these models continue to influence contemporary approaches to vector-borne disease control. We will focus on the mathematical formulations that undergird the Ross-Macdonald framework and their implications for disease control thresholds.</p>
</section>
<section id="rosss-initial-mathematical-framework" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="rosss-initial-mathematical-framework"><span class="header-section-number">2</span> Ross’s Initial Mathematical Framework</h2>
<p>After establishing the mosquito-malaria parasite life cycle, for which he received the Nobel Prize in Medicine in 1902, Ronald Ross turned his attention to developing mathematical models to guide control strategies. His first models, published in 1908 in “Report on the Prevention of Malaria in Mauritius” <span class="citation" data-cites="ross1908report">(Ross 1908)</span> and expanded in his 1911 book “The Prevention of Malaria” <span class="citation" data-cites="ross1911prevention">(Ross 1911)</span>, represented a paradigm shift in epidemiological thinking.</p>
<p>Ross later formalized these mathematical principles in his landmark papers “Some a priori pathometric equations” <span class="citation" data-cites="ross1915some">(Ross 1915)</span> and “An application of the theory of probabilities to the study of a priori pathometry” <span class="citation" data-cites="ross1916application">(Ross 1916)</span>, which laid the groundwork for the entire field of mathematical epidemiology.</p>
<p>Ross’s initial model was remarkably straightforward yet profound. If we denote the proportion of infected humans as <img src="https://latex.codecogs.com/png.latex?p"> and the proportion of infected mosquitoes as <img src="https://latex.codecogs.com/png.latex?P">, his first model can be expressed as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bdp%7D%7Bdt%7D%20=%20abmP(1-p)%20-%20rp"> <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BdP%7D%7Bdt%7D%20=%20acp(1-P)%20-%20%5Cmu%20P"></p>
<p>Where: - <img src="https://latex.codecogs.com/png.latex?a"> represents the mosquito biting rate - <img src="https://latex.codecogs.com/png.latex?b"> is the probability of parasite transmission from mosquito to human per bite - <img src="https://latex.codecogs.com/png.latex?c"> is the probability of parasite transmission from human to mosquito per bite - <img src="https://latex.codecogs.com/png.latex?m"> is the mosquito density per human - <img src="https://latex.codecogs.com/png.latex?r"> is the human recovery rate - <img src="https://latex.codecogs.com/png.latex?%5Cmu"> is the mosquito mortality rate</p>
</section>
<section id="the-basic-reproduction-number" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-basic-reproduction-number"><span class="header-section-number">3</span> The Basic Reproduction Number</h2>
<p>Ross’s most significant contribution was demonstrating that malaria transmission could be interrupted without eliminating the entire vector population <span class="citation" data-cites="smith2007revisiting">(Smith et al. 2007)</span>. This led to the concept of a critical threshold, later formalized as the basic reproduction number <img src="https://latex.codecogs.com/png.latex?R_0">.</p>
<p>For Ross’s model, <img src="https://latex.codecogs.com/png.latex?R_0"> can be derived as:</p>
<p><img src="https://latex.codecogs.com/png.latex?R_0%20=%20%5Cfrac%7Ba%5E2bcm%7D%7B%5Cmu%20r%7D"></p>
<p>This quantity represents the expected number of secondary infections arising from a single infected individual in a completely susceptible population. When <img src="https://latex.codecogs.com/png.latex?R_0%20%3C%201">, the disease will eventually die out; when <img src="https://latex.codecogs.com/png.latex?R_0%20%3E%201">, the disease can persist in the population <span class="citation" data-cites="smith2012ross">(Smith et al. 2012)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to calculate R0 from model parameters</span></span>
<span id="cb1-2">calculate_R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a, b, c, m, mu, r) {</span>
<span id="cb1-3">  R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> m) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r)</span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(R0)</span>
<span id="cb1-5">}</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example parameter values</span></span>
<span id="cb1-8">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Biting rate (bites per day)</span></span>
<span id="cb1-9">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transmission probability: mosquito to human</span></span>
<span id="cb1-10">c <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transmission probability: human to mosquito</span></span>
<span id="cb1-11">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mosquito density per human</span></span>
<span id="cb1-12">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mosquito mortality rate</span></span>
<span id="cb1-13">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Human recovery rate</span></span>
<span id="cb1-14"></span>
<span id="cb1-15">R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_R0</span>(a, b, c, m, mu, r)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"With these parameters, R0 ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(R0, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>With these parameters, R0 = 225</code></pre>
</div>
</div>
</section>
<section id="the-macdonald-refinements" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="the-macdonald-refinements"><span class="header-section-number">4</span> The Macdonald Refinements</h2>
<p>George Macdonald expanded Ross’s work in the 1950s, incorporating additional biological complexity <span class="citation" data-cites="macdonald1952analysis">(Macdonald 1952)</span>. His key modifications included:</p>
<ol type="1">
<li>Accounting for the latent period in the mosquito (<img src="https://latex.codecogs.com/png.latex?n"> days), during which the parasite develops</li>
<li>Recognition of mosquito survival as exponential, with daily survival probability <img src="https://latex.codecogs.com/png.latex?p"></li>
</ol>
<p>Macdonald’s version of the reproduction number became:</p>
<p><img src="https://latex.codecogs.com/png.latex?R_0%20=%20%5Cfrac%7Bma%5E2bcp%5En%7D%7B-r%5Cln(p)%7D"></p>
<p>Where <img src="https://latex.codecogs.com/png.latex?-%5Cln(p)"> replaces <img src="https://latex.codecogs.com/png.latex?%5Cmu"> as the mosquito mortality rate.</p>
<p>A crucial insight from Macdonald was that malaria transmission is particularly sensitive to adult mosquito longevity, as expressed by the exponent <img src="https://latex.codecogs.com/png.latex?n"> in the equation. This led to the strategic emphasis on adult mosquito control using residual insecticides <span class="citation" data-cites="garrett1964malaria">(Garrett-Jones 1964)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Macdonald's R0 calculation</span></span>
<span id="cb3-2">calculate_macdonald_R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(m, a, b, c, p, n, r) {</span>
<span id="cb3-3">  R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>n) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(p))</span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(R0)</span>
<span id="cb3-5">}</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example parameter values</span></span>
<span id="cb3-8">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mosquito density per human</span></span>
<span id="cb3-9">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Biting rate (bites per day)</span></span>
<span id="cb3-10">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transmission probability: mosquito to human</span></span>
<span id="cb3-11">c <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transmission probability: human to mosquito</span></span>
<span id="cb3-12">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Daily mosquito survival probability</span></span>
<span id="cb3-13">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extrinsic incubation period (days)</span></span>
<span id="cb3-14">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Human recovery rate</span></span>
<span id="cb3-15"></span>
<span id="cb3-16">macdonald_R0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_macdonald_R0</span>(m, a, b, c, p, n, r)</span>
<span id="cb3-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"With Macdonald's formulation, R0 ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(macdonald_R0, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>With Macdonald's formulation, R0 = 74.46</code></pre>
</div>
</div>
</section>
<section id="equilibrium-analysis-and-threshold-conditions" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="equilibrium-analysis-and-threshold-conditions"><span class="header-section-number">5</span> Equilibrium Analysis and Threshold Conditions</h2>
<p>Ross’s mathematical analysis demonstrated that the system has two equilibrium points <span class="citation" data-cites="bailey1982biomathematics">(Bailey 1982)</span>:</p>
<ol type="1">
<li>Disease-free equilibrium: <img src="https://latex.codecogs.com/png.latex?(p,%20P)%20=%20(0,%200)"></li>
<li>Endemic equilibrium: <img src="https://latex.codecogs.com/png.latex?(p,%20P)%20=%20(p%5E*,%20P%5E*)"> where:</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?p%5E*%20=%20%5Cfrac%7BabmP%5E*%20-%20rp%5E*%7D%7BabmP%5E*%7D"> <img src="https://latex.codecogs.com/png.latex?P%5E*%20=%20%5Cfrac%7Bacp%5E*%20-%20%5Cmu%20P%5E*%7D%7Bacp%5E*%7D"></p>
<p>The stability of these equilibria depends on the value of <img src="https://latex.codecogs.com/png.latex?R_0">. When <img src="https://latex.codecogs.com/png.latex?R_0%20%3C%201">, the disease-free equilibrium is stable and the endemic equilibrium doesn’t exist. When <img src="https://latex.codecogs.com/png.latex?R_0%20%3E%201">, the disease-free equilibrium is unstable and the endemic equilibrium is stable <span class="citation" data-cites="dietz1993malaria">(Dietz, Molineaux, and Thomas 1974)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simple SIS model with vector-host interaction</span></span>
<span id="cb5-2">ross_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(time, state, parameters) {</span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(state, parameters)), {</span>
<span id="cb5-4">    dp_dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> P <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p</span>
<span id="cb5-5">    dP_dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> P) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> P</span>
<span id="cb5-6">    </span>
<span id="cb5-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(dp_dt, dP_dt)))</span>
<span id="cb5-8">  })</span>
<span id="cb5-9">}</span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parameter values</span></span>
<span id="cb5-12">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb5-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>,    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Biting rate</span></span>
<span id="cb5-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transmission probability: mosquito to human</span></span>
<span id="cb5-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transmission probability: human to mosquito</span></span>
<span id="cb5-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mosquito density per human</span></span>
<span id="cb5-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Human recovery rate</span></span>
<span id="cb5-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mosquito mortality rate</span></span>
<span id="cb5-19">)</span>
<span id="cb5-20"></span>
<span id="cb5-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initial conditions</span></span>
<span id="cb5-22">init_state <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">P =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.005</span>)</span>
<span id="cb5-23"></span>
<span id="cb5-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time points</span></span>
<span id="cb5-25">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-26"></span>
<span id="cb5-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Solve the model</span></span>
<span id="cb5-28">solution <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> init_state, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func =</span> ross_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms =</span> params)</span>
<span id="cb5-29"></span>
<span id="cb5-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb5-31">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(solution)</span>
<span id="cb5-32">results_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(results, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(p, P), </span>
<span id="cb5-33">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Compartment"</span>, </span>
<span id="cb5-34">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion"</span>)</span>
<span id="cb5-35"></span>
<span id="cb5-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot</span></span>
<span id="cb5-37"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(results_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Proportion, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Compartment)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkred"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkblue"</span>),</span>
<span id="cb5-40">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Infected Humans"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Infected Mosquitoes"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ross Model Dynamics"</span>,</span>
<span id="cb5-42">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (days)"</span>,</span>
<span id="cb5-43">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion Infected"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Ross-Macdonald/index_files/figure-html/ross-model-simulation-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="vector-control-implications" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="vector-control-implications"><span class="header-section-number">6</span> Vector Control Implications</h2>
<p>The Ross-Macdonald framework provides clear guidance on vector control strategies. From the expression for <img src="https://latex.codecogs.com/png.latex?R_0">, we can derive critical thresholds for various control parameters <span class="citation" data-cites="smith2014recasting">(Smith et al. 2014)</span>. For example, the critical mosquito density <img src="https://latex.codecogs.com/png.latex?m_c"> below which transmission cannot be sustained is:</p>
<p><img src="https://latex.codecogs.com/png.latex?m_c%20=%20%5Cfrac%7B%5Cmu%20r%7D%7Ba%5E2bc%7D"></p>
<p>Similarly, the required efficacy of insecticides to achieve control can be calculated. If we denote the proportional reduction in mosquito density as <img src="https://latex.codecogs.com/png.latex?%5CDelta%20m">, then for disease elimination:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5CDelta%20m%20%3E%201%20-%20%5Cfrac%7B1%7D%7BR_0%7D"></p>
<p>This concept is directly related to the herd immunity threshold in direct transmission diseases <span class="citation" data-cites="fine1981herd">(Fine 1993)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate critical mosquito density</span></span>
<span id="cb6-2">calculate_critical_m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a, b, c, mu, r) {</span>
<span id="cb6-3">  m_c <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c)</span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(m_c)</span>
<span id="cb6-5">}</span>
<span id="cb6-6"></span>
<span id="cb6-7">m_c <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_critical_m</span>(a, b, c, mu, r)</span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Critical mosquito density (m_c) ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(m_c, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mosquitoes per human</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Critical mosquito density (m_c) = 0.04 mosquitoes per human</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate required control effectiveness</span></span>
<span id="cb8-2">required_control <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R0)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Required proportional reduction in mosquito density ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(required_control, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Required proportional reduction in mosquito density = 99.56 %</code></pre>
</div>
</div>
</section>
<section id="sensitivity-analysis" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="sensitivity-analysis"><span class="header-section-number">7</span> Sensitivity Analysis</h2>
<p>A key insight from the Ross-Macdonald framework is the differential sensitivity of <img src="https://latex.codecogs.com/png.latex?R_0"> to various parameters. This can be formally analyzed through partial derivatives or elasticity analysis <span class="citation" data-cites="brady2016vectorial">(Brady et al. 2016)</span>.</p>
<p>For example, the elasticity of <img src="https://latex.codecogs.com/png.latex?R_0"> with respect to parameter <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?E_%7B%5Ctheta%7D%20=%20%5Cfrac%7B%5Ctheta%7D%7BR_0%7D%20%5Cfrac%7B%5Cpartial%20R_0%7D%7B%5Cpartial%20%5Ctheta%7D"></p>
<p>For the mosquito mortality rate <img src="https://latex.codecogs.com/png.latex?%5Cmu">, this becomes:</p>
<p><img src="https://latex.codecogs.com/png.latex?E_%7B%5Cmu%7D%20=%20-1"></p>
<p>This indicates that a 1% increase in mosquito mortality leads to approximately a 1% decrease in <img src="https://latex.codecogs.com/png.latex?R_0">.</p>
<p>For the parameter <img src="https://latex.codecogs.com/png.latex?a"> (biting rate), the elasticity is:</p>
<p><img src="https://latex.codecogs.com/png.latex?E_a%20=%202"></p>
<p>This reflects Macdonald’s important observation that interventions targeting mosquito biting behavior have a squared effect on transmission, since <img src="https://latex.codecogs.com/png.latex?a"> appears as <img src="https://latex.codecogs.com/png.latex?a%5E2"> in the <img src="https://latex.codecogs.com/png.latex?R_0"> expression <span class="citation" data-cites="smith2012ross">(Smith et al. 2012)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to calculate elasticity for different parameters</span></span>
<span id="cb10-2">calculate_elasticities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(a, b, c, m, mu, r) {</span>
<span id="cb10-3">  E_a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Elasticity for biting rate</span></span>
<span id="cb10-4">  E_b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Elasticity for transmission probability (mosquito to human)</span></span>
<span id="cb10-5">  E_c <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Elasticity for transmission probability (human to mosquito)</span></span>
<span id="cb10-6">  E_m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Elasticity for mosquito density</span></span>
<span id="cb10-7">  E_mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Elasticity for mosquito mortality rate</span></span>
<span id="cb10-8">  E_r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Elasticity for human recovery rate</span></span>
<span id="cb10-9">  </span>
<span id="cb10-10">  elasticities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb10-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Parameter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Biting rate (a)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transmission: mosquito→human (b)"</span>, </span>
<span id="cb10-12">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transmission: human→mosquito (c)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mosquito density (m)"</span>,</span>
<span id="cb10-13">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mosquito mortality (μ)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Human recovery rate (r)"</span>),</span>
<span id="cb10-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Elasticity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(E_a, E_b, E_c, E_m, E_mu, E_r)</span>
<span id="cb10-15">  )</span>
<span id="cb10-16">  </span>
<span id="cb10-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(elasticities)</span>
<span id="cb10-18">}</span>
<span id="cb10-19"></span>
<span id="cb10-20">elasticities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_elasticities</span>(a, b, c, m, mu, r)</span>
<span id="cb10-21">elasticities</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                         Parameter Elasticity
1                  Biting rate (a)          2
2 Transmission: mosquito→human (b)          1
3 Transmission: human→mosquito (c)          1
4             Mosquito density (m)          1
5           Mosquito mortality (μ)         -1
6          Human recovery rate (r)         -1</code></pre>
</div>
</div>
</section>
<section id="contemporary-extensions-and-applications" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="contemporary-extensions-and-applications"><span class="header-section-number">8</span> Contemporary Extensions and Applications</h2>
<p>While the Ross-Macdonald framework remains foundational, modern approaches have extended these models in several directions <span class="citation" data-cites="reiner2013systematic mandal2011mathematical">(Reiner et al. 2013; Mandal, Sarkar, and Sinha 2011)</span>:</p>
<ol type="1">
<li><strong>Spatial heterogeneity</strong>: Incorporating spatial structure and human mobility</li>
<li><strong>Stochasticity</strong>: Accounting for random events, particularly important near elimination</li>
<li><strong>Vector bionomics</strong>: More detailed entomological parameters</li>
<li><strong>Immunity dynamics</strong>: Accounting for acquired immunity in human populations</li>
<li><strong>Drug resistance</strong>: Modeling the spread of antimalarial resistance</li>
</ol>
<p>The mathematical expression for <img src="https://latex.codecogs.com/png.latex?R_0"> in these more complex models becomes correspondingly more intricate. For example, in a spatial metapopulation model with <img src="https://latex.codecogs.com/png.latex?n"> patches, <img src="https://latex.codecogs.com/png.latex?R_0"> can be expressed as the dominant eigenvalue of the next-generation matrix:</p>
<p><img src="https://latex.codecogs.com/png.latex?R_0%20=%20%5Crho(FV%5E%7B-1%7D)"></p>
<p>Where <img src="https://latex.codecogs.com/png.latex?F"> represents new infections and <img src="https://latex.codecogs.com/png.latex?V"> represents transitions between compartments.</p>
</section>
<section id="practical-applications-in-disease-control-programs" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="practical-applications-in-disease-control-programs"><span class="header-section-number">9</span> Practical Applications in Disease Control Programs</h2>
<p>The threshold concept derived from Ross’s work remains central to modern malaria control programs <span class="citation" data-cites="smith2007revisiting">(Smith et al. 2007)</span>. The World Health Organization’s Global Technical Strategy for Malaria 2016-2030 implicitly relies on these mathematical principles when setting targets for vector control coverage and intervention effectiveness.</p>
<p>Key applications include:</p>
<ol type="1">
<li><strong>Indoor residual spraying (IRS)</strong>: Targeting the adult mosquito longevity parameter</li>
<li><strong>Insecticide-treated nets (ITNs)</strong>: Affecting both mosquito mortality and biting rate</li>
<li><strong>Larval source management</strong>: Reducing the mosquito density parameter <img src="https://latex.codecogs.com/png.latex?m"></li>
</ol>
<p>Mathematical models help quantify the coverage levels required for these interventions to bring <img src="https://latex.codecogs.com/png.latex?R_0"> below 1 <span class="citation" data-cites="brady2016vectorial">(Brady et al. 2016)</span>.</p>
</section>
<section id="discussion" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="discussion"><span class="header-section-number">10</span> Discussion</h2>
<p>Ross’s mathematical insights have withstood the test of time remarkably well. The threshold concept, formalized as <img src="https://latex.codecogs.com/png.latex?R_0">, remains central to infectious disease epidemiology across all pathogens, not just vector-borne diseases.</p>
<p>Modern computational capabilities allow for increasingly complex simulations, but the core mathematical principles established by Ross <span class="citation" data-cites="ross1911prevention">(Ross 1911)</span> and refined by Macdonald <span class="citation" data-cites="macdonald1952analysis">(Macdonald 1952)</span> continue to guide our understanding of transmission dynamics. The elegance of these models lies in their ability to capture essential dynamics with relatively simple formulations.</p>
<p>As we face challenges like climate change, insecticide resistance, and drug resistance, these mathematical frameworks are being adapted to address increasingly complex scenarios <span class="citation" data-cites="smith2014recasting">(Smith et al. 2014)</span>. Yet the threshold principle - that disease transmission can be interrupted without eliminating every vector - remains a profound insight that continues to guide public health strategies worldwide.</p>
</section>
<section id="references" class="level2" data-number="11">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">11 References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bailey1982biomathematics" class="csl-entry">
Bailey, Norman TJ. 1982. <span>“The Biomathematics of Malaria.”</span> <em>Mathematics in Medicine and Biology</em> 2 (4).
</div>
<div id="ref-brady2016vectorial" class="csl-entry">
Brady, Oliver J, H Charles J Godfray, Andrew J Tatem, Peter W Gething, Justin M Cohen, F Ellis McKenzie, T Alex Perkins, et al. 2016. <span>“Vectorial Capacity and Vector Control: Reconsidering Sensitivity to Parameters for Malaria Elimination.”</span> <em>Transactions of the Royal Society of Tropical Medicine and Hygiene</em> 110 (2): 107–17. <a href="https://doi.org/10.1093/trstmh/trv113">https://doi.org/10.1093/trstmh/trv113</a>.
</div>
<div id="ref-dietz1993malaria" class="csl-entry">
Dietz, Klaus, Louis Molineaux, and Anthony Thomas. 1974. <span>“A Malaria Model Tested in the African Savannah.”</span> <em>Bulletin of the World Health Organization</em> 50 (3-4): 347–57.
</div>
<div id="ref-fine1981herd" class="csl-entry">
Fine, Paul EM. 1993. <span>“Herd Immunity: History, Theory, Practice.”</span> <em>Epidemiologic Reviews</em> 15 (2): 265–302.
</div>
<div id="ref-garrett1964malaria" class="csl-entry">
Garrett-Jones, C. 1964. <span>“Malaria Eradication and Control from a Global Standpoint.”</span> <em>Journal of Medical Entomology</em> 1 (4): 353–65.
</div>
<div id="ref-macdonald1952analysis" class="csl-entry">
Macdonald, George. 1952. <span>“The Analysis of Equilibrium in Malaria.”</span> <em>Tropical Diseases Bulletin</em> 49 (9): 813–29.
</div>
<div id="ref-mandal2011mathematical" class="csl-entry">
Mandal, Sandip, Ram Rup Sarkar, and Somdatta Sinha. 2011. <span>“Mathematical Models of Malaria-a Review.”</span> <em>Malaria Journal</em> 10 (1): 1–19. <a href="https://doi.org/10.1186/1475-2875-10-202">https://doi.org/10.1186/1475-2875-10-202</a>.
</div>
<div id="ref-reiner2013systematic" class="csl-entry">
Reiner, Robert C, T Alex Perkins, Christopher M Barker, Tianchan Niu, Luis Fernando Chaves, Alicia M Ellis, Dylan B George, et al. 2013. <span>“A Systematic Review of Mathematical Models of Mosquito-Borne Pathogen Transmission: 1970–2010.”</span> <em>Journal of the Royal Society Interface</em> 10 (81): 20120921. <a href="https://doi.org/10.1098/rsif.2012.0921">https://doi.org/10.1098/rsif.2012.0921</a>.
</div>
<div id="ref-ross1908report" class="csl-entry">
Ross, Ronald. 1908. <em>Report on the Prevention of Malaria in Mauritius</em>. London: Waterlow &amp; Sons Limited.
</div>
<div id="ref-ross1911prevention" class="csl-entry">
———. 1911. <em>The Prevention of Malaria</em>. London: John Murray.
</div>
<div id="ref-ross1915some" class="csl-entry">
———. 1915. <span>“Some a Priori Pathometric Equations.”</span> <em>British Medical Journal</em> 1 (2830): 546–47.
</div>
<div id="ref-ross1916application" class="csl-entry">
———. 1916. <span>“An Application of the Theory of Probabilities to the Study of a Priori Pathometry. Part i.”</span> <em>Proceedings of the Royal Society of London. Series A</em> 92 (638): 204–30.
</div>
<div id="ref-smith2012ross" class="csl-entry">
Smith, David L, Katherine E Battle, Simon I Hay, Christopher M Barker, Thomas W Scott, and F Ellis McKenzie. 2012. <span>“Ross, Macdonald, and a Theory for the Dynamics and Control of Mosquito-Transmitted Pathogens.”</span> <em>PLOS Pathogens</em> 8 (4): e1002588. <a href="https://doi.org/10.1371/journal.ppat.1002588">https://doi.org/10.1371/journal.ppat.1002588</a>.
</div>
<div id="ref-smith2007revisiting" class="csl-entry">
Smith, David L, F Ellis McKenzie, Robert W Snow, and Simon I Hay. 2007. <span>“Revisiting the Basic Reproductive Number for Malaria and Its Implications for Malaria Control.”</span> <em>PLOS Biology</em> 5 (3): e42. <a href="https://doi.org/10.1371/journal.pbio.0050042">https://doi.org/10.1371/journal.pbio.0050042</a>.
</div>
<div id="ref-smith2014recasting" class="csl-entry">
Smith, David L, T Alex Perkins, Robert C Reiner, Christopher M Barker, Tianchan Niu, Luis Fernando Chaves, Alicia M Ellis, et al. 2014. <span>“Recasting the Theory of Mosquito-Borne Pathogen Transmission Dynamics and Control.”</span> <em>Transactions of the Royal Society of Tropical Medicine and Hygiene</em> 108 (4): 185–97. <a href="https://doi.org/10.1093/trstmh/tru026">https://doi.org/10.1093/trstmh/tru026</a>.
</div>
</div></section></div> ]]></description>
  <guid>https://www.jonghoonk.com/blog/posts/Ross-Macdonald/index.html</guid>
  <pubDate>Wed, 16 Apr 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>The Birth of Epidemic Modeling: Daniel Bernoulli and the Smallpox Inoculation Controversy</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/Daniel_Bernoulli/index.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>Mathematical modeling of infectious diseases is now a cornerstone of public health decision-making. During COVID-19, we all became familiar with concepts like “flattening the curve” and reproduction numbers. But did you know that the first mathematical model for infectious disease control was developed nearly 300 years ago? In 1760, a Swiss mathematician named Daniel Bernoulli created a revolutionary approach to evaluate a controversial medical procedure: smallpox inoculation <span class="citation" data-cites="bernoulli1766">(Bernoulli 1766)</span>. His work represents the birth of what we now call mathematical epidemiology <span class="citation" data-cites="dietz2002bernoulli">(Dietz and Heesterbeek 2002)</span>.</p>
</section>
<section id="who-was-daniel-bernoulli" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="who-was-daniel-bernoulli"><span class="header-section-number">2</span> Who Was Daniel Bernoulli?</h2>
<p>Daniel Bernoulli (1700-1782) came from a family of brilliant mathematicians. While his relatives focused on pure mathematics, Daniel pursued medicine alongside his mathematical studies <span class="citation" data-cites="hald2003history">(Hald 2003)</span>. This unique combination placed him perfectly to bridge these two worlds when a major public health controversy erupted in 18th century Europe.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jonghoonk.com/blog/posts/Daniel_Bernoulli/https:/upload.wikimedia.org/wikipedia/commons/b/b3/Daniel_Bernoulli_by_Johann_Rudolf_Huber.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Daniel Bernoulli</figcaption>
</figure>
</div>
</section>
<section id="the-smallpox-crisis" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-smallpox-crisis"><span class="header-section-number">3</span> The Smallpox Crisis</h2>
<p>Today, we celebrate smallpox as the first human disease to be completely eradicated through vaccination. But in Bernoulli’s time, smallpox was a devastating illness that:</p>
<ul>
<li>Killed approximately 400,000 Europeans annually</li>
<li>Caused death in 1 out of every 7-10 infected individuals</li>
<li>Left survivors permanently scarred and sometimes blind</li>
<li>Affected nearly everyone, with most contracting it during childhood</li>
</ul>
</section>
<section id="the-controversial-solution-variolation" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="the-controversial-solution-variolation"><span class="header-section-number">4</span> The Controversial Solution: Variolation</h2>
<p>In the early 18th century, a precursor to vaccination called “variolation” (or inoculation) was introduced to Europe <span class="citation" data-cites="blower2004attempt">(Blower and Bernoulli 2004)</span>. This procedure involved:</p>
<ol type="1">
<li>Taking a small amount of pus from a person with a mild case of smallpox</li>
<li>Inserting it under the skin of a healthy person</li>
<li>Inducing a usually milder form of the disease</li>
<li>Conferring lifelong immunity if the person survived</li>
</ol>
<p>This technique reduced the mortality rate from smallpox from about 15% to approximately 1-2%. However, it was extremely controversial because:</p>
<ul>
<li>It deliberately infected healthy people with a deadly disease</li>
<li>Some people died from the procedure itself</li>
<li>Inoculated individuals could spread smallpox to others</li>
<li>Religious and ethical objections were raised against “interfering with God’s will”</li>
</ul>
</section>
<section id="bernoullis-breakthrough-the-first-disease-model" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="bernoullis-breakthrough-the-first-disease-model"><span class="header-section-number">5</span> Bernoulli’s Breakthrough: The First Disease Model</h2>
<p>Bernoulli recognized that this controversy needed more than opinions—it needed data and mathematical analysis. In 1760, he presented his work “Essai d’une nouvelle analyse de la mortalité causée par la petite vérole” (Essay on a new analysis of the mortality caused by smallpox) to the Royal Academy of Sciences in Paris <span class="citation" data-cites="bernoulli1766">(Bernoulli 1766)</span>.</p>
<p>His approach was revolutionary because:</p>
<ol type="1">
<li>It was the first mathematical model specifically designed to evaluate a public health intervention</li>
<li>It separated the risk of dying from smallpox from other causes of death</li>
<li>It calculated potential years of life gained through inoculation</li>
<li>It used real demographic data from the city of London</li>
</ol>
</section>
<section id="the-model-explained-simply" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="the-model-explained-simply"><span class="header-section-number">6</span> The Model Explained Simply</h2>
<p>Bernoulli’s approach can be understood through a simple analogy:</p>
<p>Imagine 1,000 children born in the same year. Without inoculation, these children face two risks as they age: - The risk of contracting and possibly dying from smallpox - The risk of dying from any other cause</p>
<p>Bernoulli used available data to estimate: - How many people would get smallpox each year - How many would die from it - How many would die from other causes</p>
<p>He then compared this natural scenario with one where everyone was inoculated against smallpox. Although inoculation carried its own small risk of death, Bernoulli’s calculations showed that widespread inoculation would:</p>
<ul>
<li>Increase life expectancy by about 3 years (significant for that time period)</li>
<li>Save thousands of lives across a population</li>
</ul>
</section>
<section id="mathematical-innovation-the-life-table-approach" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="mathematical-innovation-the-life-table-approach"><span class="header-section-number">7</span> Mathematical Innovation: The Life Table Approach</h2>
<p>Bernoulli’s work was mathematically innovative because he:</p>
<ol type="1">
<li>Created what we now call a “dynamic life table” - tracking population changes over time</li>
<li>Separated specific causes of death (what epidemiologists now call “competing risks”)</li>
<li>Introduced differential equations to model population changes due to disease <span class="citation" data-cites="dietz2002bernoulli">(Dietz and Heesterbeek 2002)</span></li>
</ol>
<p>In modern mathematical notation, his core equation looked something like:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bdp(a)%7D%7Bda%7D%20=%20-%5Cmu(a)p(a)%20-%20%5Clambda%20p_s(a)"></p>
<p>Where: - <img src="https://latex.codecogs.com/png.latex?p(a)"> represents the proportion of people surviving to age <img src="https://latex.codecogs.com/png.latex?a"> - <img src="https://latex.codecogs.com/png.latex?%5Cmu(a)"> is the force of mortality from causes other than smallpox - <img src="https://latex.codecogs.com/png.latex?%5Clambda"> is the rate of smallpox infection - <img src="https://latex.codecogs.com/png.latex?p_s(a)"> is the proportion of susceptible people at age <img src="https://latex.codecogs.com/png.latex?a"></p>
<p>While this may look intimidating, the concept is straightforward: Bernoulli tracked how many people would die from different causes under different scenarios <span class="citation" data-cites="heesterbeek1996oxford">(J. A. P. Heesterbeek and Dietz 1996)</span>.</p>
</section>
<section id="impact-and-legacy" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="impact-and-legacy"><span class="header-section-number">8</span> Impact and Legacy</h2>
<p>Bernoulli’s mathematical analysis had profound effects:</p>
<ol type="1">
<li><p><strong>Quantified benefits</strong>: He showed that inoculation would increase life expectancy by approximately 3 years - remarkable in an era when life expectancy was around 30 years <span class="citation" data-cites="blower2004attempt">(Blower and Bernoulli 2004)</span>.</p></li>
<li><p><strong>Risk comparison</strong>: He demonstrated that the 1-2% risk of death from inoculation was far smaller than the lifetime risk of dying from natural smallpox infection.</p></li>
<li><p><strong>Policy influence</strong>: His work helped shift public opinion and policy toward accepting inoculation as a worthwhile public health measure.</p></li>
<li><p><strong>Methodological innovation</strong>: He established mathematical modeling as a valid approach to public health questions <span class="citation" data-cites="hethcote2000mathematics">(Hethcote 2000)</span>.</p></li>
</ol>
</section>
<section id="the-birth-of-mathematical-epidemiology" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="the-birth-of-mathematical-epidemiology"><span class="header-section-number">9</span> The Birth of Mathematical Epidemiology</h2>
<p>Bernoulli’s approach contained the seeds of modern infectious disease modeling:</p>
<ul>
<li>It used mathematics to predict disease outcomes</li>
<li>It quantified the impact of interventions</li>
<li>It separated competing causes of death</li>
<li>It estimated population-level effects from individual risks</li>
</ul>
<p>The field that Bernoulli pioneered would later be expanded by other mathematical innovators like Ronald Ross <span class="citation" data-cites="ross1908report ross1911prevention">(Ross 1908, 1911)</span> and the team of Kermack and McKendrick <span class="citation" data-cites="kermack1927contribution">(Kermack and McKendrick 1927)</span>, eventually leading to the sophisticated models we use today <span class="citation" data-cites="anderson1991infectious">(Anderson and May 1991)</span>.</p>
</section>
<section id="modern-applications-of-bernoullis-approach" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="modern-applications-of-bernoullis-approach"><span class="header-section-number">10</span> Modern Applications of Bernoulli’s Approach</h2>
<p>The principles Bernoulli established are still used to answer questions like:</p>
<ul>
<li>How many lives will a new vaccine save? <span class="citation" data-cites="ferguson2006strategies">(Ferguson et al. 2006)</span></li>
<li>Is a screening program worth its costs?</li>
<li>Which age groups should receive priority for limited medical resources?</li>
<li>What is the optimal strategy for controlling an epidemic? <span class="citation" data-cites="riley2003transmission">(Riley et al. 2003)</span></li>
</ul>
<p>Modern epidemic models have incorporated additional mathematical sophistication, particularly around the concept of the basic reproduction number (R₀) and the construction of next-generation matrices <span class="citation" data-cites="diekmann2010construction wallinga2007generation">(Diekmann, Heesterbeek, and Roberts 2010; Wallinga and Lipsitch 2007)</span>, but they still follow Bernoulli’s fundamental approach of using mathematics to guide public health decisions.</p>
</section>
<section id="conclusion" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">11</span> Conclusion</h2>
<p>Daniel Bernoulli’s 1760 smallpox model represents a pivotal moment in the history of public health <span class="citation" data-cites="bernoulli1766">(Bernoulli 1766)</span>. By applying mathematical reasoning to a contentious medical issue, he demonstrated that data and analysis could guide decisions more effectively than opinions alone.</p>
<p>As we continue to face infectious disease challenges in the modern world, from emerging pathogens to vaccine hesitancy, Bernoulli’s approach remains relevant <span class="citation" data-cites="keeling2008modeling">(Keeling and Rohani 2008)</span>. His work reminds us that mathematical modeling is not just an academic exercise but a powerful tool for saving lives and informing policy.</p>
<p>The next time you hear about disease models predicting the course of an epidemic or evaluating the impact of interventions, remember that this approach began with a mathematician applying his skills to a pressing public health problem nearly three centuries ago <span class="citation" data-cites="heesterbeek2015mathematical">(H. Heesterbeek and Roberts 2015)</span>.</p>
</section>
<section id="references" class="level2" data-number="12">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">12 References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-anderson1991infectious" class="csl-entry">
Anderson, Roy M., and Robert M. May. 1991. <span>“Infectious Diseases of Humans: Dynamics and Control.”</span> <em>Oxford University Press</em>.
</div>
<div id="ref-bernoulli1766" class="csl-entry">
Bernoulli, Daniel. 1766. <span>“Essai d’une Nouvelle Analyse de La Mortalit<span>é</span> Caus<span>é</span>e Par La Petite v<span>é</span>role.”</span> <em>M<span>é</span>moires de Math<span>é</span>matiques Et de Physique, Acad<span>é</span>mie Royale Des Sciences</em>, 1–45.
</div>
<div id="ref-blower2004attempt" class="csl-entry">
Blower, Sally, and Daniel Bernoulli. 2004. <span>“An Attempt at a New Analysis of the Mortality Caused by Smallpox and of the Advantages of Inoculation to Prevent It.”</span> <em>Reviews in Medical Virology</em> 14 (5): 275–88.
</div>
<div id="ref-diekmann2010construction" class="csl-entry">
Diekmann, Odo, J. A. P. Heesterbeek, and Michael G. Roberts. 2010. <span>“The Construction of Next-Generation Matrices for Compartmental Epidemic Models.”</span> <em>Journal of the Royal Society Interface</em> 7 (47): 873–85.
</div>
<div id="ref-dietz2002bernoulli" class="csl-entry">
Dietz, Klaus, and J. A. P. Heesterbeek. 2002. <span>“Daniel Bernoulli’s Epidemiological Model Revisited.”</span> <em>Mathematical Biosciences</em> 180 (1-2): 1–21.
</div>
<div id="ref-ferguson2006strategies" class="csl-entry">
Ferguson, Neil M., Derek A. T. Cummings, Christophe Fraser, James C. Cajka, Philip C. Cooley, and Donald S. Burke. 2006. <span>“Strategies for Mitigating an Influenza Pandemic.”</span> <em>Nature</em> 442 (7101): 448–52.
</div>
<div id="ref-hald2003history" class="csl-entry">
Hald, Anders. 2003. <em>History of Probability and Statistics and Their Applications Before 1750</em>. Hoboken, NJ: John Wiley &amp; Sons.
</div>
<div id="ref-heesterbeek2015mathematical" class="csl-entry">
Heesterbeek, Hans, and Mick G. Roberts. 2015. <span>“How Mathematical Epidemiology Became a Field of Biology: A Commentary on Anderson and May (1981) ’the Population Dynamics of Microparasites and Their Invertebrate Hosts’.”</span> <em>Philosophical Transactions of the Royal Society B</em> 370 (1666): 20140307.
</div>
<div id="ref-heesterbeek1996oxford" class="csl-entry">
Heesterbeek, J. A. P., and Klaus Dietz. 1996. <span>“Mathematical Epidemiology of Infectious Diseases: Model Building, Analysis and Interpretation.”</span> <em>Mathematical Biosciences</em> 146 (1): 77–79.
</div>
<div id="ref-hethcote2000mathematics" class="csl-entry">
Hethcote, Herbert W. 2000. <span>“The Mathematics of Infectious Diseases.”</span> <em>SIAM Review</em> 42 (4): 599–653.
</div>
<div id="ref-keeling2008modeling" class="csl-entry">
Keeling, Matt J., and Pejman Rohani. 2008. <span>“Modeling Infectious Diseases in Humans and Animals.”</span> <em>Princeton University Press</em>.
</div>
<div id="ref-kermack1927contribution" class="csl-entry">
Kermack, William O., and Anderson G. McKendrick. 1927. <span>“A Contribution to the Mathematical Theory of Epidemics.”</span> <em>Proceedings of the Royal Society of London. Series A</em> 115 (772): 700–721.
</div>
<div id="ref-riley2003transmission" class="csl-entry">
Riley, Steven, Christophe Fraser, Christl A. Donnelly, Azra C. Ghani, Laith J. Abu-Raddad, Anthony J. Hedley, Gabriel M. Leung, et al. 2003. <span>“Transmission Dynamics of the Etiological Agent of SARS in Hong Kong: Impact of Public Health Interventions.”</span> <em>Science</em> 300 (5627): 1961–66.
</div>
<div id="ref-ross1908report" class="csl-entry">
Ross, Ronald. 1908. <span>“Report on the Prevention of Malaria in Mauritius.”</span>
</div>
<div id="ref-ross1911prevention" class="csl-entry">
———. 1911. <em>The Prevention of Malaria</em>. London: John Murray.
</div>
<div id="ref-wallinga2007generation" class="csl-entry">
Wallinga, Jacco, and Marc Lipsitch. 2007. <span>“How Generation Intervals Shape the Relationship Between Growth Rates and Reproductive Numbers.”</span> <em>Proceedings of the Royal Society B: Biological Sciences</em> 274 (1609): 599–604.
</div>
</div></section></div> ]]></description>
  <guid>https://www.jonghoonk.com/blog/posts/Daniel_Bernoulli/index.html</guid>
  <pubDate>Sun, 13 Apr 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Regularization in statistical models</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/regularization/index.html</link>
  <description><![CDATA[ 



<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(recipes)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span></code></pre></div>
</details>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Regularization is a fundamental technique in statistical modeling that helps prevent overfitting and improves model generalization. This blog post explores different regularization methods, their implementation in R, and their practical applications, with a special focus on scenarios where the number of parameters exceeds the number of observations (p &gt; n).</p>
</section>
<section id="understanding-regularization" class="level2">
<h2 class="anchored" data-anchor-id="understanding-regularization">Understanding Regularization</h2>
<p>Regularization works by adding a penalty term to the model’s loss function, effectively constraining the magnitude of model coefficients. The three most common types are:</p>
<ol type="1">
<li>Ridge (L2)</li>
<li>Lasso (L1)</li>
<li>Elastic Net (combination of L1 and L2)</li>
</ol>
</section>
<section id="simulation-study-when-p-n" class="level2">
<h2 class="anchored" data-anchor-id="simulation-study-when-p-n">Simulation Study: When p &gt; n</h2>
<p>Let’s first create a scenario where we have more parameters than observations:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate synthetic data</span></span>
<span id="cb2-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of observations</span></span>
<span id="cb2-3">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of predictors</span></span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create sparse true coefficients (most are zero)</span></span>
<span id="cb2-6">true_beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, p)</span>
<span id="cb2-7">true_beta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate predictor matrix</span></span>
<span id="cb2-10">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n)</span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate response with some noise</span></span>
<span id="cb2-12">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> true_beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb2-15">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(X)</span>
<span id="cb2-16">data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y</span></code></pre></div>
</details>
</div>
</section>
<section id="ridge-regression-l2" class="level2">
<h2 class="anchored" data-anchor-id="ridge-regression-l2">Ridge Regression (L2)</h2>
<p>Ridge regression adds the sum of squared coefficients to the loss function:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prepare data for glmnet</span></span>
<span id="cb3-2">x_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(data[, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(data)])</span>
<span id="cb3-3">y_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit ridge regression</span></span>
<span id="cb3-6">ridge_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glmnet</span>(x_matrix, y_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb3-7">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)))</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cross-validation to find optimal lambda</span></span>
<span id="cb3-10">cv_ridge <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(x_matrix, y_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot cross-validation results</span></span>
<span id="cb3-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(cv_ridge)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/regularization/index_files/figure-html/ridge-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="lasso-regression-l1" class="level2">
<h2 class="anchored" data-anchor-id="lasso-regression-l1">Lasso Regression (L1)</h2>
<p>Lasso regression uses absolute value penalties and can perform variable selection:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit lasso regression</span></span>
<span id="cb4-2">lasso_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glmnet</span>(x_matrix, y_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-3">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)))</span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cross-validation</span></span>
<span id="cb4-6">cv_lasso <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(x_matrix, y_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot solution path</span></span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(lasso_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xvar =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/regularization/index_files/figure-html/lasso-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="elastic-net" class="level2">
<h2 class="anchored" data-anchor-id="elastic-net">Elastic Net</h2>
<p>Elastic Net combines both L1 and L2 penalties:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit elastic net with alpha = 0.5</span></span>
<span id="cb5-2">enet_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glmnet</span>(x_matrix, y_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb5-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)))</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cross-validation</span></span>
<span id="cb5-6">cv_enet <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cv.glmnet</span>(x_matrix, y_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compare coefficients at optimal lambda</span></span>
<span id="cb5-9">coef_comparison <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb5-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">true =</span> true_beta,</span>
<span id="cb5-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ridge =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(cv_ridge, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb5-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lasso =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(cv_lasso, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb5-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">elastic =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(cv_enet, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lambda.min"</span>))[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb5-14">)</span>
<span id="cb5-15"></span>
<span id="cb5-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot first 20 coefficients</span></span>
<span id="cb5-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(coef_comparison, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   true        ridge      lasso       elastic
1   1.5  0.168206623  1.4215046  1.3290087822
2  -0.8 -0.136466379 -0.7070713 -0.7202401708
3   1.2  0.159580168  1.1339067  1.0787191944
4  -0.5 -0.036699418 -0.2745075 -0.2490259735
5   0.9  0.074879809  0.8026272  0.7517043315
6   0.0 -0.023896821  0.0000000  0.0000000000
7   0.0 -0.009236366  0.0000000  0.0000000000
8   0.0 -0.015842275  0.0000000  0.0000000000
9   0.0 -0.104338887  0.0000000 -0.0146134033
10  0.0 -0.011447505  0.0000000  0.0000000000
11  0.0  0.044632265  0.0000000  0.0000000000
12  0.0  0.005038114  0.0000000  0.0000000000
13  0.0 -0.008216405  0.0000000  0.0000000000
14  0.0  0.028400026  0.0000000  0.0001638061
15  0.0  0.011236623  0.0000000  0.0000000000
16  0.0  0.003305804  0.0000000  0.0000000000
17  0.0  0.017521241  0.0000000  0.0000000000
18  0.0  0.021065650  0.0000000  0.0000000000
19  0.0 -0.005236160  0.0000000  0.0000000000
20  0.0  0.039430620  0.0000000  0.0000000000</code></pre>
</div>
</div>
</section>
<section id="regularization-in-p-n-scenarios" class="level2">
<h2 class="anchored" data-anchor-id="regularization-in-p-n-scenarios">Regularization in p &gt; n Scenarios</h2>
<p>When the number of parameters (p) exceeds the number of observations (n), regularization becomes not just useful but essential. Here’s why:</p>
<ol type="1">
<li><p><strong>Mathematical Necessity</strong>: Without regularization, the problem is ill-posed as there are infinitely many solutions that perfectly fit the training data.</p></li>
<li><p><strong>Variance Reduction</strong>: Regularization helps reduce the variance of parameter estimates, which is particularly important when we have limited data.</p></li>
<li><p><strong>Feature Selection</strong>: Lasso and Elastic Net can help identify the most important features, which is crucial when dealing with high-dimensional data.</p></li>
</ol>
<p>Let’s demonstrate this with a comparison of prediction errors:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate test data</span></span>
<span id="cb7-2">X_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n)</span>
<span id="cb7-3">y_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> X_test <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> true_beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate MSE for each method</span></span>
<span id="cb7-6">mse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb7-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Method =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ridge"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lasso"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elastic Net"</span>),</span>
<span id="cb7-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MSE =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb7-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(cv_ridge, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newx =</span> X_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y_test)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb7-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(cv_lasso, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newx =</span> X_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y_test)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb7-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(cv_enet, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newx =</span> X_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y_test)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-12">  )</span>
<span id="cb7-13">)</span>
<span id="cb7-14"></span>
<span id="cb7-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(mse)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       Method       MSE
1       Ridge 6.3827969
2       Lasso 0.4183443
3 Elastic Net 0.5025287</code></pre>
</div>
</div>
</section>
<section id="best-practices-and-recommendations" class="level2">
<h2 class="anchored" data-anchor-id="best-practices-and-recommendations">Best Practices and Recommendations</h2>
<p>When working with p &gt; n scenarios:</p>
<ol type="1">
<li><p><strong>Start with Cross-Validation</strong>: Always use cross-validation to select the optimal regularization parameter (λ).</p></li>
<li><p><strong>Consider Multiple Methods</strong>: Try different regularization approaches as their performance can vary depending on the underlying data structure.</p></li>
<li><p><strong>Scale Features</strong>: Standardize predictors before applying regularization to ensure fair penalization.</p></li>
<li><p><strong>Monitor Sparsity</strong>: If interpretability is important, prefer Lasso or Elastic Net as they can produce sparse solutions.</p></li>
</ol>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Regularization is particularly crucial in p &gt; n scenarios, where it helps: - Prevent perfect but meaningless fits to training data - Reduce model complexity - Identify important features - Improve prediction accuracy on new data</p>
<p>The choice between Ridge, Lasso, and Elastic Net depends on your specific needs regarding sparsity, prediction accuracy, and interpretability.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ol type="1">
<li>Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). The Elements of Statistical Learning.</li>
<li>Zou, H., &amp; Hastie, T. (2005). Regularization and variable selection via the elastic net.</li>
<li>James, G., Witten, D., Hastie, T., &amp; Tibshirani, R. (2013). An Introduction to Statistical Learning.</li>
</ol>


</section>

 ]]></description>
  <guid>https://www.jonghoonk.com/blog/posts/regularization/index.html</guid>
  <pubDate>Sat, 01 Feb 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Understanding correlation, covariation, and least squares regression</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/correlation/index.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Understanding relationships between variables is a fundamental aspect of statistical analysis. Three key concepts in this domain are <strong>correlation</strong>, <strong>covariation</strong>, and <strong>least squares regression</strong>. In this post, we will explore how these concepts interrelate and use <strong>R</strong> for demonstration.</p>
</section>
<section id="covariance" class="level2">
<h2 class="anchored" data-anchor-id="covariance">Covariance</h2>
<p>Covariance measures how two variables move together. The covariance between two variables <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y"> is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(X,%20Y)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(X_i%20-%20%5Cbar%7BX%7D)(Y_i%20-%20%5Cbar%7BY%7D)%0A"></p>
<p>where: - <img src="https://latex.codecogs.com/png.latex?X_i,%20Y_i"> are individual observations, - <img src="https://latex.codecogs.com/png.latex?%5Cbar%7BX%7D,%20%5Cbar%7BY%7D"> are the means of <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y">.</p>
<p>A positive covariance indicates that as <img src="https://latex.codecogs.com/png.latex?X"> increases, <img src="https://latex.codecogs.com/png.latex?Y"> tends to increase. A negative covariance suggests an inverse relationship.</p>
<section id="r-code-example" class="level3">
<h3 class="anchored" data-anchor-id="r-code-example">R code example</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate sample data</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb1-3">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-4">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute covariance</span></span>
<span id="cb1-7">cov_xy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cov</span>(x, y)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(cov_xy)</span></code></pre></div>
</section>
</section>
<section id="correlation" class="level2">
<h2 class="anchored" data-anchor-id="correlation">Correlation</h2>
<p>Correlation standardizes covariance by dividing it by the product of standard deviations of <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y">. The Pearson correlation coefficient is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Crho_%7BX,Y%7D%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Cleft(%5Cfrac%7BX_i%20-%20%5Cbar%7BX%7D%7D%7Bs_X%7D%5Cright)%20%5Cleft(%5Cfrac%7BY_i%20-%20%5Cbar%7BY%7D%7D%7Bs_Y%7D%5Cright)%20=%20%5Cfrac%7B%5Ctext%7BCov%7D(X,%20Y)%7D%7Bs_X%20s_Y%7D%0A"> where <img src="https://latex.codecogs.com/png.latex?s_X"> and <img src="https://latex.codecogs.com/png.latex?s_Y"> are standard deviations of <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y">. The correlation coefficient ranges from -1 to 1: - <strong>+1</strong>: Perfect positive correlation - <strong>-1</strong>: Perfect negative correlation - <strong>0</strong>: No linear relationship</p>
<section id="r-code-example-1" class="level3">
<h3 class="anchored" data-anchor-id="r-code-example-1">R Code Example</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute correlation</span></span>
<span id="cb2-2">cor_xy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(x, y)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(cor_xy)</span></code></pre></div>
</section>
</section>
<section id="least-squares-regression" class="level2">
<h2 class="anchored" data-anchor-id="least-squares-regression">Least squares regression</h2>
<p>Least squares regression models the relationship between <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y"> by fitting a line that minimizes the sum of squared residuals:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AY%20=%20%5Cbeta_0%20+%20%5Cbeta_1%20X%20+%20%5Cepsilon%0A"></p>
<p>where: - <img src="https://latex.codecogs.com/png.latex?%5Cbeta_0"> (intercept) and <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1"> (slope) are estimated using:</p>
<p>The equation for the <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1"> can be derived by minimizing the error sum of squares (SSE) <img src="https://latex.codecogs.com/png.latex?%0ASSE%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(Y_i%20-%20(%5Cbeta_0%20+%20%5Cbeta_1%20X_i))%5E2%0A"> , which in turn can be solved using the following equation. <img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20%5Cbeta_1%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(Y_i%20-%20%5Cbeta_0%20-%20%5Cbeta_1%20X_i)%5E2%20=%200%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbeta_1%20=%20%5Cfrac%7B%5Ctext%7BCov%7D(X,%20Y)%7D%7B%5Ctext%7BVar%7D(X)%7D%0A"></p>
<p>The intuition behind this formula is as follows. Covariance <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(X,Y)"> measures how <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y"> vary together. Variance <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(X)"> measures how spread out <img src="https://latex.codecogs.com/png.latex?X"> is.<br>
The ratio <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Ctext%7BCov%7D(X,Y)%7D%7B%5Ctext%7BVar%7D(X)%7D"> tells us the change in <img src="https://latex.codecogs.com/png.latex?Y"> for a one-unit change in <img src="https://latex.codecogs.com/png.latex?X">. This makes sense because we are essentially scaling the covariance by the variability of <img src="https://latex.codecogs.com/png.latex?X">–ensuring that our slope correctly reflects how much <img src="https://latex.codecogs.com/png.latex?Y"> changes per unit of <img src="https://latex.codecogs.com/png.latex?X">.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbeta_0%20=%20%5Cbar%7BY%7D%20-%20%5Cbeta_1%20%5Cbar%7BX%7D%0A"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cepsilon"> represents the residual error.</li>
</ul>
<section id="r-code-example-2" class="level3">
<h3 class="anchored" data-anchor-id="r-code-example-2">R code Example</h3>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit a linear model</span></span>
<span id="cb3-2">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot regression</span></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Least Squares Regression"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>)</span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</section>
</section>
<section id="relationship-between-concepts" class="level2">
<h2 class="anchored" data-anchor-id="relationship-between-concepts">Relationship between concepts</h2>
<ol type="1">
<li><strong>Covariation quantifies the direction and strength of a linear relationship</strong> but does not standardize it.</li>
<li><strong>Correlation standardizes covariance</strong> to provide a measure that is independent of the units of <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y">.</li>
<li><strong>Least squares regression uses covariance to estimate the slope (<img src="https://latex.codecogs.com/png.latex?%5Cbeta_1">)</strong> and define the best-fit line.</li>
</ol>
<section id="summary-table" class="level3">
<h3 class="anchored" data-anchor-id="summary-table">Summary Table</h3>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 46%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Concept</th>
<th>Definition &amp; Formula</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Covariation</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(X,%20Y)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum%20(X_i%20-%20%5Cbar%7BX%7D)(Y_i%20-%20%5Cbar%7BY%7D)"></td>
<td>Measures the direction of relationship but not the scale.</td>
</tr>
<tr class="even">
<td>Correlation</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Crho_%7BX,Y%7D%20=%20%5Cfrac%7B%5Ctext%7BCov%7D(X,%20Y)%7D%7Bs_X%20s_Y%7D"></td>
<td>Standardized measure of association between -1 and 1.</td>
</tr>
<tr class="odd">
<td>Regression</td>
<td><img src="https://latex.codecogs.com/png.latex?Y%20=%20%5Cbeta_0%20+%20%5Cbeta_1%20X%20+%20%5Cepsilon"></td>
<td>Uses covariance to estimate <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1"> and predict <img src="https://latex.codecogs.com/png.latex?Y">.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Understanding <strong>covariance, correlation, and regression</strong> allows for deeper insights into data relationships. Covariance provides directionality, correlation offers a unit-free measure of strength, and regression predicts outcomes. By applying these techniques in <strong>R</strong>, we can uncover meaningful patterns in data!</p>


</section>

 ]]></description>
  <guid>https://www.jonghoonk.com/blog/posts/correlation/index.html</guid>
  <pubDate>Wed, 29 Jan 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Distribution Matching Methods: From Theory to Practice</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/distribution_matching/index.html</link>
  <description><![CDATA[ 



<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load required packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MASS)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ks)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div>
</div>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>When working with data from different sources or distributions, we often need to transform one distribution to match another. In this post, we’ll explore various methods for distribution matching, implement them in R, and discuss their strengths and limitations.</p>
</section>
<section id="distribution-matching-methods" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Distribution Matching Methods</h1>
<section id="quantile-matching" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="quantile-matching"><span class="header-section-number">2.1</span> Quantile Matching</h2>
<p>Quantile matching transforms data by mapping corresponding quantiles between distributions. It’s a non-parametric approach that preserves the rank order of the original data.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">quantile_match <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(A, B) {</span>
<span id="cb2-2">  probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(A))</span>
<span id="cb2-3">  sorted_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(A)</span>
<span id="cb2-4">  </span>
<span id="cb2-5">  B_transformed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">approx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> probs,</span>
<span id="cb2-6">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> sorted_A,</span>
<span id="cb2-7">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xout =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rank</span>(B)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(B) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb2-8">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y</span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(B_transformed)</span>
<span id="cb2-10">}</span></code></pre></div>
</details>
</div>
</section>
<section id="box-cox-transformation" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="box-cox-transformation"><span class="header-section-number">2.2</span> Box-Cox Transformation</h2>
<p>The Box-Cox transformation is particularly useful when you want to transform data to approximate normality before matching moments.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">boxcox_match <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(A, B) {</span>
<span id="cb3-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find optimal lambda for both distributions</span></span>
<span id="cb3-3">  bc_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boxcox</span>(A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plotit =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb3-4">  lambda_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bc_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(bc_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y)]</span>
<span id="cb3-5">  </span>
<span id="cb3-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform to normality</span></span>
<span id="cb3-7">  transform_boxcox <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, lambda) {</span>
<span id="cb3-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(lambda) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span>) {</span>
<span id="cb3-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(x)</span>
<span id="cb3-10">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb3-11">      (x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>lambda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> lambda</span>
<span id="cb3-12">    }</span>
<span id="cb3-13">  }</span>
<span id="cb3-14">  </span>
<span id="cb3-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform both samples</span></span>
<span id="cb3-16">  A_transformed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transform_boxcox</span>(A, lambda_A)</span>
<span id="cb3-17">  B_transformed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transform_boxcox</span>(B, lambda_A)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use same lambda</span></span>
<span id="cb3-18">  </span>
<span id="cb3-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Match moments</span></span>
<span id="cb3-20">  B_standardized <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (B_transformed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(B_transformed)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(B_transformed)</span>
<span id="cb3-21">  B_matched <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> B_standardized <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(A_transformed) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(A_transformed)</span>
<span id="cb3-22">  </span>
<span id="cb3-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Inverse transform</span></span>
<span id="cb3-24">  inverse_boxcox <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, lambda) {</span>
<span id="cb3-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(lambda) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span>) {</span>
<span id="cb3-26">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x)</span>
<span id="cb3-27">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb3-28">      (lambda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>lambda)</span>
<span id="cb3-29">    }</span>
<span id="cb3-30">  }</span>
<span id="cb3-31">  </span>
<span id="cb3-32">  B_final <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inverse_boxcox</span>(B_matched, lambda_A)</span>
<span id="cb3-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(B_final)</span>
<span id="cb3-34">}</span></code></pre></div>
</details>
</div>
</section>
<section id="kernel-density-based-transformation" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="kernel-density-based-transformation"><span class="header-section-number">2.3</span> Kernel Density-Based Transformation</h2>
<p>This method uses kernel density estimation to transform the distributions.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">kernel_density_match <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(A, B, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bw =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nrd0"</span>) {</span>
<span id="cb4-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimate densities</span></span>
<span id="cb4-3">  density_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kde</span>(A, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bw.nrd0</span>(A))</span>
<span id="cb4-4">  density_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kde</span>(B, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bw.nrd0</span>(B))</span>
<span id="cb4-5">  </span>
<span id="cb4-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate CDFs using numerical integration</span></span>
<span id="cb4-7">  cdf_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb4-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(xi) {</span>
<span id="cb4-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnorm</span>(xi, A, density_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>h))</span>
<span id="cb4-10">    })</span>
<span id="cb4-11">  }</span>
<span id="cb4-12">  </span>
<span id="cb4-13">  cdf_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb4-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(xi) {</span>
<span id="cb4-15">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnorm</span>(xi, B, density_B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>h))</span>
<span id="cb4-16">    })</span>
<span id="cb4-17">  }</span>
<span id="cb4-18">  </span>
<span id="cb4-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform B to match A's distribution</span></span>
<span id="cb4-20">  B_probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cdf_B</span>(B)</span>
<span id="cb4-21">  </span>
<span id="cb4-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create quantile function for A using interpolation</span></span>
<span id="cb4-23">  A_sorted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(A)</span>
<span id="cb4-24">  A_probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cdf_A</span>(A_sorted)</span>
<span id="cb4-25">  </span>
<span id="cb4-26">  B_transformed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">approx</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> A_probs,</span>
<span id="cb4-27">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> A_sorted,</span>
<span id="cb4-28">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xout =</span> B_probs,</span>
<span id="cb4-29">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yleft =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(A),</span>
<span id="cb4-30">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yright =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(A))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y</span>
<span id="cb4-31">  </span>
<span id="cb4-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(B_transformed)</span>
<span id="cb4-33">}</span></code></pre></div>
</details>
</div>
</section>
<section id="moment-matching" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="moment-matching"><span class="header-section-number">2.4</span> Moment Matching</h2>
<p>A simpler approach that focuses on matching the first two moments of the distributions.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">moment_match <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(A, B) {</span>
<span id="cb5-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standardize B</span></span>
<span id="cb5-3">  B_std <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(B)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(B)</span>
<span id="cb5-4">  </span>
<span id="cb5-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform to match A's moments</span></span>
<span id="cb5-6">  B_transformed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> B_std <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(A) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(A)</span>
<span id="cb5-7">  </span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(B_transformed)</span>
<span id="cb5-9">}</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="comparing-the-methods" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Comparing the Methods</h1>
<p>Let’s generate some sample data and compare all methods:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set seed for reproducibility</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate sample data</span></span>
<span id="cb6-5">A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normal distribution</span></span>
<span id="cb6-6">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exponential distribution</span></span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply all transformations</span></span>
<span id="cb6-9">B_quantile <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile_match</span>(A, B)</span>
<span id="cb6-10">B_boxcox <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boxcox_match</span>(A, B)</span>
<span id="cb6-11">B_kernel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kernel_density_match</span>(A, B)</span>
<span id="cb6-12">B_moment <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment_match</span>(A, B)</span></code></pre></div>
</details>
</div>
<section id="visual-comparison" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="visual-comparison"><span class="header-section-number">3.1</span> Visual Comparison</h2>
<p>Let’s create a more elegant visualization using ggplot2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a data frame for plotting</span></span>
<span id="cb7-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb7-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Original_A =</span> A,</span>
<span id="cb7-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Original_B =</span> B,</span>
<span id="cb7-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Quantile =</span> B_quantile,</span>
<span id="cb7-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BoxCox =</span> B_boxcox,</span>
<span id="cb7-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Kernel =</span> B_kernel,</span>
<span id="cb7-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Moment =</span> B_moment</span>
<span id="cb7-9">)</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to long format</span></span>
<span id="cb7-12">df_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(df, </span>
<span id="cb7-13">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>(),</span>
<span id="cb7-14">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Method"</span>,</span>
<span id="cb7-15">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>)</span>
<span id="cb7-16"></span>
<span id="cb7-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create the plot</span></span>
<span id="cb7-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_long, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Method)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Method, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>,</span>
<span id="cb7-23">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>,</span>
<span id="cb7-24">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comparison of Distribution Matching Methods"</span>,</span>
<span id="cb7-25">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Original A (target) vs Original B and transformed distributions"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jonghoonk.com/blog/posts/distribution_matching/index_files/figure-html/visualization-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Comparison of Distribution Matching Methods</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="numerical-comparison" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="numerical-comparison"><span class="header-section-number">3.2</span> Numerical Comparison</h2>
<p>Let’s compare some summary statistics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to calculate summary statistics</span></span>
<span id="cb8-2">get_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(x),</span>
<span id="cb8-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SD =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(x),</span>
<span id="cb8-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Median =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(x),</span>
<span id="cb8-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Skewness =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(x))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb8-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Kurtosis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(x))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb8-8">}</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate statistics for all distributions</span></span>
<span id="cb8-11">stats_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb8-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Original_A =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_stats</span>(A),</span>
<span id="cb8-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Original_B =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_stats</span>(B),</span>
<span id="cb8-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Quantile =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_stats</span>(B_quantile),</span>
<span id="cb8-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BoxCox =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_stats</span>(B_boxcox),</span>
<span id="cb8-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Kernel =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_stats</span>(B_kernel),</span>
<span id="cb8-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Moment =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_stats</span>(B_moment)</span>
<span id="cb8-18">)</span>
<span id="cb8-19"></span>
<span id="cb8-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Display the results</span></span>
<span id="cb8-21">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(stats_df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Summary Statistics Comparison </caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Original_A</th>
<th style="text-align: right;">Original_B</th>
<th style="text-align: right;">Quantile</th>
<th style="text-align: right;">BoxCox</th>
<th style="text-align: right;">Kernel</th>
<th style="text-align: right;">Moment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mean</td>
<td style="text-align: right;">10.032</td>
<td style="text-align: right;">9.837</td>
<td style="text-align: right;">10.031</td>
<td style="text-align: right;">10.031</td>
<td style="text-align: right;">10.093</td>
<td style="text-align: right;">10.032</td>
</tr>
<tr class="even">
<td style="text-align: left;">SD</td>
<td style="text-align: right;">1.983</td>
<td style="text-align: right;">9.720</td>
<td style="text-align: right;">1.967</td>
<td style="text-align: right;">2.011</td>
<td style="text-align: right;">1.872</td>
<td style="text-align: right;">1.983</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Median</td>
<td style="text-align: right;">10.018</td>
<td style="text-align: right;">6.684</td>
<td style="text-align: right;">10.018</td>
<td style="text-align: right;">9.424</td>
<td style="text-align: right;">9.989</td>
<td style="text-align: right;">9.389</td>
</tr>
<tr class="even">
<td style="text-align: left;">Skewness</td>
<td style="text-align: right;">0.065</td>
<td style="text-align: right;">1.686</td>
<td style="text-align: right;">0.057</td>
<td style="text-align: right;">1.532</td>
<td style="text-align: right;">0.444</td>
<td style="text-align: right;">1.686</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kurtosis</td>
<td style="text-align: right;">2.920</td>
<td style="text-align: right;">6.075</td>
<td style="text-align: right;">2.842</td>
<td style="text-align: right;">5.459</td>
<td style="text-align: right;">2.736</td>
<td style="text-align: right;">6.075</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="method-selection-guide" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Method Selection Guide</h1>
<p>Each method has its strengths and appropriate use cases:</p>
<section id="quantile-matching-1" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="quantile-matching-1"><span class="header-section-number">4.1</span> Quantile Matching</h2>
<ul>
<li><strong>Pros</strong>: Preserves rank order, works with any distribution</li>
<li><strong>Cons</strong>: May not extrapolate well</li>
<li><strong>Best for</strong>: General-purpose distribution matching</li>
</ul>
</section>
<section id="box-cox-transformation-1" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="box-cox-transformation-1"><span class="header-section-number">4.2</span> Box-Cox Transformation</h2>
<ul>
<li><strong>Pros</strong>: Works well for skewed data, preserves relationships</li>
<li><strong>Cons</strong>: Requires positive data, assumes underlying normality</li>
<li><strong>Best for</strong>: Right-skewed positive data</li>
</ul>
</section>
<section id="kernel-density-based" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="kernel-density-based"><span class="header-section-number">4.3</span> Kernel Density-Based</h2>
<ul>
<li><strong>Pros</strong>: Highly flexible, handles multimodal distributions</li>
<li><strong>Cons</strong>: Computationally intensive, sensitive to bandwidth selection</li>
<li><strong>Best for</strong>: Complex, multimodal distributions</li>
</ul>
</section>
<section id="moment-matching-1" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="moment-matching-1"><span class="header-section-number">4.4</span> Moment Matching</h2>
<ul>
<li><strong>Pros</strong>: Simple, fast, preserves linear relationships</li>
<li><strong>Cons</strong>: Only matches first two moments, assumes similar shapes</li>
<li><strong>Best for</strong>: Nearly normal distributions or quick approximations</li>
</ul>
</section>
</section>
<section id="performance-comparison" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Performance Comparison</h1>
<p>Let’s compare the computational performance of these methods:</p>
<div class="cell" data-hash="index_cache/html/performance_127a6a95bd68cc1ff47ab3193ac9d115">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(microbenchmark)</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Benchmark the methods</span></span>
<span id="cb9-4">bench <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb9-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Quantile =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile_match</span>(A, B),</span>
<span id="cb9-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BoxCox =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boxcox_match</span>(A, B),</span>
<span id="cb9-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Kernel =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kernel_density_match</span>(A, B),</span>
<span id="cb9-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Moment =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment_match</span>(A, B),</span>
<span id="cb9-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb9-10">)</span>
<span id="cb9-11"></span>
<span id="cb9-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot results</span></span>
<span id="cb9-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoplot</span>(bench) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Performance Comparison"</span>,</span>
<span id="cb9-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time taken by each method (lower is better)"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/distribution_matching/index_files/figure-html/performance-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="conclusion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion</h1>
<p>While quantile matching is often the default choice for distribution matching, having multiple approaches in your toolkit allows you to handle various scenarios more effectively. The choice of method should depend on:</p>
<ol type="1">
<li>Your data characteristics</li>
<li>Computational resources</li>
<li>Preservation requirements</li>
<li>Desired properties of the transformed distribution</li>
</ol>
<p>Always validate your transformations through both visual inspection and numerical summaries to ensure the transformed distribution meets your requirements.</p>
</section>
<section id="references" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> References</h1>
<ul>
<li>Box, G. E. P., &amp; Cox, D. R. (1964). An analysis of transformations. Journal of the Royal Statistical Society: Series B (Methodological), 26(2), 211-243.</li>
<li>Silverman, B. W. (1986). Density estimation for statistics and data analysis. CRC press.</li>
<li>Bolstad, B. M., Irizarry, R. A., Åstrand, M., &amp; Speed, T. P. (2003). A comparison of normalization methods for high density oligonucleotide array data based on variance and bias. Bioinformatics, 19(2), 185-193.</li>
</ul>


</section>

 ]]></description>
  <guid>https://www.jonghoonk.com/blog/posts/distribution_matching/index.html</guid>
  <pubDate>Wed, 30 Oct 2024 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Bayesian workflow: fake social contact data example</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/bayesian_workflow/index.html</link>
  <description><![CDATA[ 



<section id="bayesian-workflow" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-workflow">Bayesian workflow</h2>
<p>This post is my attempt to follow along a <a href="https://arxiv.org/abs/2011.01808">Bayesian Workflow</a> by Gelman <em>et al</em> and create examples for better understanding. While my ultimate goal is to study infectious disease transmission using a dynamic model following a Bayesian workflow, I use a simpler statistical model for practice in this post. I also consulted a <a href="https://betanalpha.github.io/assets/case_studies/principled_bayesian_workflow.html#31_Example_Workflow_Executions">blog post</a> by Michael Betancourt to create this post.</p>
<p>Regarding the definition of Bayesian workflow, <a href="https://arxiv.org/abs/2011.01808">Gelman <em>et al</em>.</a> writes:</p>
<blockquote class="blockquote">
<p>“… Bayesian inference is just the formulation and computation of conditional probability or probability densities, <img src="https://latex.codecogs.com/png.latex?p(%5Ctheta%7Cy)%20%5Cpropto%20p(%5Ctheta)%20p(y%7C%5Ctheta)">. Bayesian workflow includes the three steps of model building, inference, and model checking/improvement, along with the comparison of different models, not just for the purpose of model choice or model averaging but more importantly to better understand these models …”</p>
</blockquote>
</section>
<section id="model-building" class="level2">
<h2 class="anchored" data-anchor-id="model-building">Model building</h2>
<section id="conceptual-analysis" class="level3">
<h3 class="anchored" data-anchor-id="conceptual-analysis">Conceptual analysis</h3>
<p>Let’s suppose that we measured how the number of contact a person makes varies.<a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0050074">A prior study</a> and other numerous studies showed that contact frequencies differ by age. And a significant fraction of contacts occur with household members and as such the contact frequencies will likely vary by household size. We sampled a group of people and followed them for some time (e.g., 1 week) and measured the number of contacts that a typical person makes in a day. We also collected variables such as age, sex, and household size.</p>
<p>There are three conceptual modelling approaches: descriptive, predictive and explanatory approaches as per <a href="https://www.stat.berkeley.edu/~aldous/157/Papers/shmueli.pdf">the study by Shmueli</a>. This study is best described as a descriptive study and does not directly aim at obtaining optimal predictive performance, but at capturing the data structure parsimoniously. For a descriptive model, interpretability, transportability and general usability are important criteria as described in the <a href="ttps://diagnprognres.biomedcentral.com/articles/10.1186/s41512-020-00074-3">article</a>.</p>
<p>Assuming that the number of contacts per day per person, <img src="https://latex.codecogs.com/png.latex?y_i">, follows a negative binomial distribution, we can mathematically express our concepts in the following equations:</p>
<p><span id="eq-nb"><img src="https://latex.codecogs.com/png.latex?%0Ay_i%20%5Csim%20%5Ctext%7BNB%7D(y_i%7C%5Cmu_i,%5Cphi)=%5Cfrac%7B%5CGamma%20(y_i%20+%20%5Ctheta)%7D%7B%5CGamma%20(%5Ctheta)%20y_i%20!%7D)%20%5Cleft(%5Cfrac%7B%5Cmu_i%7D%7B%5Cmu_i+%5Cphi%7D%20%5Cright)%5Ey%20%5Cleft(%5Cfrac%7B%5Cphi%7D%7B%5Cmu_i+%5Cphi%7D%20%5Cright)%5E%5Cphi%0A%5Ctag%7B1%7D"></span></p>
<p><span id="eq-mu"><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Blog%7D(%5Cmu_i)=%20%5Calpha%20+%20%5Cbeta_%7B%5Ctext%7Bage%7D_i%7D%20%20+%20%5Cbeta_%7B%5Ctext%7Bsex%7D_i%7D%20+%5Cbeta_%7B%5Ctext%7Bhhsize%7D_i%7D%20%5Ctag%7B2%7D"></span></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmu_i"> and <img src="https://latex.codecogs.com/png.latex?%5Cphi"> represent the mean number of contacts per day for a person <img src="https://latex.codecogs.com/png.latex?i"> and the shape parameter of the negative binomial distribution, respectively. <img src="https://latex.codecogs.com/png.latex?%5CGamma%20(%5Ccdot)"> denotes a <a href="https://en.wikipedia.org/wiki/Gamma_function">gamma function</a>.</p>
</section>
<section id="implemetation" class="level3">
<h3 class="anchored" data-anchor-id="implemetation">Implemetation</h3>
<p>Load packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(posterior)</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># options(pillar.neg = FALSE, pillar.subtle=FALSE, pillar.sigfig=2)</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(brms)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(bayesplot)</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># theme_set(bayesplot::theme_default(base_family = "sans"))</span></span>
<span id="cb1-7">set1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> RColorBrewer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
</div>
<p>Generate the fake data</p>
<p>We take the fake-data simulation approach, which can help us understand our data model and priors, what can be learned from an experiment, and the validity of the applied inference methods. Parameters of interest are the ratios of number of contacts per day (i.e., rate ratios or relative risks) by age, sex, and household size. Plugging Equation&nbsp;2 into Equation&nbsp;1 becomes our generative model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameter values to be estimated</span></span>
<span id="cb2-2">intercept_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># base number of contacts</span></span>
<span id="cb2-3">rr_age_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># relative number of contacts by age (age0 = 1)</span></span>
<span id="cb2-4">rr_hhsize_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.6</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># relative number of contacts by household size  (hhsize0 =1)  </span></span>
<span id="cb2-5">rr_sex_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># males have more frequent contacts, which is not modeled in model 1</span></span>
<span id="cb2-6">shape_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shape parameter for the negative binomial distribution</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1220</span>)</span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 9 categories with &gt;100 observations on average</span></span>
<span id="cb2-10">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span>T),</span>
<span id="cb2-11">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hhsize =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span>T), </span>
<span id="cb2-12">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sex =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span>T))</span>
<span id="cb2-13">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb2-15">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, rr_age_true[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], rr_age_true[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># relative risk by age</span></span>
<span id="cb2-16">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_hhsize <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hhsize <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb2-18">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hhsize <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, rr_hhsize_true[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], rr_hhsize_true[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># relative risk by household size</span></span>
<span id="cb2-19">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_sex <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, rr_sex_true) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># relative risk by sex</span></span>
<span id="cb2-20"></span>
<span id="cb2-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mean as a function of age and hhsize</span></span>
<span id="cb2-22">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> intercept_true </span>
<span id="cb2-23">log_mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(a) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_hhsize) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_sex)</span>
<span id="cb2-24">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(log_mu)</span>
<span id="cb2-25">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>age)</span>
<span id="cb2-26">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hhsize <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>hhsize)</span>
<span id="cb2-27">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sex <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sex)</span>
<span id="cb2-28">d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnbinom</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>shape_true) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># size, aka, shape, dispersion</span></span></code></pre></div>
</div>
<p>Histogram, mean, and variance of the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb3-2">d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>contacts))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of contacts per day per person"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.252</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">var</span>(d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>contacts)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 29.13964</code></pre>
</div>
</div>
<p>The number of contacts is count data and the variance-to-mean ratio is around 5. Thefore, the choice of negative binomial distribution looks reasonable.</p>
</section>
<section id="model-1-age-and-household-size" class="level3">
<h3 class="anchored" data-anchor-id="model-1-age-and-household-size">Model 1: age and household size</h3>
<p>For this model, we assume that the dependent variable is mostly influenced by age and household size and do not include sex variable in the model.</p>
<p>We use the <code>brms</code> package to implement the Bayesian regression model. We first set the priors for the intercept, <code>a_*</code>, the age and household size, <code>b_*</code>, and the shape parameter of the negative binomial distribution, <code>shp_*</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prior distributions</span></span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># intercept, modeled as normal</span></span>
<span id="cb8-3">a_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-4">a_scale <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># exp(2*a_scale) will likely cover plausible values </span></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># beta for the age and the household, modeled as normal</span></span>
<span id="cb8-6">b_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-7">b_scale <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span></span>
<span id="cb8-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shape parameter of the negbin distr, modeled as inverse gamma</span></span>
<span id="cb8-9">shp_alpha <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0.4 (brms default) causes divergent transitions,</span></span>
<span id="cb8-10">shp_beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb8-11"></span>
<span id="cb8-12">my_priors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb8-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior_string</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal("</span>, a_mean, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, a_scale,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>), </span>
<span id="cb8-14">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Intercept"</span>),</span>
<span id="cb8-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior_string</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal("</span>, b_mean, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, b_scale,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>),</span>
<span id="cb8-16">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>),</span>
<span id="cb8-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior_string</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inv_gamma("</span>, shp_alpha, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, shp_beta,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>), </span>
<span id="cb8-18">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shape"</span>))</span></code></pre></div>
</div>
</section>
<section id="prior-predictive-check" class="level3">
<h3 class="anchored" data-anchor-id="prior-predictive-check">Prior predictive check</h3>
<p>We use <code>sample_prior = "only"</code> argument to get the prior predictive distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">prior_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hhsize,</span>
<span id="cb9-2">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> d,</span>
<span id="cb9-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">negbinomial</span>(),</span>
<span id="cb9-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior =</span> my_priors,</span>
<span id="cb9-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample_prior =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"only"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb9-6"></span>
<span id="cb9-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(prior_pred, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prior_pred.rds"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">prior_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prior_pred.rds"</span>)</span>
<span id="cb10-2">priorpc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pp_check</span>(prior_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bars"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ndraws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb10-3"></span>
<span id="cb10-4">priorpc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y_obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_linerange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>h, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>l, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of contacts per day per person"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fit-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-the-model">Fit the model</h3>
<p><a href="https://arxiv.org/abs/2011.01808">Gelman <em>et al</em>.</a> writes:</p>
<blockquote class="blockquote">
<p>” … The first step in validating computation is to check that the model actually finishes the fitting process in an acceptable time frame and the convergence diagnostics are reasonable. In the context of HMC, this is primarily the absence of divergent transitions, <img src="https://latex.codecogs.com/png.latex?%5Chat%7BR%7D"> diagnostic near 1, and sufficient effective sample sizes for the central tendency, the tail quantiles, and the energy (Vehtari et al., 2020). …”</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hhsize, </span>
<span id="cb11-2">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> d, </span>
<span id="cb11-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">negbinomial</span>(),</span>
<span id="cb11-4">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior =</span> my_priors,</span>
<span id="cb11-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb11-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(fit1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fit1.rds"</span>)</span></code></pre></div>
</div>
<p><code>brms</code> package reports all the relevant information to check the fitting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fit1.rds"</span>)</span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fit1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: negbinomial 
  Links: mu = log; shape = identity 
Formula: contacts ~ 1 + age + hhsize 
   Data: d (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 10000; warmup = 5000; thin = 1;
         total post-warmup draws = 20000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     1.13      0.05     1.03     1.23 1.00    18152    14753
age2          0.48      0.05     0.38     0.57 1.00    22583    16259
age3         -0.47      0.05    -0.57    -0.37 1.00    21570    15970
hhsize2       0.71      0.05     0.60     0.81 1.00    19003    15277
hhsize3       0.96      0.05     0.85     1.06 1.00    18962    15515

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape     4.47      0.36     3.81     5.22 1.00    25673    14986

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section>
<section id="posterior-predictive-values-along-with-prior-predictive-values" class="level3">
<h3 class="anchored" data-anchor-id="posterior-predictive-values-along-with-prior-predictive-values">Posterior predictive values along with prior predictive values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">prior_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prior_pred.rds"</span>)</span>
<span id="cb14-2">priorpc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pp_check</span>(prior_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bars"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ndraws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb14-3">postpc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pp_check</span>(fit1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bars"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ndraws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb14-4"></span>
<span id="cb14-5">postpc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y_obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>priorpc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_linerange</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>priorpc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>h, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>l, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>m, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_linerange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>h, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>l, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of contacts per day per person"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>],</span>
<span id="cb14-15">                               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="inference" class="level2">
<h2 class="anchored" data-anchor-id="inference">Inference</h2>
<p>Prior and posterior distributions of parameters. Trace plots and histograms</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(fit1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^b_"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot(fit, pars = ".*age*.")</span></span>
<span id="cb16-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot(fit, pars = ".*hhsize*.")</span></span></code></pre></div>
</div>
<p>Correlations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs</span>(fit1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".*age*."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There is a positive correlation between <code>b_age2</code> and <code>b_age3</code>. It appears that increase in one parameter creates a deviation from the specified distribution (negative binomial distribution) and the other parameter also increases for all predicted values conform to the specified distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs</span>(fit1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^b_age*.|^In*."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I also expected that the increase in those parameters (<code>b_age2</code> and <code>b_age3</code>) lead to the decrease in the <code>Intercept</code> to maintain the mean. This is, however, only clear when examining the association among <code>Intercept</code>, <code>b_hhsize2</code>, and <code>b_hhsize3</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs</span>(fit1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".*hh*."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs</span>(fit1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^b_hh*.|^In*."</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B%5Ctext%7Bage%7D%7D"> parameter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">df_post <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(fit1)</span>
<span id="cb21-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb21-3">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>))</span>
<span id="cb21-4">df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>prior_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, b_mean, b_scale)</span>
<span id="cb21-5"></span>
<span id="cb21-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x, b_mean, b_scale), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), </span>
<span id="cb21-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(beta[age]))</span>
<span id="cb21-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(df_post<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_age2)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb21-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(df_post<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_age3)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb21-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>rr_age_true, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>)</span>
<span id="cb21-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>,</span>
<span id="cb21-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb21-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb21-14">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>],set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb21-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>),</span>
<span id="cb21-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggplot2 way</span></span>
<span id="cb22-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggplot()+</span></span>
<span id="cb22-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   geom_line(data=df, aes(x=exp(x), y=prior_density, color="Prior"))+</span></span>
<span id="cb22-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   geom_density(data=df_post, aes(x=exp(b_age2), color="Posterior b_age2"))+</span></span>
<span id="cb22-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   geom_density(data=df_post, aes(x=exp(b_age3), color="Posterior b_age3"))+</span></span>
<span id="cb22-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   scale_color_manual(values=c("Prior"="forestgreen", </span></span>
<span id="cb22-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                               "Posterior b_age2"="firebrick",</span></span>
<span id="cb22-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                               "Posterior b_age3"="steelblue"))+</span></span>
<span id="cb22-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   labs(color="", x="value", y="density")+</span></span>
<span id="cb22-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   theme(legend.position="bottom")</span></span></code></pre></div>
</div>
<p>True <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B%5Ctext%7Bage%7D%7D"> values were well retrieved.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B%5Ctext%7Bhhsize%7D%7D"> parameter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x, b_mean, b_scale), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb23-2">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(beta[hhsize]))</span>
<span id="cb23-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(df_post<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_hhsize2)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb23-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(df_post<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_hhsize3)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb23-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>rr_hhsize_true, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>)</span>
<span id="cb23-6"></span>
<span id="cb23-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>,</span>
<span id="cb23-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb23-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb23-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb23-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hhsize2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hhsize3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>),</span>
<span id="cb23-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Intercept</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x, a_mean, a_scale), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), </span>
<span id="cb24-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Intercept"</span>)</span>
<span id="cb24-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(df_post<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>b_Intercept)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb24-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>intercept_true, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>)</span>
<span id="cb24-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>,</span>
<span id="cb24-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb24-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb24-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb24-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>),</span>
<span id="cb24-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Shape parameter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(extraDistr)</span>
<span id="cb25-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb25-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dinvgamma</span>(x, shp_alpha, shp_beta), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, </span>
<span id="cb25-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shape"</span>)</span>
<span id="cb25-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density</span>(df_post<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>shape), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb25-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>shape_true, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>)</span>
<span id="cb25-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>,</span>
<span id="cb25-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb25-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb25-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],set1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb25-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>),</span>
<span id="cb25-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="model-checking-improvement-and-comparing-multiple-models" class="level2">
<h2 class="anchored" data-anchor-id="model-checking-improvement-and-comparing-multiple-models">Model checking, improvement, and comparing multiple models</h2>
<p>Gelman <em>et al</em>. writes:</p>
<blockquote class="blockquote">
<p>“… The key aspect of Bayesian workflow, which takes it beyond Bayesian data analysis, is that we are fitting many models while working on a single problem. We are not talking here about model selection or model averaging but rather of the use of a series of fitted models to better understand each one. …”</p>
</blockquote>
<section id="model-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-evaluation">Model evaluation</h3>
<p>We use leave-one-out (LOO) cross validation as suggested in <a href="https://link.springer.com/article/10.1007/s11222-016-9696-4">Vehtari <em>et al.</em></a> and <a href="https://link.springer.com/article/10.1007/s11222-013-9416-2">Gelman <em>et al.</em></a>.</p>
<p>We fit two additional models: <code>fit2</code> and <code>fit0</code>. <code>fit2</code> includes <code>sex</code> variable in addition to all variables included in <code>fit1</code> and could be better or worse than <code>fit1</code> as impact of sex is not big in the data set. <code>fit0</code> is intercept-only model and thus is very likely to be worse than <code>fit1</code> or <code>fit2</code>.</p>
</section>
<section id="model-2-include-sex-in-addition-to-age-and-household-size-as-covariates." class="level3">
<h3 class="anchored" data-anchor-id="model-2-include-sex-in-addition-to-age-and-household-size-as-covariates.">Model 2: Include sex in addition to age and household size as covariates.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> hhsize <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sex, </span>
<span id="cb26-2">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> d, </span>
<span id="cb26-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">negbinomial</span>(),</span>
<span id="cb26-4">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior =</span> my_priors,</span>
<span id="cb26-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb26-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(fit2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fit2.rds"</span>)</span>
<span id="cb26-7"></span>
<span id="cb26-8">fit0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(contacts <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb26-9">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> d, </span>
<span id="cb26-10">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">negbinomial</span>(),</span>
<span id="cb26-11">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_prior</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal(0,5)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Intercept"</span>),</span>
<span id="cb26-12">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb26-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(fit0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fit0.rds"</span>)</span></code></pre></div>
</div>
<p>Summary of fit0 and fit2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fit2.rds"</span>) </span>
<span id="cb27-2">fit0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fit0.rds"</span>)</span>
<span id="cb27-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fit2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: negbinomial 
  Links: mu = log; shape = identity 
Formula: contacts ~ 1 + age + hhsize + sex 
   Data: d (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 10000; warmup = 5000; thin = 1;
         total post-warmup draws = 20000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     1.05      0.05     0.94     1.16 1.00    21036    16258
age2          0.49      0.05     0.40     0.59 1.00    23875    16265
age3         -0.46      0.05    -0.57    -0.36 1.00    23032    15811
hhsize2       0.70      0.05     0.60     0.80 1.00    22731    15830
hhsize3       0.95      0.05     0.85     1.06 1.00    21280    16524
sex2          0.15      0.04     0.07     0.23 1.00    29050    14273

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape     4.57      0.37     3.89     5.35 1.00    30332    14155

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fit0)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: negbinomial 
  Links: mu = log; shape = identity 
Formula: contacts ~ 1 
   Data: d (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 10000; warmup = 5000; thin = 1;
         total post-warmup draws = 20000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     1.83      0.03     1.78     1.88 1.00    16643    12592

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape     1.92      0.11     1.71     2.15 1.00    15701    13170

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Shape parameter estimates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>)</span>
<span id="cb31-2">shp1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(fit1)[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shape"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs=</span>probs)</span>
<span id="cb31-3">shp2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(fit2)[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shape"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs=</span>probs)</span>
<span id="cb31-4">shp0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(fit0)[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shape"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs=</span>probs)</span>
<span id="cb31-5"></span>
<span id="cb31-6">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model 0"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(shp0))</span>
<span id="cb31-7">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model 1"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(shp1)),</span>
<span id="cb31-8">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model 2"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(shp2)))</span>
<span id="cb31-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># df$percentile &lt;- rep(as.character(100*probs),3)</span></span>
<span id="cb31-10"></span>
<span id="cb31-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Model))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_linerange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X2.5.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X97.5.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_linerange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X25.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X75.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>Model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X50.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb31-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Inference for the shape parameter"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/bayesian_workflow/index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Compare fit0, fit1 and fit2 models</p>
<p>Using WAIC</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_criterion</span>(fit1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"waic"</span>)</span>
<span id="cb32-2">fit0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_criterion</span>(fit0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"waic"</span>)</span>
<span id="cb32-3">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_criterion</span>(fit2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"waic"</span>)</span>
<span id="cb32-4"></span>
<span id="cb32-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">waic</span>(fit0)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 20000 by 1000 log-likelihood matrix

          Estimate   SE
elpd_waic  -2848.4 28.0
p_waic         2.1  0.2
waic        5696.7 56.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">waic</span>(fit1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 20000 by 1000 log-likelihood matrix

          Estimate   SE
elpd_waic  -2575.3 26.8
p_waic         5.8  0.4
waic        5150.5 53.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">waic</span>(fit2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 20000 by 1000 log-likelihood matrix

          Estimate   SE
elpd_waic  -2569.2 26.6
p_waic         6.6  0.4
waic        5138.4 53.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loo_compare</span>(fit1, fit2, fit0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">criterion =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"waic"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff
fit2    0.0       0.0 
fit1   -6.1       3.6 
fit0 -279.2      19.9 </code></pre>
</div>
</div>
<p>Using leave-one-out (LOO) cross-validation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_criterion</span>(fit1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loo"</span>)</span>
<span id="cb40-2">fit0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_criterion</span>(fit0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loo"</span>)</span>
<span id="cb40-3">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_criterion</span>(fit2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loo"</span>)</span>
<span id="cb40-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loo_compare</span>(fit1, fit2, fit0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">criterion =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loo"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff
fit2    0.0       0.0 
fit1   -6.1       3.6 
fit0 -279.2      19.9 </code></pre>
</div>
</div>
<p><code>brms::loo_compare</code> uses the <code>loo::loo_compare</code> under the hood and and <code>loo::loo_compare</code> package produces the same results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(loo)</span>
<span id="cb42-2">loo_fit0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loo</span>(fit0)</span>
<span id="cb42-3">loo_fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loo</span>(fit1)</span>
<span id="cb42-4">loo_fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loo</span>(fit2)</span>
<span id="cb42-5"></span>
<span id="cb42-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(loo_fit0)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 20000 by 1000 log-likelihood matrix

         Estimate   SE
elpd_loo  -2848.4 28.0
p_loo         2.1  0.2
looic      5696.7 56.0
------
Monte Carlo SE of elpd_loo is 0.0.

All Pareto k estimates are good (k &lt; 0.5).
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(loo_fit1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 20000 by 1000 log-likelihood matrix

         Estimate   SE
elpd_loo  -2575.3 26.8
p_loo         5.8  0.4
looic      5150.5 53.7
------
Monte Carlo SE of elpd_loo is 0.0.

All Pareto k estimates are good (k &lt; 0.5).
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(loo_fit2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 20000 by 1000 log-likelihood matrix

         Estimate   SE
elpd_loo  -2569.2 26.6
p_loo         6.6  0.4
looic      5138.4 53.1
------
Monte Carlo SE of elpd_loo is 0.0.

All Pareto k estimates are good (k &lt; 0.5).
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1">brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loo_compare</span>(loo_fit1, loo_fit2, loo_fit0)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff
fit2    0.0       0.0 
fit1   -6.1       3.6 
fit0 -279.2      19.9 </code></pre>
</div>
</div>
<p>It appears that <code>fit2</code> is the most favored by LOO cross validation. This implies that adding <code>sex</code> variable still improves the model performance while its influence on the number of contacts relatively small compared to the <code>age</code> and <code>household size</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fit2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: negbinomial 
  Links: mu = log; shape = identity 
Formula: contacts ~ 1 + age + hhsize + sex 
   Data: d (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 10000; warmup = 5000; thin = 1;
         total post-warmup draws = 20000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     1.05      0.05     0.94     1.16 1.00    21036    16258
age2          0.49      0.05     0.40     0.59 1.00    23875    16265
age3         -0.46      0.05    -0.57    -0.36 1.00    23032    15811
hhsize2       0.70      0.05     0.60     0.80 1.00    22731    15830
hhsize3       0.95      0.05     0.85     1.06 1.00    21280    16524
sex2          0.15      0.04     0.07     0.23 1.00    29050    14273

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape     4.57      0.37     3.89     5.35 1.00    30332    14155

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>Bayesian workflow</category>
  <category>negative binomial</category>
  <category>social contact</category>
  <guid>https://www.jonghoonk.com/blog/posts/bayesian_workflow/index.html</guid>
  <pubDate>Sat, 20 Jul 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/bayesian_workflow/sample_figure.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Modeling human behavior: Infectious disease transmission modeling perspective</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/behavior_change/index.html</link>
  <description><![CDATA[ 



<section id="epidemiology" class="level2">
<h2 class="anchored" data-anchor-id="epidemiology">Epidemiology</h2>
<p>감염병의 전파 양상을 연구하는 감염병 역학 (Epidemiology of Infectious Diseases ; EID)에서는 감염병의 발생 양샹을 세 가지 요소로 해석하고자 한다. 하나는 병을 일으키는 감염원 (infectious agent)이고, 다른 하나는 사람이 살아가고 있는 주변 환경 (environment)이며 마지막은 감염되는 대상, 즉 숙주 (host) 이다[<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2465549/">Barreto <em>et al</em>.</a>].</p>
<p>Sebastian Funk <em>et al</em>. 의 논문 <a href="https://royalsocietypublishing.org/doi/full/10.1098/rsif.2010.0142">Modelling the influence of human behaviour on the spread of infectious diseases: a review</a>은 을 살펴보고자 한다.</p>
<blockquote class="blockquote">
<p>“… After all, individual self-initiated behaviour can change the fate of an outbreak, and its interaction with disease dynamics requires proper understanding if we are to fully comprehend what happens when a disease spreads through human populations Ferguson <em>et al</em>. <a href="https://www.nature.com/articles/446733a">Capturing human behaviour</a>. …”</p>
</blockquote>


</section>

 ]]></description>
  <category>Bayesian workflow</category>
  <category>negative binomial</category>
  <category>social contact</category>
  <guid>https://www.jonghoonk.com/blog/posts/behavior_change/index.html</guid>
  <pubDate>Sat, 20 Jul 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/behavior_change/sample_figure.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Kalman filter to estimate R using the FKF package</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/kalman_filter/index.html</link>
  <description><![CDATA[ 



<p><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0244474">Arroyo-Marioli et al</a> used a Kalman filter approach to estimate. I tried to reproduce in R. Let’s use a SIR model as was used in my <a href="https://www.jonghoonk.com/posts/sir_deSolve_odin_diffeqr/">previous post</a> to generate growth rate time series.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(diffeqr)</span>
<span id="cb1-2">de <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diffeqr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diffeq_setup</span>()</span>
<span id="cb1-3"></span>
<span id="cb1-4">sir_julia <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(u, p, t){</span>
<span id="cb1-5">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(u)</span>
<span id="cb1-6">  R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.4</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R varies </span></span>
<span id="cb1-7">  p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-8">  </span>
<span id="cb1-9">  du1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N</span>
<span id="cb1-10">  du2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-11">  du3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>u[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-12">  </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(du1,du2,du3))</span>
<span id="cb1-14">}</span>
<span id="cb1-15"></span>
<span id="cb1-16">u0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>)</span>
<span id="cb1-17">tspan <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.0</span>)</span>
<span id="cb1-18">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb1-19">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ODEProblem</span>(sir_julia, u0, tspan, p)</span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prob_jit &lt;- diffeqr::jitoptimize_ode(de, prob)</span></span>
<span id="cb1-22">sol <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(prob, de<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Tsit5</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">saveat=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-23"></span>
<span id="cb1-24">mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>u, identity)</span>
<span id="cb1-25">udf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(mat))</span>
<span id="cb1-26">tudf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t=</span>sol<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t), udf)</span>
<span id="cb1-27"></span>
<span id="cb1-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(tudf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>V3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, </span>
<span id="cb1-34">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,</span>
<span id="cb1-35">                              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of individuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/kalman_filter/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Generate daily incidence assuming 100,000 population</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (tudf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true number of infected people at time t</span></span>
<span id="cb2-2">case_daily <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(I)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(I)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># observed number of infected people at t</span></span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?I_t%20=%20(1-%5Cgamma)%20I_%7Bt-1%7D%20+%20%5Ctext%7Bnew%20cases%20at%20%7Dt"> <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BI_t-I_%7Bt-1%7D%7D%7BI_%7Bt-1%7D%7D%5Cequiv%20r_t%20=%20%5Cgamma(R_t-1)%20+%20%5Cepsilon_i"> <img src="https://latex.codecogs.com/png.latex?R_t%20=%20R_%7Bt-1%7D%20+%20%5Ceta_i"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># recovery rate, which is the same as p[2] in the ODE model</span></span>
<span id="cb3-2">I_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(case_daily)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true number of infected people at time t</span></span>
<span id="cb3-3">I_hat[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> I[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cheating, it's okay as this is the simulation check </span></span>
<span id="cb3-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(I_hat)) {</span>
<span id="cb3-5">  I_hat[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gamma)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>I_hat[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> case_daily[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>]</span>
<span id="cb3-6">}</span>
<span id="cb3-7"></span>
<span id="cb3-8">It <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> I_hat <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># observed number of infected people at t</span></span>
<span id="cb3-9">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(It)</span>
<span id="cb3-10">gr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (It[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> It[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(n<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> It[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(n<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># observed growth rate</span></span>
<span id="cb3-11">t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb3-12">R_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.4</span>))</span>
<span id="cb3-13">gr_true <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (R_true <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-14">R_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> gamma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(R_hat, R_true[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(R_hat)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), </span>
<span id="cb3-17">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R_hat"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R_true"</span>)</span>
<span id="cb3-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/kalman_filter/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Inferring R based on the Kalman filter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(FKF)</span>
<span id="cb4-2">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gr</span>
<span id="cb4-3">a0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-4">P0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-5"></span>
<span id="cb4-6">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-7">ct <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> gamma)  </span>
<span id="cb4-8">Zt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(gamma)</span>
<span id="cb4-9">Tt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-10"></span>
<span id="cb4-11">fit.fkf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HHt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">var</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb4-12">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GGt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">var</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb4-13">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(par, ...)</span>
<span id="cb4-14">                 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fkf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HHt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GGt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), ...)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>logLik,</span>
<span id="cb4-15">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(y), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a0 =</span> a0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">P0 =</span> P0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ct =</span> ct,</span>
<span id="cb4-16">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Zt =</span> Zt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Tt =</span> Tt)</span>
<span id="cb4-17"></span>
<span id="cb4-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># recover values</span></span>
<span id="cb4-19">HHt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(fit.fkf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb4-20">GGt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(fit.fkf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb4-21">HHt; GGt</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01137336</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.187671e-05</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">y_kf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fkf</span>(a0, P0, dt, ct, Tt, Zt,</span>
<span id="cb7-2">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HHt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(HHt), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GGt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(HHt),</span>
<span id="cb7-3">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(y)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Kalman filtering</span></span>
<span id="cb7-4"></span>
<span id="cb7-5">y_ks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fks</span>(y_kf) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Kalman smoothing</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> R_true,</span>
<span id="cb8-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_hat =</span> R_hat,</span>
<span id="cb8-4">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_kf =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_kf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>att),</span>
<span id="cb8-5">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_ks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_ks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ahatt),</span>
<span id="cb8-6">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_ks_ub =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_ks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ahatt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(y_ks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Vt)),</span>
<span id="cb8-7">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_ks_lb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_ks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ahatt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(y_ks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Vt)))</span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y_hat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y_kf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kalman filter"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y_ks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kalman smooth"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y_ks_ub, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kalman smooth"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Upper bound"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y_ks_lb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kalman smooth"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lower bound"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reproduction number"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reproduction number inferred with Kalman Filter"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kalman filter"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>,</span>
<span id="cb8-20">                                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kalman smooth"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forestgreen"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_linetype_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Upper bound"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>,</span>
<span id="cb8-22">                                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lower bound"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/kalman_filter/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>kalman filter</category>
  <guid>https://www.jonghoonk.com/blog/posts/kalman_filter/index.html</guid>
  <pubDate>Wed, 10 Jul 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/kalman_filter/kalman_filter.png" medium="image" type="image/png" height="135" width="144"/>
</item>
<item>
  <title>Learning ChatGPT 4: Universal Approximation Theorem</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index.html</link>
  <description><![CDATA[ 



<p>Neural networks can approximate any function according to the <a href="https://en.wikipedia.org/wiki/Universal_approximation_theorem">Universal Approximation Theorem</a>. A more precise statement of the theorem is that neural networks with a single hidden layer can be used to approximate any continuous function to any desired precision by the <a href="http://neuralnetworksanddeeplearning.com/chap4.html">e-book</a> by Michael Nielsen. This e-book provides intuitive explanations about the proof. In what follows, I wrote what I was able to understand based on those materials and added a few R code chunks to supplement.</p>
<p>For a simple network with one hidden layer of two neurons, n1 and n2, what is being computed in a hidden neuron is <img src="https://latex.codecogs.com/png.latex?%5Csigma(w%20x%20+%20b)">, where <img src="https://latex.codecogs.com/png.latex?%5Csigma%20(z)%20%5Cequiv%201/(1+e%5E%7B-z%7D)"> is the sigmoid function. And what happens in the output neuron is <img src="https://latex.codecogs.com/png.latex?w_%7B31%7D%20n1%20+%20w_%7B32%7D%20n2%20+%20b">. Here, <img src="https://latex.codecogs.com/png.latex?w_%7B31%7D%20%5Ctext%7Band%7D%20w_%7B32%7D"> refer to weights that correspond to two neurons, n1 and n2, respectively.</p>
<p>The basic idea of the theorem is that weighted sum of outputs of neurons can approximate any functions. This can be visualized by studying a special case in which output from each neuron is close to a step function and weighted sum of a pair of step functions can create a bump of any height and width. With numerous those bumps, one can approximate any continuous function at any desired precision.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">graph_from_literal</span>(Input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--+</span>n1, Input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--+</span>n2, n1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--+</span>Output, n2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--+</span>Output))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In what follows, I will explain how a neural network can create a bump. Before that, let’s get familiar with what is being computed in a single neuron. In the following codes, some combination of weight, <img src="https://latex.codecogs.com/png.latex?w"> , and bias, <img src="https://latex.codecogs.com/png.latex?b">, generate a typical sigmoid function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb2-2">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb2-3">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>With high values for <img src="https://latex.codecogs.com/png.latex?w">, the output becomes close to a step function and the change point occurs at <img src="https://latex.codecogs.com/png.latex?-b/w">. For instance, let’s look at the plot for <img src="https://latex.codecogs.com/png.latex?w=1000,%20b=-300">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb3-2">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span></span>
<span id="cb3-3">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span></span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>One can use the following codes to have a feel for how the weight and bias change the value in the neuron.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(manipulate)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">manipulate</span>(</span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n1"</span>),</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), </span>
<span id="cb4-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span></code></pre></div>
<p>Now let’s create another step function in which the change point occurs at 0.4</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb5-2">w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb5-3">b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span></span>
<span id="cb5-4">y1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b1)))</span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>)</span>
<span id="cb5-6"></span>
<span id="cb5-7">w2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb5-8">b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span></span>
<span id="cb5-9">y2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>b2)))</span>
<span id="cb5-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, y2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What happens in the Output node is <img src="https://latex.codecogs.com/png.latex?%5Comega_%7B31%7D%20n1%20+%20%5Comega_%7B32%7D%20n2%20+%20b">. By setting <img src="https://latex.codecogs.com/png.latex?w1"> and <img src="https://latex.codecogs.com/png.latex?w2"> at different sign, we can create a bump.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">w31 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>        </span>
<span id="cb6-2">w32 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>       </span>
<span id="cb6-3">b3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w32 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w31 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Output"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Again, one may use the following codes to have a feel for how two weights and the bias change the output in the Output.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">manipulate</span>(</span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w32 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w31 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Output"</span>),</span>
<span id="cb7-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w31 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb7-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w32 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slider</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">initial =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span></code></pre></div>



 ]]></description>
  <category>Universal Approximation Theorem</category>
  <category>Neural network</category>
  <category>Arbitrary-Width</category>
  <category>Arbitrary-Depth</category>
  <guid>https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/index.html</guid>
  <pubDate>Sun, 23 Jun 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/Learning_ChatGPT_4_UniversalApproximationTheorem/UAT.png" medium="image" type="image/png" height="55" width="144"/>
</item>
<item>
  <title>Parallel simulation in R</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/parallel/index.html</link>
  <description><![CDATA[ 



<p>I find that <code>parallel</code>, <code>doParallel</code> and <code>foreach</code> packages provide the easiest approach for parallel computing in R. The <code>doParallel</code> <a href="https://cran.r-project.org/web/packages/doParallel/vignettes/gettingstartedParallel.pdf">vignette</a> provides a great overview. <code>library(doParallel)</code> command automatically loads required packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(doParallel)</span>
<span id="cb1-2">ncores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detectCores</span>()</span>
<span id="cb1-3">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb1-5">nruns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ncores</span>
<span id="cb1-6"></span>
<span id="cb1-7">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-8">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span>c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(i, x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) }</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span>
<span id="cb1-11">res</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 4 2 4 3 4 4 4</code></pre>
</div>
</div>
<p>We can export packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb3-3"></span>
<span id="cb3-4">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.packages=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.table"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> {</span>
<span id="cb3-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">frollmean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb3-7">  }</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span>
<span id="cb3-10">res</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         result.1   result.2   result.3  result.4     result.5
 [1,]          NA         NA         NA        NA           NA
 [2,]          NA         NA         NA        NA           NA
 [3,]          NA         NA         NA        NA           NA
 [4,]          NA         NA         NA        NA           NA
 [5,]          NA         NA         NA        NA           NA
 [6,]          NA         NA         NA        NA           NA
 [7,]  0.10610803 -0.2996241 0.03278228 0.4701361 -0.004181703
 [8,]  0.05807023 -0.3114088 0.20836936 0.3251219  0.400871629
 [9,]  0.14870568 -0.3538062 0.35330620 0.3301056  0.293785357
[10,] -0.01413357 -0.4768548 0.19839694 0.2946405 -0.029407561</code></pre>
</div>
</div>
<p>We may want to set the same seed for each worker.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb5-3"></span>
<span id="cb5-4">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.packages=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.table"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> {</span>
<span id="cb5-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb5-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">frollmean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb5-8">}</span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span>
<span id="cb5-10">res</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        result.1   result.2   result.3   result.4   result.5
 [1,]         NA         NA         NA         NA         NA
 [2,]         NA         NA         NA         NA         NA
 [3,]         NA         NA         NA         NA         NA
 [4,]         NA         NA         NA         NA         NA
 [5,]         NA         NA         NA         NA         NA
 [6,]         NA         NA         NA         NA         NA
 [7,] -0.6236335 -0.6236335 -0.6236335 -0.6236335 -0.6236335
 [8,] -0.5018746 -0.5018746 -0.5018746 -0.5018746 -0.5018746
 [9,] -0.7423937 -0.7423937 -0.7423937 -0.7423937 -0.7423937
[10,] -0.5445709 -0.5445709 -0.5445709 -0.5445709 -0.5445709</code></pre>
</div>
</div>
<p>Different <code>foreach</code> sessions with the same random seed are not reproducible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb7-5">a1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb7-6">b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb7-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb7-8">a2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb7-9">b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dopar%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb7-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(a1, a2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(b1, b2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span></code></pre></div>
</div>
<p>Reproducibility across different <code>foreach</code> sessions are possible using <a href="https://ftp.heanet.ie/mirrors/cran.r-project.org/web/packages/doRNG/index.html">doRNG</a> package. Examples below were adapted from the <a href="https://stackoverflow.com/questions/8358098/how-to-set-seed-for-random-simulations-with-foreach-and-domc-packages">stackoverflow post</a>.</p>
<p>You use <code>%dorng%</code> instead of <code>%dopar%</code> in the <code>doRNG</code> approach</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(doRNG)</span>
<span id="cb10-2"></span>
<span id="cb10-3">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb10-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb10-7">a1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dorng%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb10-8">b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dorng%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb10-9"></span>
<span id="cb10-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb10-11">a2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dorng%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb10-12">b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combine=</span>cbind) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%dorng%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) }</span>
<span id="cb10-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(a1, a2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(b1, b2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span></code></pre></div>
</div>
<p>We may want to examine parallel workers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">cl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeCluster</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getOption</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl.cores"</span>, ncores<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registerDoParallel</span>(cl)</span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDoParWorkers</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDoParName</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "doParallelSNOW"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDoParVersion</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1.0.17"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopCluster</span>(cl)</span></code></pre></div>
</div>



 ]]></description>
  <category>parallelism</category>
  <category>foreach</category>
  <category>doParallel</category>
  <guid>https://www.jonghoonk.com/blog/posts/parallel/index.html</guid>
  <pubDate>Thu, 13 Jun 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/parallel/right_trunc2.png" medium="image" type="image/png" height="114" width="144"/>
</item>
<item>
  <title>Basic reproduction number: An algorithmic approach</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/R0_mathematica/index.html</link>
  <description><![CDATA[ 



<p>A <a href="https://www.mdpi.com/2227-7390/12/1/27">recent article</a> published in Mathematics discusses an approach to calculating <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0">. Since I have previously written a <a href="https://www.jonghoonk.com/posts/R0-sympy/">post</a> about calculating <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0"> using Sympy, I wanted to explore a new approach proposed by the article.</p>
<p>The article claims that <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0"> is a not function of the original set of ordinary differential equations (ODEs) because <img src="https://latex.codecogs.com/png.latex?(F,%20V)"> gradient decomposition may not be unique for a given set of ODEs. As a reminder, <a href="https://link.springer.com/article/10.1007/BF00178324">Diekmann <em>et al.</em></a> showed that <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0"> is the spectral radius, or Perron–Frobenius eigenvalue, of the next generation operator.</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS/%5Cmathrm%7Bd%7Dt%20&amp;=%20-%5Cbeta%20I%20S/N%20%5C%5C%0A%5Cmathrm%7Bd%7DI/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cbeta%20I%20S/N%20-%20%5Cgamma%20I%5C%5C%0A%5Cmathrm%7Bd%7DR/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cgamma%20I%0A%5Cend%7Balign%7D">
<p>Following Python and Mathematica codes generate that <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0%20=%20%5Cfrac%7B%5Cbeta%7D%7B%5Cgamma%7D."> if <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> and <img src="https://latex.codecogs.com/png.latex?%5Cgamma"> are replaced with <img src="https://latex.codecogs.com/png.latex?b"> and <img src="https://latex.codecogs.com/png.latex?g">, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sympy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-2">b, k, g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b k g'</span>)</span>
<span id="cb1-3">F <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, b],[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb1-4">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[k, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>k, g]])</span>
<span id="cb1-5">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-6">eigval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> M.eigenvals(simplify<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true)</span>
<span id="cb1-7">init_printing(use_unicode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-8">lst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(eigval.keys())</span>
<span id="cb1-9">lst[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>b
─
g</code></pre>
</div>
</div>
<p>Mathematica uses the following next generation method (NGM) function provided in the article.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">NGM[mod_, inf_] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb3-2"> Module[{dyn, X, infc, M, V, F, F1, V1, K}, dyn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> mod[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]; </span>
<span id="cb3-3">  X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> mod[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]; infc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Complement[Range[Length[X]], inf]; </span>
<span id="cb3-4">  M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Grad[dyn[[inf]], X[[inf]]]</span>
<span id="cb3-5">  (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>The jacobian of the infectious equations<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>); </span>
<span id="cb3-6">  V1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. Thread[X[[infc]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb3-7">  (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>V1 is a first guess <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> V,</span>
<span id="cb3-8">  retains all gradient terms which disappear when the non infectious <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-9">components are null<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>); F1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> V1</span>
<span id="cb3-10">  (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>F1 is a first guess <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> F,containing all other gradient terms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>); </span>
<span id="cb3-11">  F <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Replace[F1, _. _?Negative <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>}];</span>
<span id="cb3-12">  (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>all terms <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> F1 containing minuses are set to <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>); V <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> F <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> M;</span>
<span id="cb3-13">  K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> (F . Inverse[V]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. Thread[X[[inf]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">/</span> FullSimplify;</span>
<span id="cb3-14">  {M, V1, F1, F, V, K}]</span>
<span id="cb3-15"></span>
<span id="cb3-16">eqnsSEIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-17">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>b s i ,</span>
<span id="cb3-18">  b s i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> k e,</span>
<span id="cb3-19">  k e <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> g i, </span>
<span id="cb3-20">  g i }</span>
<span id="cb3-21"></span>
<span id="cb3-22">varsSEIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {s, e, i, r}</span>
<span id="cb3-23">modSEIR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {eqnsSEIR, varsSEIR}</span>
<span id="cb3-24">NGM[modSEIR, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>}] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>. s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<p>As in the <a href="https://www.jonghoonk.com/posts/R0-sympy/">previous post</a>, I applied the method to the model used in <a href="https://journals.plos.org/plosntds/article?id=10.1371/journal.pntd.0002642">Pitzer <em>et al</em>.</a>, of which the model may be expressed in the following set of equations.</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathrm%7Bd%7DS_1/%5Cmathrm%7Bd%7Dt%20&amp;=%20B%20+%20%5Cepsilon%20S_2%20-%20(%5Clambda_p+%5Clambda_w+%5Cmu)S_1%5C%5C%0A%5Cmathrm%7Bd%7DI_1/%5Cmathrm%7Bd%7Dt%20&amp;=%20(%5Clambda_p+%5Clambda_w)S_1%20-%20(%5Cdelta+%5Cmu)%20I_1%20%5C%5C%0A%5Cmathrm%7Bd%7DR/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cdelta(1-%5Ctheta-%5Calpha)(I_1+I_2)%20-%20(%5Comega%20+%5Cmu)R%20%5C%5C%0A%5Cmathrm%7Bd%7DC/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cdelta%5Ctheta(I_1+I_2)%20-%20%5Cmu%20C%20%5C%5C%0A%5Cmathrm%7Bd%7DS_2/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Comega%20R%20-%5Cepsilon%20S_2%20-%20(%5Clambda_p+%5Clambda_w+%5Cmu)%20S_2%5C%5C%0A%5Cmathrm%7Bd%7DI_2/%5Cmathrm%7Bd%7Dt%20&amp;=%20(%5Clambda_p+%5Clambda_w)%20S_2%20-%20(%5Cdelta+%5Cmu)%20I_2%20%5C%5C%0A%5Cmathrm%7Bd%7DW/%5Cmathrm%7Bd%7Dt%20&amp;=%20%5Cgamma(I_1+rI_2+rC)%20-%20%5Cxi%20W%0A%5Cend%7Balign%7D">
<p>Following Python and Mathematica codes generates that</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%7D%0A%5Cmathcal%7BR%7D_0%20=%20%5Cfrac%7B1%7D%7B%5Cmu+%5Cdelta%7D%20%5Cleft(%5Cbeta_p%20+%5Cfrac%7B%5Cgamma%20%5Cbeta_w%7D%7B%5Cxi%7D%5Cright)%20%5Cleft(1%20+%5Cfrac%7B%5Cdelta%5Ctheta%20r%7D%7B%5Cmu%7D%5Cright)%0A%5Cend%7Balign%7D">
<p>In the following Python codes <img src="https://latex.codecogs.com/png.latex?p,%20r,%20w,%20d,%20m,%20t,%20g,%20x"> represent <img src="https://latex.codecogs.com/png.latex?%5Cbeta_p,%20r,%20%5Cbeta_w,%20%5Cdelta,%20%5Cmu,%20%5Ctheta,%20%5Cgamma,%20%5Cxi"> in the equation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">p, r, w, d, m, t, g, x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> symbols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p r w d m t g x'</span>)</span>
<span id="cb4-2">F <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[p, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p, w], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb4-3">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Matrix([[d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t, m, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>g, x]])</span>
<span id="cb4-4">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-5">eigval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> M.eigenvals(simplify<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true)</span>
<span id="cb4-6">init_printing(use_unicode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-7">eigval </span>
<span id="cb4-8">lst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(eigval.keys())</span>
<span id="cb4-9">R0_eig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lst[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-10">R0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>m))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>x)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>r)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>m) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R0 from the Pitzer (2014)</span></span>
<span id="cb4-11">simplify(R0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R0_eig) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0 for the same expression (symbolic assessment)</span></span>
<span id="cb4-12">R0.equals(R0_eig) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True for the same expression (numerical assessment)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">eqnsSIRW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb5-2">  B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Epsilon] Subscript[s, </span>
<span id="cb5-3">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (Subscript[\[Beta], </span>
<span id="cb5-4">       P] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-5">      Subscript[\[Beta], W] w <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) Subscript[s, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb5-6">  \[Omega] R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> \[Epsilon] Subscript[s, </span>
<span id="cb5-7">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (Subscript[\[Beta], </span>
<span id="cb5-8">       P] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-9">      Subscript[\[Beta], W]  w <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) Subscript[s, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb5-10">  (Subscript[\[Beta], P] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-11">       Subscript[\[Beta], W]  w) Subscript[s, </span>
<span id="cb5-12">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] \[Minus] (\[Delta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb5-13">  (Subscript[\[Beta], P] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">       Subscript[\[Beta], W]  w) Subscript[s, </span>
<span id="cb5-15">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Delta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb5-16">  \[Delta] \[Theta] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> \[Mu] c,</span>
<span id="cb5-17">  \[Gamma] (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r c) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> \[Xi] w,</span>
<span id="cb5-18">  \[Delta] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> \[Theta]) (Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Subscript[i, </span>
<span id="cb5-19">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (\[Omega] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu]) R}</span>
<span id="cb5-20"></span>
<span id="cb5-21">varsSIRW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {Subscript[s, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], Subscript[s, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb5-22">  Subscript[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], c, w, R }</span>
<span id="cb5-23">  </span>
<span id="cb5-24">modSIRW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {eqnsSIRW, varsSIRW}</span>
<span id="cb5-25">NGM[modSIRW, Range[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]]</span></code></pre></div>
</div>
<p>Again, manually defining <img src="https://latex.codecogs.com/png.latex?F,V"> as follows leads to the same answer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">F <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {{Subscript[\[Beta], P], r Subscript[\[Beta], P], </span>
<span id="cb6-2">   r Subscript[\[Beta], P], Subscript[\[Beta], W] }, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-3">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}}</span>
<span id="cb6-4">V <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {{\[Delta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, \[Delta] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> \[Mu], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-5">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>\[Delta] \[Theta], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>\[Delta] \[Theta], \[Mu], </span>
<span id="cb6-6">   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}, {<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>\[Gamma], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r \[Gamma], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r \[Gamma], \[Xi]}}</span>
<span id="cb6-7">Eigenvalues[Dot[F, Inverse[V]]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">/</span> FullSimplify</span></code></pre></div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BR%7D_0%20=%20%5Cfrac%7B(%5Cmu%20+%5Cdelta%20%20%5Ctheta%20%20r)%20%5Cleft(%5Cxi%20%20%5Cbeta_P+%5Cgamma%20%20%5Cbeta_W%20%5Cright)%7D%7B%5Cmu%20%20%5Cxi%20%20(%5Cdelta%20+%5Cmu%20)%7D."></p>



 ]]></description>
  <category>Basic reproduction number</category>
  <category>Mathematica</category>
  <category>algorithmic approach</category>
  <category>next generation matrix</category>
  <guid>https://www.jonghoonk.com/blog/posts/R0_mathematica/index.html</guid>
  <pubDate>Sat, 01 Jun 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/R0_mathematica/intro-spikey.png" medium="image" type="image/png" height="147" width="144"/>
</item>
<item>
  <title>Claude 3</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/claude_api/index.html</link>
  <description><![CDATA[ 



<p>Testing Claude 3 with R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(jsonlite)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to make API request</span></span>
<span id="cb1-5">prompt_claude <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prompt =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb1-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_key =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb1-7">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opus"</span>,</span>
<span id="cb1-8">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_tokens =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) {</span>
<span id="cb1-9">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.null</span>(api_key)) {</span>
<span id="cb1-10">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"api_key must provided"</span>)</span>
<span id="cb1-11">  }</span>
<span id="cb1-12">  model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span>(model, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude-3-haiku-20240307"</span>,</span>
<span id="cb1-13">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude-3-sonnet-20240229"</span>,</span>
<span id="cb1-14">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude-3-opus-20240229"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-15">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(model) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb1-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The model name is wrong. It must be one of the haiku, sonnet, and opus"</span>)</span>
<span id="cb1-17">  }</span>
<span id="cb1-18">  </span>
<span id="cb1-19">  response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">POST</span>(</span>
<span id="cb1-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.anthropic.com/v1/messages"</span>,</span>
<span id="cb1-21">    httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_headers</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x-api-key</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> api_key, </span>
<span id="cb1-22">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">anthropic-version</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-06-01"</span>,</span>
<span id="cb1-23">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content-type</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application/json"</span>),</span>
<span id="cb1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json"</span>,</span>
<span id="cb1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body =</span> jsonlite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toJSON</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-26">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> model,</span>
<span id="cb1-27">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_tokens =</span> max_tokens,</span>
<span id="cb1-28">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">messages =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">role =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content =</span> prompt))</span>
<span id="cb1-29">    ), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">auto_unbox =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-30"> )</span>
<span id="cb1-31"> content <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> httr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">content</span>(response, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">as=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb1-32"> json_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> jsonlite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fromJSON</span>(content, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flatten =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-33"> response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> json_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text</span>
<span id="cb1-34"> </span>
<span id="cb1-35"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(response)</span>
<span id="cb1-36">}</span>
<span id="cb1-37"></span>
<span id="cb1-38">api_key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CLAUDE_API_KEY"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># api key was stored in the .Renviron file</span></span>
<span id="cb1-39">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prompt_claude</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prompt=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The cat sat on the"</span>, api_key, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"haiku"</span>)</span>
<span id="cb1-40"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(res)</span></code></pre></div>
</div>



 ]]></description>
  <category>LLM</category>
  <category>Claude</category>
  <guid>https://www.jonghoonk.com/blog/posts/claude_api/index.html</guid>
  <pubDate>Wed, 29 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/claude_api/anthropic.png" medium="image" type="image/png" height="136" width="144"/>
</item>
<item>
  <title>Learning ChatGPT 2: Approximating a tower function using a neural net</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index.html</link>
  <description><![CDATA[ 



<p>The <a href="https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/">blog post by Stephen Wolfram</a> discusses a neural network for approximating some sort of a step function. This post is my attempt to reproduce it. A <a href="https://www.youtube.com/watch?v=Ijqkc7OLenI">YouTube video</a> and a <a href="http://neuralnetworksanddeeplearning.com/chap4.html">book chapter</a> by Michael Nielsen beautifully explain how a neural network can approximate a tower function while explaining the <a href="https://en.wikipedia.org/wiki/Universal_approximation_theorem">Universal Approximation Theorem</a>.</p>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(torch)</span>
<span id="cb1-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb1-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>))</span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># input and output are turned into a 1-column tensor  </span></span>
<span id="cb1-5">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-6">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="neural-network" class="level3">
<h3 class="anchored" data-anchor-id="neural-network">Neural network</h3>
<p>One simple way to create a neural network is to use <code>nn_sequential</code> function of the <code>torch</code> package. <a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">Rectified linear unit (ReLU)</a> is used for an activation function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dim_in <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-2">dim_out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-3">dim_hidden <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span></span>
<span id="cb2-4"></span>
<span id="cb2-5">net <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_sequential</span>(</span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_in, dim_hidden),</span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_out)</span>
<span id="cb2-9">)</span></code></pre></div>
</div>
</section>
<section id="traing-a-neural-network" class="level3">
<h3 class="anchored" data-anchor-id="traing-a-neural-network">Traing a neural network</h3>
<p>The <a href="https://arxiv.org/abs/1412.6980">Adam optimizer</a>, which a popular choice, is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim_adam</span>(net<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>parameters)</span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># opt &lt;- optim_sgd(net$parameters, lr=0.001)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">num_epochs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb4-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (epoch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_epochs) {</span>
<span id="cb4-3">  y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># forward pass</span></span>
<span id="cb4-4">  loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_mse_loss</span>(y_pred, y)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute loss </span></span>
<span id="cb4-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (epoch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) { </span>
<span id="cb4-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Epoch: "</span>, epoch, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", Loss: "</span>, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-7">  }</span>
<span id="cb4-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># back propagation </span></span>
<span id="cb4-9">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_grad</span>()</span>
<span id="cb4-10">  loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb4-11">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update weights</span></span>
<span id="cb4-12">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  100 , Loss:  0.05918226 
Epoch:  200 , Loss:  0.04266065 
Epoch:  300 , Loss:  0.02848286 
Epoch:  400 , Loss:  0.01916445 
Epoch:  500 , Loss:  0.01608658 
Epoch:  600 , Loss:  0.01477717 
Epoch:  700 , Loss:  0.01393809 
Epoch:  800 , Loss:  0.01333173 
Epoch:  900 , Loss:  0.01286871 
Epoch:  1000 , Loss:  0.01249429 </code></pre>
</div>
</div>
<p>Compare the data and the model predictions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">ypred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L2 loss: %.4f"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ypred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "L2 loss: 3.7598"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, ypred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb8-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"neural net"</span>), </span>
<span id="cb8-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>), </span>
<span id="cb8-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>),</span>
<span id="cb8-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb8-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb8-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb8-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb8-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb8-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="enlarge-the-neural-network" class="level3">
<h3 class="anchored" data-anchor-id="enlarge-the-neural-network">Enlarge the neural network</h3>
<p>Let’s repeat an experiment using a larger network - more nodes and layers</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">dim_hidden <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span></span>
<span id="cb9-2"></span>
<span id="cb9-3">net <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_sequential</span>(</span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_in, dim_hidden),</span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_hidden),</span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_hidden),</span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_out)</span>
<span id="cb9-11">)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim_adam</span>(net<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>parameters)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">num_epochs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb11-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (epoch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_epochs) {</span>
<span id="cb11-3">  y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># forward pass</span></span>
<span id="cb11-4">  loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_mse_loss</span>(y_pred, y)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute loss </span></span>
<span id="cb11-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (epoch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) { </span>
<span id="cb11-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Epoch: "</span>, epoch, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", Loss: "</span>, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-7">  }</span>
<span id="cb11-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># back propagation </span></span>
<span id="cb11-9">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_grad</span>()</span>
<span id="cb11-10">  loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb11-11">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update weights</span></span>
<span id="cb11-12">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  100 , Loss:  0.02049372 
Epoch:  200 , Loss:  0.005859586 
Epoch:  300 , Loss:  0.00293437 
Epoch:  400 , Loss:  0.001943566 
Epoch:  500 , Loss:  0.001552111 
Epoch:  600 , Loss:  0.001466194 
Epoch:  700 , Loss:  0.00113698 
Epoch:  800 , Loss:  0.001119171 
Epoch:  900 , Loss:  0.0009291215 
Epoch:  1000 , Loss:  0.001042918 </code></pre>
</div>
</div>
<p>Compare the data and the model predictions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">ypred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L2 loss: %.4f"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ypred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "L2 loss: 0.3239"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png("stepfunc_nn.png")</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb15-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x, ypred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>)</span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, </span>
<span id="cb15-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"neural net"</span>), </span>
<span id="cb15-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>), </span>
<span id="cb15-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>),</span>
<span id="cb15-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb15-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, </span>
<span id="cb15-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, </span>
<span id="cb15-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb15-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">horiz =</span> F , </span>
<span id="cb15-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inset =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Neural network</category>
  <category>Adam</category>
  <category>matrix</category>
  <guid>https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/index.html</guid>
  <pubDate>Mon, 27 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_2/stepfunc_nn.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>A very basic implementation of a neural network</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/neural_network_basic/index.html</link>
  <description><![CDATA[ 



<p>I am documenting my learning of a neural network. The contents are mostly based on the <a href="https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/">e-book</a>.</p>
<p>Load the <code>torch</code> library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(torch)</span></code></pre></div>
</div>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># input dimensionality (number of input features)</span></span>
<span id="cb2-2">dim_in <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of observations in training set</span></span>
<span id="cb2-4">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb2-5"></span>
<span id="cb2-6">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_randn</span>(n, dim_in)</span>
<span id="cb2-7">coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb2-8">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matmul</span>(coefs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unsqueeze</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_randn</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># column matrix</span></span></code></pre></div>
</div>
<p>Weights and biases</p>
<p><img src="https://latex.codecogs.com/png.latex?f(%5Cbf%7BX%7D)=%5Cbf%7BXW%7D+b"></p>
<p>Using two layers with corresponding parameters, <code>w1, b1, w2</code> and <code>b2</code>.</p>
<p><img src="https://latex.codecogs.com/png.latex?f(%5Cbf%7BX%7D)=(%5Cbf%7BXW_1%7D+b_1)%5Cbf%7BW_2%7D+b_2"></p>
<p><code>y_pred &lt;- x$mm(w1)$add(b1)$relu()$mm(w2)$add(b2)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dimensionality of hidden layer</span></span>
<span id="cb3-2">dim_hidden <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># output dimensionality (number of predicted features)</span></span>
<span id="cb3-4">dim_out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># weights connecting input to hidden layer</span></span>
<span id="cb3-7">w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_randn</span>(dim_in, dim_hidden, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">requires_grad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># weights connecting hidden to output layer</span></span>
<span id="cb3-9">w2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_randn</span>(dim_hidden, dim_out, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">requires_grad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hidden layer bias</span></span>
<span id="cb3-12">b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_zeros</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dim_hidden, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">requires_grad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># output layer bias</span></span>
<span id="cb3-14">b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_zeros</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dim_out, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">requires_grad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<p>Predicted values from the above network is computed as follows and using Rectified Linear Unit (ReLU) as the activation function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relu</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w2)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b2)</span></code></pre></div>
</div>
<p>Then the loss function can be created as follows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (y_pred <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pow</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">learning_rate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span></span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### training loop ----------------------------------------</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (epoch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) {</span>
<span id="cb6-6">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### -------- Forward pass --------</span></span>
<span id="cb6-7">  y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relu</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w2)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b2)</span>
<span id="cb6-8">  </span>
<span id="cb6-9">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### -------- Compute loss -------- </span></span>
<span id="cb6-10">  loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (y_pred <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pow</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()</span>
<span id="cb6-11">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (epoch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Epoch: "</span>, epoch, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"   Loss: "</span>, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-13">  </span>
<span id="cb6-14">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### -------- Backpropagation --------</span></span>
<span id="cb6-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute gradient of loss w.r.t. all tensors with</span></span>
<span id="cb6-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># requires_grad = TRUE</span></span>
<span id="cb6-17">  loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb6-18">  </span>
<span id="cb6-19">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### -------- Update weights -------- </span></span>
<span id="cb6-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Wrap in with_no_grad() because this is a part we don't </span></span>
<span id="cb6-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># want to record for automatic gradient computation</span></span>
<span id="cb6-22">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with_no_grad</span>({</span>
<span id="cb6-23">     w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_</span>(learning_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad)</span>
<span id="cb6-24">     w2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_</span>(learning_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> w2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad)</span>
<span id="cb6-25">     b1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> b1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_</span>(learning_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad)</span>
<span id="cb6-26">     b2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> b2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_</span>(learning_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad)  </span>
<span id="cb6-27">     </span>
<span id="cb6-28">     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Zero gradients after every pass, as they'd</span></span>
<span id="cb6-29">     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># accumulate otherwise</span></span>
<span id="cb6-30">     w1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_</span>()</span>
<span id="cb6-31">     w2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_</span>()</span>
<span id="cb6-32">     b1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_</span>()</span>
<span id="cb6-33">     b2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_</span>()  </span>
<span id="cb6-34">   })</span>
<span id="cb6-35">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  10    Loss:  3.000276 
Epoch:  20    Loss:  2.144468 
Epoch:  30    Loss:  1.749418 
Epoch:  40    Loss:  1.538223 
Epoch:  50    Loss:  1.413543 
Epoch:  60    Loss:  1.33866 
Epoch:  70    Loss:  1.294799 
Epoch:  80    Loss:  1.265488 
Epoch:  90    Loss:  1.244047 
Epoch:  100    Loss:  1.226817 
Epoch:  110    Loss:  1.212944 
Epoch:  120    Loss:  1.201177 
Epoch:  130    Loss:  1.190159 
Epoch:  140    Loss:  1.178311 
Epoch:  150    Loss:  1.167546 
Epoch:  160    Loss:  1.157191 
Epoch:  170    Loss:  1.147406 
Epoch:  180    Loss:  1.13854 
Epoch:  190    Loss:  1.131134 
Epoch:  200    Loss:  1.123894 </code></pre>
</div>
</div>
<p>Evaluate the model visually</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># png("obs_pred.png")</span></span>
<span id="cb8-2">y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relu</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mm</span>(w2)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(b2)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(y, y_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span>, </span>
<span id="cb8-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Neural network from scratch"</span>)</span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/neural_network_basic/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dev.off()</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_pred))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 224.638</code></pre>
</div>
</div>
<p>The same model can be created in a more compactly way using a sequential module and using the activation function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">net <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_sequential</span>(</span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_in, dim_hidden),</span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_relu</span>(),</span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nn_linear</span>(dim_hidden, dim_out)</span>
<span id="cb11-5">)</span></code></pre></div>
</div>
<p>Train using the <code>Adam</code> optimizer, a popular choice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">opt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim_adam</span>(net<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>parameters)</span>
<span id="cb12-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># opt &lt;- optim_sgd(net$parameters, lr=0.001)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### training loop --------------------------------------</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (epoch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) {</span>
<span id="cb13-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># forward pass</span></span>
<span id="cb13-5">  y_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)</span>
<span id="cb13-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute loss </span></span>
<span id="cb13-7">  loss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_mse_loss</span>(y_pred, y)</span>
<span id="cb13-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (epoch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) { </span>
<span id="cb13-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Epoch: "</span>, epoch, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", Loss: "</span>, loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">item</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-10">  }</span>
<span id="cb13-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># back propagation </span></span>
<span id="cb13-12">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zero_grad</span>()</span>
<span id="cb13-13">  loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">backward</span>()</span>
<span id="cb13-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update weights</span></span>
<span id="cb13-15">  opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step</span>()</span>
<span id="cb13-16">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch:  10 , Loss:  3.195003 
Epoch:  20 , Loss:  2.957336 
Epoch:  30 , Loss:  2.741568 
Epoch:  40 , Loss:  2.544529 
Epoch:  50 , Loss:  2.363058 
Epoch:  60 , Loss:  2.193356 
Epoch:  70 , Loss:  2.034059 
Epoch:  80 , Loss:  1.885832 
Epoch:  90 , Loss:  1.748948 
Epoch:  100 , Loss:  1.624851 
Epoch:  110 , Loss:  1.513974 
Epoch:  120 , Loss:  1.417417 
Epoch:  130 , Loss:  1.33595 
Epoch:  140 , Loss:  1.269105 
Epoch:  150 , Loss:  1.216185 
Epoch:  160 , Loss:  1.176016 
Epoch:  170 , Loss:  1.147551 
Epoch:  180 , Loss:  1.128549 
Epoch:  190 , Loss:  1.116211 
Epoch:  200 , Loss:  1.108102 </code></pre>
</div>
</div>
<p>Compare the prediction and observation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">y_pred_s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">net</span>(x)</span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(y, y_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span>, </span>
<span id="cb15-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Neural network: A sequential module"</span>)</span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/neural_network_basic/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mean squared error, L2 loss</span></span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(y_pred))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 221.6205</code></pre>
</div>
</div>
<p>Compared with the linear model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">xdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(x))</span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(xdf) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x3"</span>)</span>
<span id="cb18-3">ydf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(y))</span>
<span id="cb18-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ydf) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>)</span>
<span id="cb18-5">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(xdf, ydf)</span>
<span id="cb18-6">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>x1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>x2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>x3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat)</span>
<span id="cb18-7">y_pred_lm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(m, xdf)</span>
<span id="cb18-8">ydf2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(ydf, y_pred_lm)</span>
<span id="cb18-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(ydf2[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], ydf2[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span>, </span>
<span id="cb18-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linear regresssion"</span>)</span>
<span id="cb18-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/neural_network_basic/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mean squared error, L2 loss</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((ydf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y_pred_lm)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 218.2733</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>GPT-2</category>
  <category>ChatGPT</category>
  <category>Wolfram</category>
  <guid>https://www.jonghoonk.com/blog/posts/neural_network_basic/index.html</guid>
  <pubDate>Sun, 26 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/neural_network_basic/obs_pred.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Variables selection in statistical models</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/variable_selection/index.html</link>
  <description><![CDATA[ 



<p>When building statistical models, one of the most critical steps is variable selection. This process involves choosing the appropriate predictors or features that will be included in your model. The goal is to create a model that is both accurate and interpretable, avoiding overfitting and underfitting. I’ll explore what I am learning regarding issues related to variable selection, the common methods used, and best practices to ensure robust model performance.</p>
<p>The following contents are mainly based on <a href="https://diagnprognres.biomedcentral.com/articles/10.1186/s41512-020-00074-3">the work by Sauebrei et al</a>, which I am learning. As such, the following contents should not be used as a definitive guide to variable selection.</p>
<p>Variable selection should start by defining what kind of model one is developing. The work by Shumeli, <a href="https://www.stat.berkeley.edu/~aldous/157/Papers/shmueli.pdf">To explain or to predict?</a>, discusses that there may be three kinds of statistical models: descriptive, explanatory, and predictive models. The first sentence of its abstract reads, “Statistical modeling is a powerful tool for developing and testing theories by way of causal explanation, prediction, and description.”</p>
<p>Then we can list the variables based on the prior information. In this stage, drawing a directed acyclic graph (DAG) may help.</p>
<p>Once the list is made, one can employ a</p>
<ol type="1">
<li>Forward selection (FS)</li>
<li>Backward elimination (BE)</li>
<li>Stepwise method that combines FS with additional BE. BE method is preferred because we already starts with a plausible model</li>
<li>Best subset selection</li>
</ol>
<p>Different information criteria have been proposed, among which Akaike’s information criterion (AIC) is in principle preferable for predictive models and Schwartz’s Bayesian information criterion (BIC) for descriptive models.</p>
<ol start="19" type="1">
<li>Burnham KP, Anderson DR. Model selection and multimodel inference: a practical information-theoretic approach. New York: Springer; 2002.</li>
</ol>
<p>true data generating model??</p>
<ol type="1">
<li>Filter Methods: These methods apply statistical measures to assign a score to each feature. Features are ranked by their scores, and the top-ranked ones are selected.</li>
</ol>
<p>Correlation Coefficient: Measures the linear relationship between each feature and the target variable. Features with high correlation (positive or negative) are preferred.</p>
<p>Chi-Square Test: Used for categorical variables, this test assesses whether there is a significant association between the feature and the target variable.</p>
<p>ANOVA F-Value: For continuous variables, the ANOVA F-value tests the null hypothesis that all means are equal.</p>
<ol start="2" type="1">
<li>Wrapper Methods: These methods evaluate feature subsets based on model performance. The main types of wrapper methods include:</li>
</ol>
<p>Forward Selection: Starts with no variables and adds one variable at a time based on model performance improvement.</p>
<p>Backward Elimination: Starts with all variables and removes the least significant variable at each step.</p>
<p>Recursive Feature Elimination (RFE): Builds the model and eliminates the least important feature iteratively until the optimal number of features is reached.</p>
<ol start="3" type="1">
<li>Embedded Methods: These methods perform variable selection during the model training process and are typically specific to certain types of models.</li>
</ol>
<p>LASSO (Least Absolute Shrinkage and Selection Operator): Adds a penalty equal to the absolute value of the magnitude of coefficients. This penalty can shrink some coefficients to zero, effectively performing variable selection.</p>
<p>Ridge Regression: Adds a penalty equal to the square of the magnitude of coefficients. While it doesn’t perform variable selection outright, it can reduce the impact of less important variables.</p>
<p>Tree-Based Methods: Models like Random Forests or Gradient Boosting Trees inherently perform variable selection by considering the importance of variables based on their contribution to reducing impurity or error.</p>
<p>Best Practices for Variable Selection 1. Understand Your Data: Before diving into variable selection techniques, it’s crucial to have a deep understanding of your data. Perform exploratory data analysis (EDA) to identify potential relationships and understand the context of each variable.</p>
<ol start="2" type="1">
<li><p>Use Domain Knowledge: Leverage domain expertise to inform your variable selection process. Certain variables might be inherently more important based on the context of the problem.</p></li>
<li><p>Cross-Validation: Always use cross-validation to assess the performance of your model with the selected variables. This ensures that your model’s performance is consistent across different subsets of the data.</p></li>
<li><p>Combine Methods: Often, the best approach is to combine multiple methods. For instance, you might start with filter methods to narrow down the field and then use wrapper methods to fine-tune the selection.</p></li>
<li><p>Regularly Re-Evaluate: As new data becomes available or the problem context changes, re-evaluate your variable selection. What was relevant at one time may no longer be the best choice.</p></li>
</ol>
<p>Conclusion Variable selection is a pivotal step in building effective statistical models. By carefully choosing the right variables, you can improve model accuracy, interpretability, and efficiency. Whether using filter methods, wrapper methods, or embedded methods, the key is to balance model complexity with performance. Combining these methods with domain knowledge and cross-validation will ensure that your model is robust and reliable. As data science continues to evolve, so too will the strategies for variable selection, making it an exciting area of ongoing research and application.</p>
<p>Use prior information. Try to draw a directed acyclic graph (DAG)</p>
<ol type="1">
<li>Forward selection (FS)</li>
<li>Backward elimination (BE)</li>
<li>Stepwise method that combines FS with additional BE. BE method is preferred because we already starts with a plausible model</li>
<li>Best subset selection</li>
</ol>
<p>Different information criteria have been proposed, among which Akaike’s information criterion (AIC) is in principle preferable for predictive models and Schwartz’s Bayesian information criterion (BIC) for descriptive models.</p>
<ol start="19" type="1">
<li>Burnham KP, Anderson DR. Model selection and multimodel inference: a practical information-theoretic approach. New York: Springer; 2002.</li>
</ol>
<p>true data generating model??</p>
<ol start="5" type="1">
<li>Change-in-estimate</li>
<li>Lasso</li>
<li>Elastic net</li>
<li>Boosting - Component-wise boosting is a forward stagewise regression procedure applicable to generalised linear models</li>
<li>Resampling-based: 9.1: bootstrap inclusion frequencies (BIF) 9.2: stability selection</li>
</ol>
<p>Post-selection inference</p>
<p>Since the main aim of descriptive models is the interpretation of the estimated regression coefficients, point estimates should be accompanied by confidence intervals and sometimes also by <img src="https://latex.codecogs.com/png.latex?p"> values.</p>
<p>Generalised additive model (GAM) <a href="https://diagnprognres.biomedcentral.com/articles/10.1186/s41512-020-00074-3">State-of-the-art</a></p>
<p><a href="https://www.stat.berkeley.edu/~aldous/157/Papers/shmueli.pdf">To explain or to predict?</a></p>
<p>Clssic guide to the generalized linear mixed model is <a href="https://www.cell.com/trends/ecology-evolution/abstract/S0169-5347(09)00019-6?mobileUi\u003d0\u0026code\u003dcell-site=">Bolker et al.</a></p>
<p><a href="https://www.frontiersin.org/journals/psychology/articles/10.3389/fpsyg.2021.666182/full">Reporting guidelines for the GLIMM</a></p>
<section id="data-fields" class="level3">
<h3 class="anchored" data-anchor-id="data-fields">Data Fields</h3>
<p>age: Age of the subject age_grp: sex: household size: Number of people living together excluding oneself school/occupation</p>


</section>

 ]]></description>
  <category>R</category>
  <category>variable selection</category>
  <category>generalized linear model</category>
  <guid>https://www.jonghoonk.com/blog/posts/variable_selection/index.html</guid>
  <pubDate>Fri, 17 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/variable_selection/chatgpt.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Learning ChatGPT 1: Probabilities for the next word</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/learning_ChatGPT_1/index.html</link>
  <description><![CDATA[ 



<p>Inspired by the <a href="https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/">blog post by Stephen Wolfram</a> about the workings of the GPT-2 system, I decided to learn a bit about ChatGPT myself. Luckily, <a href="https://github.com/AGPatriota/GPT-2-for-R">GPT-2</a> is now available for R. My first task is simply to learn to run the model and generate the probability table for the words that can follow the text, “The best thing about AI is to be able to”. The following contents are mainly based on <a href="https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/">the blog post by Stephen Wolfram</a>. Additional resources include OpenAI Github page for <a href="https://github.com/openai/gpt-2">gpt-2</a> and <a href="https://d4mucfpksywv.cloudfront.net/better-language-models/language-models.pdf">the paper</a> describing GPT-2 paper.</p>
<p>Load the libraries and R implementation of GPT-2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(tok)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(torch)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GPT.R'</span>)</span></code></pre></div>
</div>
<p>Create a tokenizer to process inputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">tok <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tok<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>tokenizer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">from_pretrained</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt2"</span>)</span></code></pre></div>
</div>
<p>Load a GPT-2 model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with_device</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"meta"</span>,{</span>
<span id="cb3-2">  Model0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GPT</span>(</span>
<span id="cb3-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">block_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,</span>
<span id="cb3-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_embd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">768</span>,</span>
<span id="cb3-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N_Layers =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nvoc =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50257</span>,</span>
<span id="cb3-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Head =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb3-8">  )</span>
<span id="cb3-9">})</span></code></pre></div>
</div>
<p>Apply the model weights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">Model0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load_state_dict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">state_dict =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_load</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model-weights.pt"</span>),</span>
<span id="cb4-2">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.refer_to_state_dict =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<p>Create a function to list up <code>top_k</code> words with their probabilities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">top_k_words <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb5-2">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb5-3">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">raw_text =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb5-4">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb5-5">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">top_k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>){</span>
<span id="cb5-6">  </span>
<span id="cb5-7">  idx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> tok<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">encode</span>(raw_text)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ids</span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input text is "</span>, raw_text)</span>
<span id="cb5-9">  idx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_tensor</span>(idx<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dtype=</span>torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_int</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device=</span>device0)</span>
<span id="cb5-10">  idx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">torch_unsqueeze</span>(idx, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-11">  idx_cond <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> idx    </span>
<span id="cb5-12">  logits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>()(idx_cond)</span>
<span id="cb5-13">  logits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> logits[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(idx<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">size</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>), ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> temperature</span>
<span id="cb5-14">  </span>
<span id="cb5-15">  logits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> logits<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">topk</span>(top_k)</span>
<span id="cb5-16">  probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nnf_softmax</span>(logits[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-17">  df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">token =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb5-18">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probability=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(probs))</span>
<span id="cb5-19">  </span>
<span id="cb5-20">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>top_k) {</span>
<span id="cb5-21">    idx_next <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> logits[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]][,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(i)]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unsqueeze</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-22">    token <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tok<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">decode</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(idx_next<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb5-23">    df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>token[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> token</span>
<span id="cb5-24">  }</span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(df)</span>
<span id="cb5-26">}</span></code></pre></div>
</div>
<p>Have the model run on GPU</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">Model0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cuda_is_available</span>()) Model0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cuda</span>() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> Model0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span>()</span>
<span id="cb6-2">device0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (torch<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cuda_is_available</span>()) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cuda"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cpu"</span></span></code></pre></div>
</div>
<p>Generate the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for reproducibility, GPT-2 output is random.</span></span>
<span id="cb7-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_k_words</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> Model0,</span>
<span id="cb7-3">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">device =</span> device0,</span>
<span id="cb7-4">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">raw_text =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The best thing about AI is its ability to"</span>, </span>
<span id="cb7-5">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">temperature =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb7-6">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">top_k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Token"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability"</span>)</span>
<span id="cb7-9">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(df)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Token</th>
<th style="text-align: right;">Probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">learn</td>
<td style="text-align: right;">0.2770396</td>
</tr>
<tr class="even">
<td style="text-align: left;">predict</td>
<td style="text-align: right;">0.2047849</td>
</tr>
<tr class="odd">
<td style="text-align: left;">make</td>
<td style="text-align: right;">0.1826125</td>
</tr>
<tr class="even">
<td style="text-align: left;">understand</td>
<td style="text-align: right;">0.1745481</td>
</tr>
<tr class="odd">
<td style="text-align: left;">do</td>
<td style="text-align: right;">0.1610149</td>
</tr>
</tbody>
</table>
</div>
</div>



 ]]></description>
  <category>GPT-2</category>
  <category>ChatGPT</category>
  <category>Wolfram</category>
  <guid>https://www.jonghoonk.com/blog/posts/learning_ChatGPT_1/index.html</guid>
  <pubDate>Tue, 30 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/learning_ChatGPT_1/top5_prob.png" medium="image" type="image/png" height="44" width="144"/>
</item>
<item>
  <title>Logistic function in R</title>
  <dc:creator>Jong-Hoon Kim</dc:creator>
  <link>https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/index.html</link>
  <description><![CDATA[ 



<section id="logistic-function" class="level3">
<h3 class="anchored" data-anchor-id="logistic-function">Logistic function</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Logistic_function">logistic function</a>, represented as: <img src="https://latex.codecogs.com/png.latex?%0Af(x)%20=%20%5Cfrac%7BL%7D%7B1+e%5E%7B-k(x-x_0)%7D%7D%0A"> , where <img src="https://latex.codecogs.com/png.latex?x_%7B0%7D,%20L">, and <img src="https://latex.codecogs.com/png.latex?k"> represent tht value of the function’s midpoint, the supremum of the values of the function, and the logistic growth rate or steepness of the curve. For values of <img src="https://latex.codecogs.com/png.latex?x"> in the domain of real numbers from <img src="https://latex.codecogs.com/png.latex?-%5Cinfty"> to <img src="https://latex.codecogs.com/png.latex?+%5Cinfty">, the S-shaped curve approaching <img src="https://latex.codecogs.com/png.latex?L"> as <img src="https://latex.codecogs.com/png.latex?x"> approaches <img src="https://latex.codecogs.com/png.latex?+%5Cinfty"> and approaching zero as <img src="https://latex.codecogs.com/png.latex?x"> approaches <img src="https://latex.codecogs.com/png.latex?-%5Cinfty">.</p>
<p>This function was originally devised as a model of <a href="https://en.wikipedia.org/wiki/Logistic_function">population growth</a> and is a versatile tool used in various fields, including epidemiology. In epidemiological contexts, it serves as a mathematical model to describe the growth or decline of infectious diseases within a population over time. See this <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7444956/">study</a>, for example, in which the logistic equation was used to decribe the growth of COVID-19 in a population.</p>
<p>The standard logistic function, where <img src="https://latex.codecogs.com/png.latex?x_%7B0%7D=0,%20L=1,%20k=1">, is sometimes called sigmoid or expit.</p>
<p>In the logistic function, the initial stage of growth is approximately exponential (geometric); then, as saturation begins, the growth slows to linear (arithmetic), and at maturity, growth stops. This function may be also used to describe other phenomena and <a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.1003003">was recently used</a> to model the shape of indirect vaccine efficacy (IVE) in response to the vaccine coverage levels. We are going to explore the use of the logistic function to model the IVE.</p>
</section>
<section id="indirect-vaccine-effectiveness" class="level3">
<h3 class="anchored" data-anchor-id="indirect-vaccine-effectiveness">Indirect vaccine effectiveness</h3>
<p><a href="https://www.jonghoonk.com/posts/vaccine_effectiveness/">Indirect vaccine effectiveness (IVE)</a> is a crucial metric in assessing the impact of vaccination on both vaccinated and unvaccinated individuals within a population. It refers to the protection unvaccinated individuals receive due to the presence of vaccinated individuals in the community.</p>
<p>To delve into the dynamics of IVE, we examine data from clinical trials of oral cholera vaccine conducted in Bangladesh and India. These studies provide insights into how varying levels of vaccination coverage affect the incidence rates among unvaccinated individuals residing in the same cluster.</p>
<p>In particular, we use the IVE analyzed based on clinical trials of oral cholera vaccines in <a href="https://pubmed.ncbi.nlm.nih.gov/15993232/">Bangladesh</a> and in <a href="https://pubmed.ncbi.nlm.nih.gov/23362293/">India</a>. In Table 1 below, we analyze the relationship between “Level of vaccine coverage” and the incidence rates among placebo recipients. The presence of IVE is evident as the risk of illness among placebo recipients diminishes with increasing vaccine coverage levels.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/ali2005_table1_ive.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Table 1</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">vc_cut <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>)</span>
<span id="cb1-2">vc_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vc_cut[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(vc_cut)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the data coming from the first year of vaccination</span></span>
<span id="cb1-4">ve_first_year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span></span>
<span id="cb1-5">eff_vc_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ve_first_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> vc_matlab </span>
<span id="cb1-6">ir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.87</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.72</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.65</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.47</span>)</span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lowest vaccine coverage group has no indirect effect</span></span>
<span id="cb1-8">ive_matlab <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ir)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ali (2013) Kolkata, India</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data from 3-year follow-up. Total protective efficacy remained high (66%)</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># therefore, effective vaccine coverage still calculated as we did for</span></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matlab, Bangladesh data</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Out of 107,347 eligible residents, 66,990 received 2 doses</span></span>
<span id="cb1-14">vc_cut <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">66990</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">107347</span>)</span>
<span id="cb1-15">vc_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vc_cut[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(vc_cut)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-16">ve_first_year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the data coming from the first year of vaccination</span></span>
<span id="cb1-17">eff_vc_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ve_first_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> vc_kolkata</span>
<span id="cb1-18">ir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.54</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.64</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.48</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.93</span>)</span>
<span id="cb1-19">ive_kolkata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ir)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>ir[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-20"></span>
<span id="cb1-21">ive_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(eff_vc_kolkata, eff_vc_matlab), </span>
<span id="cb1-22">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ive_kolkata, ive_matlab))</span>
<span id="cb1-23">ive_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ive_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-24">ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span></span>
<span id="cb1-25">ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>location <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kolkata"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(eff_vc_kolkata)), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Matlab"</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(eff_vc_matlab)))</span></code></pre></div>
</div>
<p>Here, we assumed that the incidence rate among in the unvaccinated population, (i.e., no one was vaccinated) would be the same as the incidence rate observed in the lowest level of vaccine coverage rate, which would be 14% for Matlab and 12.5% for Kolkata. Because of this assumption, we may be underestimating the IVE. While it may be possible to reduce effective vaccine coverage rates by taking the difference between the effective vaccine coverage rates presented here and the lowest vaccine coverage rates (i.e., 14% or 12.5%), I wanted to be rather conservative than overestimating the impact.</p>
<p>Now we develop the logistic equation and fit the equation to the data. Since we know that the IVE has to be between <img src="https://latex.codecogs.com/png.latex?0"> and <img src="https://latex.codecogs.com/png.latex?1">, we set <img src="https://latex.codecogs.com/png.latex?L"> at 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">fm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> indirect_vacc_eff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>k<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(eff_vacc_cov<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x0)))</span>
<span id="cb2-2">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>fm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>ive_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.27</span>))</span>
<span id="cb2-3">predict_logis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb2-4">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])))</span>
<span id="cb2-5">}</span>
<span id="cb2-6">newx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb2-7">newy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict_logis</span>(newx)</span>
<span id="cb2-8">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(ive_dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov=</span>newx, </span>
<span id="cb2-9">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff=</span>newy,</span>
<span id="cb2-10">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model1"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
</div>
<p>R has a self-starting logistic function, which can be helpful in case <code>nls</code> function is not successful for finding the parameter values with the given staring values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">fit_SSlogis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(indirect_vacc_eff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SSlogis</span>(eff_vacc_cov, Asym, xmid, scal), </span>
<span id="cb3-2">                   ive_dat)</span>
<span id="cb3-3">Asym <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asym"</span>]</span>
<span id="cb3-4">xmid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xmid"</span>]</span>
<span id="cb3-5">scal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit_SSlogis)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scal"</span>]</span>
<span id="cb3-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## SSlogis has a different convention for the terms</span></span>
<span id="cb3-7">pred_SSlogis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb3-8">  Asym <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>((xmid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>scal))</span>
<span id="cb3-9">}</span>
<span id="cb3-10">newx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb3-11">newy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pred_SSlogis</span>(newx)</span>
<span id="cb3-12">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(d, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov=</span>newx, </span>
<span id="cb3-13">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff=</span>newy,</span>
<span id="cb3-14">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SSmodel"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
</div>
<p>Finally, we can force the logistic function to converge to 1 when the effective vaccine coverage reaches 1 and to 0 when the effective vaccine coverage is 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>eff_vacc_cov, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>ive_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>indirect_vacc_eff)</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fm &lt;- indirect_vacc_eff ~ 1 / (1 + exp(-k*(eff_vacc_cov-x0)))</span></span>
<span id="cb4-3">fm2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x0)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>k)</span>
<span id="cb4-4">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nls</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>fm2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))</span>
<span id="cb4-5">predict_logis2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb4-6">  k <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit2)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>]]</span>
<span id="cb4-7">  x0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit2)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x0"</span>]]</span>
<span id="cb4-8">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x0)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>k)</span>
<span id="cb4-9">}</span>
<span id="cb4-10"></span>
<span id="cb4-11">newx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb4-12">newy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict_logis2</span>(newx)</span>
<span id="cb4-13">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(d, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eff_vacc_cov=</span>newx, </span>
<span id="cb4-14">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indirect_vacc_eff=</span>newy,</span>
<span id="cb4-15">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model2"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb5-2">extrafont<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loadfonts</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"win"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis_title_size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>),</span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>location))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model1"</span>), </span>
<span id="cb5-9">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model2"</span>), </span>
<span id="cb5-11">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(d, type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SSmodel"</span>), </span>
<span id="cb5-13">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(eff_vacc_cov, indirect_vacc_eff), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forestgreen"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Indirect vaccine efficacy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effective vaccine coverage"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggsave("ive_vacc_cov.png")</span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>Logistic function</category>
  <category>indirect vaccine effectiveness</category>
  <category>oral cholera vaccine</category>
  <guid>https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/index.html</guid>
  <pubDate>Thu, 18 Apr 2024 15:00:00 GMT</pubDate>
  <media:content url="https://www.jonghoonk.com/blog/posts/logistic_indirect_ve/ali2005_table1_ive.png" medium="image" type="image/png" height="33" width="144"/>
</item>
</channel>
</rss>
